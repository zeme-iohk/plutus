<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- editorconfig-checker-disable-file</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass    #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE StrictData        #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell   #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications  #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusLedgerApi.Common.Eval</span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier">EvaluationError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier">EvaluationContext</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#AsScriptDecodeError"><span class="hs-identifier">AsScriptDecodeError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier">LogOutput</span></a></span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#VerboseMode"><span class="hs-identifier">VerboseMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#evaluateScriptRestricting"><span class="hs-identifier">evaluateScriptRestricting</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#evaluateScriptCounting"><span class="hs-identifier">evaluateScriptCounting</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#mkDynEvaluationContext"><span class="hs-identifier">mkDynEvaluationContext</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#toMachineParameters"><span class="hs-identifier">toMachineParameters</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#mkTermToEvaluate"><span class="hs-identifier">mkTermToEvaluate</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#assertWellFormedCostModelParams"><span class="hs-identifier">assertWellFormedCostModelParams</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">Control.Lens</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">PlutusCore</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">PlutusCore</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ScriptPlutus</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">Version</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">PlutusCore.Data</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">PlutusCore.Default</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">PlutusCore.Evaluation.Machine.CostModelInterface</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">PlutusCore.Evaluation.Machine.ExBudget</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">PlutusCore.Evaluation.Machine.ExBudgetingDefaults</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">PlutusCore.Evaluation.Machine.MachineParameters.Default</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">PlutusCore.MkPlc</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UPLC</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">PlutusCore.Pretty</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html"><span class="hs-identifier">PlutusLedgerApi.Common.SerialisedScript</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html"><span class="hs-identifier">PlutusLedgerApi.Common.Versions</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">PlutusPrelude</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">UntypedPlutusCore</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UPLC</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">UntypedPlutusCore.Evaluation.Machine.Cek</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UPLC</span></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Except</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Writer</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Tuple</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../nothunks/html/src"><span class="hs-identifier">NoThunks.Class</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../prettyprinter/html/src"><span class="hs-identifier">Prettyprinter</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">-- | Errors that can be thrown when evaluating a Plutus script.</span><span>
</span><span id="line-49"></span><span class="hs-keyword">data</span><span> </span><span id="EvaluationError"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-var">EvaluationError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-50"></span><span>    </span><span id="CekError"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#CekError"><span class="hs-identifier hs-var">CekError</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">UPLC.CekEvaluationException</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">NamedDeBruijn</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">DefaultUni</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">DefaultFun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ An error from the evaluator itself</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="DeBruijnError"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#DeBruijnError"><span class="hs-identifier hs-var">DeBruijnError</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">FreeVariableError</span></a></span><span> </span><span class="hs-comment">-- ^ An error in the pre-evaluation step of converting from de-Bruijn indices</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="CodecError"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#CodecError"><span class="hs-identifier hs-var">CodecError</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptDecodeError"><span class="hs-identifier hs-type">ScriptDecodeError</span></a></span><span> </span><span class="hs-comment">-- ^ A deserialisation error</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="IncompatibleVersionError"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#IncompatibleVersionError"><span class="hs-identifier hs-var">IncompatibleVersionError</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">ScriptPlutus.Version</span></a></span><span> </span><span class="hs-comment">-- ^ An error indicating a version tag that we don't support</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-comment">-- TODO: make this error more informative when we have more information about what went wrong</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="CostModelParameterMismatch"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#CostModelParameterMismatch"><span class="hs-identifier hs-var">CostModelParameterMismatch</span></a></span></span><span> </span><span class="hs-comment">-- ^ An error indicating that the cost model parameters didn't match what we expected</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679939246"><span id="local-6989586621679939248"><span id="local-6989586621679939265"><span class="annot"><span class="annottext">Int -&gt; EvaluationError -&gt; ShowS
[EvaluationError] -&gt; ShowS
EvaluationError -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [EvaluationError] -&gt; ShowS
$cshowList :: [EvaluationError] -&gt; ShowS
show :: EvaluationError -&gt; String
$cshow :: EvaluationError -&gt; String
showsPrec :: Int -&gt; EvaluationError -&gt; ShowS
$cshowsPrec :: Int -&gt; EvaluationError -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679939146"><span id="local-6989586621679939158"><span class="annot"><span class="annottext">EvaluationError -&gt; EvaluationError -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: EvaluationError -&gt; EvaluationError -&gt; Bool
$c/= :: EvaluationError -&gt; EvaluationError -&gt; Bool
== :: EvaluationError -&gt; EvaluationError -&gt; Bool
$c== :: EvaluationError -&gt; EvaluationError -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span id="_CostModelParameterMismatch"><span id="_IncompatibleVersionError"><span id="_CodecError"><span id="_DeBruijnError"><span id="_CekError"><span id="_EvaluationError"><span id="local-6989586621679939032"><span id="local-6989586621679939038"><span id="local-6989586621679939044"><span id="local-6989586621679939050"><span id="local-6989586621679939056"><span id="local-6989586621679939060"><span id="local-6989586621679939070"><span id="local-6989586621679939079"><span id="local-6989586621679939088"><span id="local-6989586621679939097"><span id="local-6989586621679939107"><span id="AsEvaluationError"><span id="local-6989586621679939567"><span class="hs-identifier">makeClassyPrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">EvaluationError</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679938998"><span id="local-6989586621679939000"><span id="local-6989586621679939002"><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#AsScriptDecodeError"><span class="hs-identifier hs-type">AsScriptDecodeError</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-type">EvaluationError</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>    </span><span id="local-6989586621679938991"><span class="annot"><span class="annottext">_ScriptDecodeError :: Prism' EvaluationError ScriptDecodeError
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#_ScriptDecodeError"><span class="hs-identifier hs-var hs-var hs-var hs-var">_ScriptDecodeError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. AsEvaluationError r =&gt; Prism' r ScriptDecodeError
</span><a href="PlutusLedgerApi.Common.Eval.html#_CodecError"><span class="hs-identifier hs-var">_CodecError</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679938987"><span class="annot"><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-type">EvaluationError</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-63"></span><span>    </span><span id="local-6989586621679938922"><span class="annot"><span class="annottext">pretty :: forall ann. EvaluationError -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#CekError"><span class="hs-identifier hs-type">CekError</span></a></span><span> </span><span id="local-6989586621679938920"><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
</span><a href="#local-6989586621679938920"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a ann. PrettyClassic a =&gt; a -&gt; Doc ann
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">prettyClassicDef</span></a></span><span> </span><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
</span><a href="#local-6989586621679938920"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#DeBruijnError"><span class="hs-identifier hs-type">DeBruijnError</span></a></span><span> </span><span id="local-6989586621679938918"><span class="annot"><span class="annottext">FreeVariableError
</span><a href="#local-6989586621679938918"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVariableError
</span><a href="#local-6989586621679938918"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#CodecError"><span class="hs-identifier hs-type">CodecError</span></a></span><span> </span><span id="local-6989586621679938917"><span class="annot"><span class="annottext">ScriptDecodeError
</span><a href="#local-6989586621679938917"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">viaShow</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptDecodeError
</span><a href="#local-6989586621679938917"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#IncompatibleVersionError"><span class="hs-identifier hs-type">IncompatibleVersionError</span></a></span><span> </span><span id="local-6989586621679938915"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679938915"><span class="hs-identifier hs-var">actual</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;This version of the Plutus Core interface does not support the version indicated by the AST:&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679938915"><span class="hs-identifier hs-var">actual</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationError
</span><a href="PlutusLedgerApi.Common.Eval.html#CostModelParameterMismatch"><span class="hs-identifier hs-var">CostModelParameterMismatch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Cost model parameters were not as we expected&quot;</span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-comment">-- | A simple toggle indicating whether or not we should accumulate logs during script execution.</span><span>
</span><span id="line-70"></span><span class="hs-keyword">data</span><span> </span><span id="VerboseMode"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#VerboseMode"><span class="hs-identifier hs-var">VerboseMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-71"></span><span>    </span><span id="Verbose"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#Verbose"><span class="hs-identifier hs-var">Verbose</span></a></span></span><span> </span><span class="hs-comment">-- ^ accumulate all traces</span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Quiet"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#Quiet"><span class="hs-identifier hs-var">Quiet</span></a></span></span><span> </span><span class="hs-comment">-- ^ don't accumulate anything</span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679938908"><span id="local-6989586621679938910"><span class="annot"><span class="annottext">VerboseMode -&gt; VerboseMode -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: VerboseMode -&gt; VerboseMode -&gt; Bool
$c/= :: VerboseMode -&gt; VerboseMode -&gt; Bool
== :: VerboseMode -&gt; VerboseMode -&gt; Bool
$c== :: VerboseMode -&gt; VerboseMode -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-comment">{-| The type of the executed script's accumulated log output: a list of 'Text'.

It will be an empty list if the `VerboseMode` is set to `Quiet`.
-}</span><span>
</span><span id="line-79"></span><span class="hs-keyword">type</span><span> </span><span id="LogOutput"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier hs-var">LogOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text.Text</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-comment">{-| Shared helper for the evaluation functions: 'evaluateScriptCounting' and 'evaluateScriptRestricting',

Given a 'SerialisedScript':

1) deserialises to a plutus 'Term' and checks its ast version
2) applies the term to a list of 'Data' arguments (e.g. Datum, Redeemer, `ScriptContext`)
3) checks that the applied-term is well-scoped
4) returns the applied-term
-}</span><span>
</span><span id="line-90"></span><span id="local-6989586621679939510"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#mkTermToEvaluate"><span class="hs-identifier hs-type">mkTermToEvaluate</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-type">EvaluationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679939510"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span> </span><span class="hs-comment">-- ^ the Plutus ledger language of the script under execution.</span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#ProtocolVersion"><span class="hs-identifier hs-type">ProtocolVersion</span></a></span><span> </span><span class="hs-comment">-- ^ which protocol version to run the operation in</span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#SerialisedScript"><span class="hs-identifier hs-type">SerialisedScript</span></a></span><span> </span><span class="hs-comment">-- ^ the script to evaluate in serialised form</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Plutus.Data</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ the arguments that the script's underlying term will be applied to</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679939510"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">UPLC.Term</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">UPLC.NamedDeBruijn</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">DefaultUni</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">DefaultFun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-97"></span><span id="mkTermToEvaluate"><span class="annot"><span class="annottext">mkTermToEvaluate :: forall (m :: * -&gt; *).
MonadError EvaluationError m =&gt;
PlutusLedgerLanguage
-&gt; ProtocolVersion
-&gt; SerialisedScript
-&gt; [Data]
-&gt; m (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="PlutusLedgerApi.Common.Eval.html#mkTermToEvaluate"><span class="hs-identifier hs-var hs-var">mkTermToEvaluate</span></a></span></span><span> </span><span id="local-6989586621679938883"><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679938883"><span class="hs-identifier hs-var">lv</span></a></span></span><span> </span><span id="local-6989586621679938882"><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679938882"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span id="local-6989586621679938881"><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679938881"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621679938880"><span class="annot"><span class="annottext">[Data]
</span><a href="#local-6989586621679938880"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-comment">-- It decodes the program through the optimized ScriptForExecution. See `ScriptForExecution`.</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#ScriptForExecution"><span class="hs-identifier hs-type">ScriptForExecution</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">UPLC.Program</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679938877"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679938877"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679938876"><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621679938876"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *).
(AsScriptDecodeError e, MonadError e m) =&gt;
PlutusLedgerLanguage
-&gt; ProtocolVersion -&gt; SerialisedScript -&gt; m ScriptForExecution
</span><a href="PlutusLedgerApi.Common.SerialisedScript.html#fromSerialisedScript"><span class="hs-identifier hs-var">fromSerialisedScript</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679938883"><span class="hs-identifier hs-var">lv</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679938882"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679938881"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679938877"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage -&gt; ProtocolVersion -&gt; Set Version
</span><a href="PlutusLedgerApi.Common.Versions.html#plcVersionsAvailableIn"><span class="hs-identifier hs-var">plcVersionsAvailableIn</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679938883"><span class="hs-identifier hs-var">lv</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679938882"><span class="hs-identifier hs-var">pv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Version -&gt; EvaluationError
</span><a href="PlutusLedgerApi.Common.Eval.html#IncompatibleVersionError"><span class="hs-identifier hs-var">IncompatibleVersionError</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679938877"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679938862"><span class="annot"><span class="annottext">termArgs :: [Term NamedDeBruijn DefaultUni DefaultFun ()]
</span><a href="#local-6989586621679938862"><span class="hs-identifier hs-var hs-var">termArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a (uni :: * -&gt; *) fun (term :: * -&gt; *) tyname name ann.
(TermLike term tyname name uni fun, Includes uni a) =&gt;
ann -&gt; a -&gt; term ann
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">UPLC.mkConstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Data]
</span><a href="#local-6989586621679938880"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-102"></span><span>        </span><span id="local-6989586621679938859"><span class="annot"><span class="annottext">appliedT :: Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621679938859"><span class="hs-identifier hs-var hs-var">appliedT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (term :: * -&gt; *) tyname name (uni :: * -&gt; *) fun ann.
TermLike term tyname name uni fun =&gt;
ann -&gt; term ann -&gt; [term ann] -&gt; term ann
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">UPLC.mkIterApp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621679938876"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Term NamedDeBruijn DefaultUni DefaultFun ()]
</span><a href="#local-6989586621679938862"><span class="hs-identifier hs-var">termArgs</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-comment">-- make sure that term is closed, i.e. well-scoped</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; f b) -&gt; a -&gt; f a
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">through</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">liftEither</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVariableError -&gt; EvaluationError
</span><a href="PlutusLedgerApi.Common.Eval.html#DeBruijnError"><span class="hs-identifier hs-var">DeBruijnError</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) name (uni :: * -&gt; *) fun a.
(HasIndex name, MonadError e m, AsFreeVariableError e) =&gt;
Term name uni fun a -&gt; m ()
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">UPLC.checkScope</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621679938859"><span class="hs-identifier hs-var">appliedT</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#toMachineParameters"><span class="hs-identifier hs-type">toMachineParameters</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#ProtocolVersion"><span class="hs-identifier hs-type">ProtocolVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-type">EvaluationContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">DefaultMachineParameters</span></a></span><span>
</span><span id="line-108"></span><span id="toMachineParameters"><span class="annot"><span class="annottext">toMachineParameters :: ProtocolVersion -&gt; EvaluationContext -&gt; DefaultMachineParameters
</span><a href="PlutusLedgerApi.Common.Eval.html#toMachineParameters"><span class="hs-identifier hs-var hs-var">toMachineParameters</span></a></span></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvaluationContext -&gt; DefaultMachineParameters
</span><a href="PlutusLedgerApi.Common.Eval.html#machineParameters"><span class="hs-identifier hs-var">machineParameters</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">{-| An opaque type that contains all the static parameters that the evaluator needs to evaluate a
script.  This is so that they can be computed once and cached, rather than being recomputed on every
evaluation.
-}</span><span>
</span><span id="line-114"></span><span id="local-6989586621679938851"><span id="local-6989586621679938852"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="EvaluationContext"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-var">EvaluationContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EvaluationContext"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-var">EvaluationContext</span></a></span></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="machineParameters"><span class="annot"><span class="annottext">EvaluationContext -&gt; DefaultMachineParameters
</span><a href="PlutusLedgerApi.Common.Eval.html#machineParameters"><span class="hs-identifier hs-var hs-var">machineParameters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">DefaultMachineParameters</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="annot"><span class="annottext">forall x. Rep EvaluationContext x -&gt; EvaluationContext
forall x. EvaluationContext -&gt; Rep EvaluationContext x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep EvaluationContext x -&gt; EvaluationContext
$cfrom :: forall x. EvaluationContext -&gt; Rep EvaluationContext x
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679938845"><span class="annot"><span class="annottext">EvaluationContext -&gt; ()
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: EvaluationContext -&gt; ()
$crnf :: EvaluationContext -&gt; ()
</span><a href="../../../../ghc/html/libraries/deepseq-1.4.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679938838"><span id="local-6989586621679938840"><span id="local-6989586621679938842"><span class="annot"><span class="annottext">Context -&gt; EvaluationContext -&gt; IO (Maybe ThunkInfo)
Proxy EvaluationContext -&gt; String
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
showTypeOf :: Proxy EvaluationContext -&gt; String
$cshowTypeOf :: Proxy EvaluationContext -&gt; String
wNoThunks :: Context -&gt; EvaluationContext -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; EvaluationContext -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; EvaluationContext -&gt; IO (Maybe ThunkInfo)
$cnoThunks :: Context -&gt; EvaluationContext -&gt; IO (Maybe ThunkInfo)
</span><a href="../../../../nothunks/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">{-|  Create an 'EvaluationContext' for a given plutus-builtins' version.

The input is a `Map` of `Text`s to cost integer values (aka `Plutus.CostModelParams`, `Alonzo.CostModel`)
See Note [Inlining meanings of builtins].

IMPORTANT: The evaluation context of every Plutus version must be recreated upon a protocol update
with the updated cost model parameters.
-}</span><span>
</span><span id="line-128"></span><span id="local-6989586621679939441"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#mkDynEvaluationContext"><span class="hs-identifier hs-type">mkDynEvaluationContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">CostModelApplyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679939441"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">BuiltinVersion</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">DefaultFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Plutus.CostModelParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679939441"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-type">EvaluationContext</span></a></span></span><span>
</span><span id="line-129"></span><span id="mkDynEvaluationContext"><span class="annot"><span class="annottext">mkDynEvaluationContext :: forall (m :: * -&gt; *).
MonadError CostModelApplyError m =&gt;
BuiltinVersion DefaultFun -&gt; CostModelParams -&gt; m EvaluationContext
</span><a href="PlutusLedgerApi.Common.Eval.html#mkDynEvaluationContext"><span class="hs-identifier hs-var hs-var">mkDynEvaluationContext</span></a></span></span><span> </span><span id="local-6989586621679938830"><span class="annot"><span class="annottext">BuiltinVersion DefaultFun
</span><a href="#local-6989586621679938830"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span id="local-6989586621679938829"><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621679938829"><span class="hs-identifier hs-var">newCMP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><span class="annottext">DefaultMachineParameters -&gt; EvaluationContext
</span><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-var">EvaluationContext</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError CostModelApplyError m =&gt;
BuiltinVersion DefaultFun
-&gt; CostModelParams -&gt; m DefaultMachineParameters
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">mkMachineParametersFor</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinVersion DefaultFun
</span><a href="#local-6989586621679938830"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">CostModelParams
</span><a href="#local-6989586621679938829"><span class="hs-identifier hs-var">newCMP</span></a></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- FIXME: remove this function</span><span>
</span><span id="line-133"></span><span id="local-6989586621679939433"><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#assertWellFormedCostModelParams"><span class="hs-identifier hs-type">assertWellFormedCostModelParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">CostModelApplyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679939433"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Plutus.CostModelParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679939433"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-134"></span><span id="assertWellFormedCostModelParams"><span class="annot"><span class="annottext">assertWellFormedCostModelParams :: forall (m :: * -&gt; *).
MonadError CostModelApplyError m =&gt;
CostModelParams -&gt; m ()
</span><a href="PlutusLedgerApi.Common.Eval.html#assertWellFormedCostModelParams"><span class="hs-identifier hs-var hs-var">assertWellFormedCostModelParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall evaluatorcosts builtincosts (m :: * -&gt; *).
(FromJSON evaluatorcosts, FromJSON builtincosts,
 ToJSON evaluatorcosts, ToJSON builtincosts,
 MonadError CostModelApplyError m) =&gt;
CostModel evaluatorcosts builtincosts
-&gt; CostModelParams -&gt; m (CostModel evaluatorcosts builtincosts)
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">Plutus.applyCostModelParams</span></a></span><span> </span><span class="annot"><span class="annottext">CostModel CekMachineCosts BuiltinCostModel
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">Plutus.defaultCekCostModel</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">{-| Evaluates a script, with a cost model and a budget that restricts how many
resources it can use according to the cost model. Also returns the budget that
was actually used.

Can be used to calculate budgets for scripts, but even in this case you must give
a limit to guard against scripts that run for a long time or loop.

Note: Parameterized over the 'LedgerPlutusVersion' since
1. The builtins allowed (during decoding) differ, and
2. The Plutus language versions allowed differ.
-}</span><span>
</span><span id="line-147"></span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#evaluateScriptRestricting"><span class="hs-identifier hs-type">evaluateScriptRestricting</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span> </span><span class="hs-comment">-- ^ The Plutus ledger language of the script under execution.</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#ProtocolVersion"><span class="hs-identifier hs-type">ProtocolVersion</span></a></span><span> </span><span class="hs-comment">-- ^ Which protocol version to run the operation in</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#VerboseMode"><span class="hs-identifier hs-type">VerboseMode</span></a></span><span>     </span><span class="hs-comment">-- ^ Whether to produce log output</span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-type">EvaluationContext</span></a></span><span> </span><span class="hs-comment">-- ^ Includes the cost model to use for tallying up the execution costs</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">ExBudget</span></a></span><span>        </span><span class="hs-comment">-- ^ The resource budget which must not be exceeded during evaluation</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#SerialisedScript"><span class="hs-identifier hs-type">SerialisedScript</span></a></span><span>          </span><span class="hs-comment">-- ^ The script to evaluate</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Plutus.Data</span></a></span><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- ^ The arguments to the script</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier hs-type">LogOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-type">EvaluationError</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">ExBudget</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span id="evaluateScriptRestricting"><span class="annot"><span class="annottext">evaluateScriptRestricting :: PlutusLedgerLanguage
-&gt; ProtocolVersion
-&gt; VerboseMode
-&gt; EvaluationContext
-&gt; ExBudget
-&gt; SerialisedScript
-&gt; [Data]
-&gt; (LogOutput, Either EvaluationError ExBudget)
</span><a href="PlutusLedgerApi.Common.Eval.html#evaluateScriptRestricting"><span class="hs-identifier hs-var hs-var">evaluateScriptRestricting</span></a></span></span><span> </span><span id="local-6989586621679938809"><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679938809"><span class="hs-identifier hs-var">lv</span></a></span></span><span> </span><span id="local-6989586621679938808"><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679938808"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span id="local-6989586621679938807"><span class="annot"><span class="annottext">VerboseMode
</span><a href="#local-6989586621679938807"><span class="hs-identifier hs-var">verbose</span></a></span></span><span> </span><span id="local-6989586621679938806"><span class="annot"><span class="annottext">EvaluationContext
</span><a href="#local-6989586621679938806"><span class="hs-identifier hs-var">ectx</span></a></span></span><span> </span><span id="local-6989586621679938805"><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621679938805"><span class="hs-identifier hs-var">budget</span></a></span></span><span> </span><span id="local-6989586621679938804"><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679938804"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679938803"><span class="annot"><span class="annottext">[Data]
</span><a href="#local-6989586621679938803"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; (b, a)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">swap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall w a. Writer w a -&gt; (a, w)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runWriter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier hs-type">LogOutput</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621679938799"><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621679938799"><span class="hs-identifier hs-var">appliedTerm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError EvaluationError m =&gt;
PlutusLedgerLanguage
-&gt; ProtocolVersion
-&gt; SerialisedScript
-&gt; [Data]
-&gt; m (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="PlutusLedgerApi.Common.Eval.html#mkTermToEvaluate"><span class="hs-identifier hs-var">mkTermToEvaluate</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679938809"><span class="hs-identifier hs-var">lv</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679938808"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679938804"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[Data]
</span><a href="#local-6989586621679938803"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679938752"><span class="annot"><span class="annottext">Either
  (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
  (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="#local-6989586621679938752"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">UPLC.RestrictingSt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">ExRestrictingBudget</span></a></span><span> </span><span id="local-6989586621679938749"><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621679938749"><span class="hs-identifier hs-var">final</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679938748"><span class="annot"><span class="annottext">LogOutput
</span><a href="#local-6989586621679938748"><span class="hs-identifier hs-var">logs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-160"></span><span>            </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun ann cost.
PrettyUni uni fun =&gt;
MachineParameters CekMachineCosts fun (CekValue uni fun ann)
-&gt; ExBudgetMode cost uni fun
-&gt; EmitterMode uni fun
-&gt; NTerm uni fun ann
-&gt; (Either
      (CekEvaluationException NamedDeBruijn uni fun) (NTerm uni fun ()),
    cost, LogOutput)
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">UPLC.runCekDeBruijn</span></a></span><span>
</span><span id="line-161"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtocolVersion -&gt; EvaluationContext -&gt; DefaultMachineParameters
</span><a href="PlutusLedgerApi.Common.Eval.html#toMachineParameters"><span class="hs-identifier hs-var">toMachineParameters</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679938808"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationContext
</span><a href="#local-6989586621679938806"><span class="hs-identifier hs-var">ectx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun.
PrettyUni uni fun =&gt;
ExRestrictingBudget -&gt; ExBudgetMode RestrictingSt uni fun
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">UPLC.restricting</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ExBudget -&gt; ExRestrictingBudget
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">ExRestrictingBudget</span></a></span><span> </span><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621679938805"><span class="hs-identifier hs-var">budget</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">VerboseMode
</span><a href="#local-6989586621679938807"><span class="hs-identifier hs-var">verbose</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">VerboseMode
</span><a href="PlutusLedgerApi.Common.Eval.html#Verbose"><span class="hs-identifier hs-var">Verbose</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun. EmitterMode uni fun
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">UPLC.logEmitter</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun. EmitterMode uni fun
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">UPLC.noEmitter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>                </span><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621679938799"><span class="hs-identifier hs-var">appliedTerm</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><span class="annottext">forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="annot"><span class="annottext">LogOutput
</span><a href="#local-6989586621679938748"><span class="hs-identifier hs-var">logs</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">liftEither</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
-&gt; EvaluationError
</span><a href="PlutusLedgerApi.Common.Eval.html#CekError"><span class="hs-identifier hs-var">CekError</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Either
  (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
  (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="#local-6989586621679938752"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621679938805"><span class="hs-identifier hs-var">budget</span></a></span><span> </span><span class="annot"><span class="annottext">ExBudget -&gt; ExBudget -&gt; ExBudget
</span><a href="../../../../plutus-core/html/src"><span class="hs-operator hs-var">`minusExBudget`</span></a></span><span> </span><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621679938749"><span class="hs-identifier hs-var">final</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="hs-comment">{-| Evaluates a script, returning the minimum budget that the script would need
to evaluate successfully. This will take as long as the script takes, if you need to
limit the execution time of the script also, you can use 'evaluateScriptRestricting', which
also returns the used budget.

Note: Parameterized over the ledger-plutus-version since the builtins allowed (during decoding) differs.
-}</span><span>
</span><span id="line-177"></span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#evaluateScriptCounting"><span class="hs-identifier hs-type">evaluateScriptCounting</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Versions.html#PlutusLedgerLanguage"><span class="hs-identifier hs-type">PlutusLedgerLanguage</span></a></span><span> </span><span class="hs-comment">-- ^ The Plutus ledger language of the script under execution.</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.ProtocolVersions.html#ProtocolVersion"><span class="hs-identifier hs-type">ProtocolVersion</span></a></span><span> </span><span class="hs-comment">-- ^ Which protocol version to run the operation in</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#VerboseMode"><span class="hs-identifier hs-type">VerboseMode</span></a></span><span>     </span><span class="hs-comment">-- ^ Whether to produce log output</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationContext"><span class="hs-identifier hs-type">EvaluationContext</span></a></span><span> </span><span class="hs-comment">-- ^ Includes the cost model to use for tallying up the execution costs</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.SerialisedScript.html#SerialisedScript"><span class="hs-identifier hs-type">SerialisedScript</span></a></span><span>          </span><span class="hs-comment">-- ^ The script to evaluate</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Plutus.Data</span></a></span><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- ^ The arguments to the script</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier hs-type">LogOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#EvaluationError"><span class="hs-identifier hs-type">EvaluationError</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">ExBudget</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span id="evaluateScriptCounting"><span class="annot"><span class="annottext">evaluateScriptCounting :: PlutusLedgerLanguage
-&gt; ProtocolVersion
-&gt; VerboseMode
-&gt; EvaluationContext
-&gt; SerialisedScript
-&gt; [Data]
-&gt; (LogOutput, Either EvaluationError ExBudget)
</span><a href="PlutusLedgerApi.Common.Eval.html#evaluateScriptCounting"><span class="hs-identifier hs-var hs-var">evaluateScriptCounting</span></a></span></span><span> </span><span id="local-6989586621679938741"><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679938741"><span class="hs-identifier hs-var">lv</span></a></span></span><span> </span><span id="local-6989586621679938740"><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679938740"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span id="local-6989586621679938739"><span class="annot"><span class="annottext">VerboseMode
</span><a href="#local-6989586621679938739"><span class="hs-identifier hs-var">verbose</span></a></span></span><span> </span><span id="local-6989586621679938738"><span class="annot"><span class="annottext">EvaluationContext
</span><a href="#local-6989586621679938738"><span class="hs-identifier hs-var">ectx</span></a></span></span><span> </span><span id="local-6989586621679938737"><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679938737"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679938736"><span class="annot"><span class="annottext">[Data]
</span><a href="#local-6989586621679938736"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; (b, a)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">swap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall w a. Writer w a -&gt; (a, w)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runWriter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="PlutusLedgerApi.Common.Eval.html#LogOutput"><span class="hs-identifier hs-type">LogOutput</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>    </span><span id="local-6989586621679938735"><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621679938735"><span class="hs-identifier hs-var">appliedTerm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadError EvaluationError m =&gt;
PlutusLedgerLanguage
-&gt; ProtocolVersion
-&gt; SerialisedScript
-&gt; [Data]
-&gt; m (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="PlutusLedgerApi.Common.Eval.html#mkTermToEvaluate"><span class="hs-identifier hs-var">mkTermToEvaluate</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusLedgerLanguage
</span><a href="#local-6989586621679938741"><span class="hs-identifier hs-var">lv</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679938740"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">SerialisedScript
</span><a href="#local-6989586621679938737"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[Data]
</span><a href="#local-6989586621679938736"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679938689"><span class="annot"><span class="annottext">Either
  (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
  (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="#local-6989586621679938689"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">UPLC.CountingSt</span></a></span><span> </span><span id="local-6989586621679938687"><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621679938687"><span class="hs-identifier hs-var">final</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679938686"><span class="annot"><span class="annottext">LogOutput
</span><a href="#local-6989586621679938686"><span class="hs-identifier hs-var">logs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>            </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun ann cost.
PrettyUni uni fun =&gt;
MachineParameters CekMachineCosts fun (CekValue uni fun ann)
-&gt; ExBudgetMode cost uni fun
-&gt; EmitterMode uni fun
-&gt; NTerm uni fun ann
-&gt; (Either
      (CekEvaluationException NamedDeBruijn uni fun) (NTerm uni fun ()),
    cost, LogOutput)
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">UPLC.runCekDeBruijn</span></a></span><span>
</span><span id="line-190"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtocolVersion -&gt; EvaluationContext -&gt; DefaultMachineParameters
</span><a href="PlutusLedgerApi.Common.Eval.html#toMachineParameters"><span class="hs-identifier hs-var">toMachineParameters</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolVersion
</span><a href="#local-6989586621679938740"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">EvaluationContext
</span><a href="#local-6989586621679938738"><span class="hs-identifier hs-var">ectx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>                </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun. ExBudgetMode CountingSt uni fun
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">UPLC.counting</span></a></span><span>
</span><span id="line-192"></span><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">VerboseMode
</span><a href="#local-6989586621679938739"><span class="hs-identifier hs-var">verbose</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">VerboseMode
</span><a href="PlutusLedgerApi.Common.Eval.html#Verbose"><span class="hs-identifier hs-var">Verbose</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun. EmitterMode uni fun
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">UPLC.logEmitter</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun. EmitterMode uni fun
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">UPLC.noEmitter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>                </span><span class="annot"><span class="annottext">Term NamedDeBruijn DefaultUni DefaultFun ()
</span><a href="#local-6989586621679938735"><span class="hs-identifier hs-var">appliedTerm</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><span class="annottext">forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">tell</span></a></span><span> </span><span class="annot"><span class="annottext">LogOutput
</span><a href="#local-6989586621679938686"><span class="hs-identifier hs-var">logs</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">liftEither</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
-&gt; EvaluationError
</span><a href="PlutusLedgerApi.Common.Eval.html#CekError"><span class="hs-identifier hs-var">CekError</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Either
  (CekEvaluationException NamedDeBruijn DefaultUni DefaultFun)
  (Term NamedDeBruijn DefaultUni DefaultFun ())
</span><a href="#local-6989586621679938689"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ExBudget
</span><a href="#local-6989586621679938687"><span class="hs-identifier hs-var">final</span></a></span><span>
</span><span id="line-198"></span></pre></body></html>