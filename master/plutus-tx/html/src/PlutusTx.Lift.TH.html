<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- editorconfig-checker-disable-file</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP                   #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds       #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DefaultSignatures     #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass        #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies    #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts      #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances     #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase            #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings     #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds             #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes            #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables   #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell       #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications      #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns          #-}</span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusTx.Lift.TH</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="PlutusTx.Lift.TH.html#makeTypeable"><span class="hs-identifier">makeTypeable</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#makeLift"><span class="hs-identifier">makeLift</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#LiftError"><span class="hs-identifier">LiftError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.Lift.Class.html"><span class="hs-identifier">PlutusTx.Lift.Class</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusTx.Lift.THUtils.html"><span class="hs-identifier">PlutusTx.Lift.THUtils</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusIR</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusIR.Compiler.Definitions</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusIR.Compiler.Names</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusIR.MkPir</span></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">PlutusCore.Default</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier">PlutusCore.MkPlc</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Except</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">lift</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Reader</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">lift</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.State</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">lift</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Trans</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Trans</span></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier">Language.Haskell.TH</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier">newName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier">Language.Haskell.TH.Datatype</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier">Language.Haskell.TH.Syntax</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier">newName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../th-compat/html/src"><span class="hs-identifier">Language.Haskell.TH.Syntax.Compat</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Exception</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">throw</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">sortBy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Traversable</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../prettyprinter/html/src"><span class="hs-identifier">Prettyprinter</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PP</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-comment">-- We do not use qualified import because the whole module contains off-chain code</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Haskell</span></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">type</span><span> </span><span id="RTCompileScope"><span class="annot"><a href="PlutusTx.Lift.TH.html#RTCompileScope"><span class="hs-identifier hs-var">RTCompileScope</span></a></span></span><span> </span><span id="local-6989586621679698882"><span class="annot"><a href="#local-6989586621679698882"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621679698881"><span class="annot"><a href="#local-6989586621679698881"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Lift.TH.html#LocalVars"><span class="hs-identifier hs-type">LocalVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679698882"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Lift.Class.html#RTCompile"><span class="hs-identifier hs-type">RTCompile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679698882"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679698881"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">type</span><span> </span><span id="THCompile"><span class="annot"><a href="PlutusTx.Lift.TH.html#THCompile"><span class="hs-identifier hs-var">THCompile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#Deps"><span class="hs-identifier hs-type">Deps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THLocalVars"><span class="hs-identifier hs-type">THLocalVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#LiftError"><span class="hs-identifier hs-type">LiftError</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Q</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">data</span><span> </span><span id="LiftError"><span class="annot"><a href="PlutusTx.Lift.TH.html#LiftError"><span class="hs-identifier hs-var">LiftError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UnsupportedLiftKind"><span class="annot"><a href="PlutusTx.Lift.TH.html#UnsupportedLiftKind"><span class="hs-identifier hs-var">UnsupportedLiftKind</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Kind</span></a></span><span>
</span><span id="line-64"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="UnsupportedLiftType"><span class="annot"><a href="PlutusTx.Lift.TH.html#UnsupportedLiftType"><span class="hs-identifier hs-var">UnsupportedLiftType</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-65"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="UserLiftError"><span class="annot"><a href="PlutusTx.Lift.TH.html#UserLiftError"><span class="hs-identifier hs-var">UserLiftError</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">T.Text</span></a></span><span>
</span><span id="line-66"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="LiftMissingDataCons"><span class="annot"><a href="PlutusTx.Lift.TH.html#LiftMissingDataCons"><span class="hs-identifier hs-var">LiftMissingDataCons</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span>
</span><span id="line-67"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="LiftMissingVar"><span class="annot"><a href="PlutusTx.Lift.TH.html#LiftMissingVar"><span class="hs-identifier hs-var">LiftMissingVar</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span>
</span><span id="line-68"></span><span>               </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679698866"><span id="local-6989586621679698868"><span id="local-6989586621679698870"><span class="annot"><span class="annottext">Show LiftError
Typeable LiftError
SomeException -&gt; Maybe LiftError
LiftError -&gt; String
LiftError -&gt; SomeException
forall e.
Typeable e
-&gt; Show e
-&gt; (e -&gt; SomeException)
-&gt; (SomeException -&gt; Maybe e)
-&gt; (e -&gt; String)
-&gt; Exception e
displayException :: LiftError -&gt; String
$cdisplayException :: LiftError -&gt; String
fromException :: SomeException -&gt; Maybe LiftError
$cfromException :: SomeException -&gt; Maybe LiftError
toException :: LiftError -&gt; SomeException
$ctoException :: LiftError -&gt; SomeException
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Prelude.Exception</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679698862"><span class="annot"><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-type">PP.Pretty</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#LiftError"><span class="hs-identifier hs-type">LiftError</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621679698847"><span class="annot"><span class="annottext">pretty :: forall ann. LiftError -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Lift.TH.html#UnsupportedLiftType"><span class="hs-identifier hs-type">UnsupportedLiftType</span></a></span><span> </span><span id="local-6989586621679698845"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698845"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Unsupported lift type: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-operator hs-var">PP.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">PP.viaShow</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698845"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Lift.TH.html#UnsupportedLiftKind"><span class="hs-identifier hs-type">UnsupportedLiftKind</span></a></span><span> </span><span id="local-6989586621679698842"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698842"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Unsupported lift kind: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-operator hs-var">PP.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">PP.viaShow</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698842"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Lift.TH.html#UserLiftError"><span class="hs-identifier hs-type">UserLiftError</span></a></span><span> </span><span id="local-6989586621679698841"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679698841"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">PP.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679698841"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Lift.TH.html#LiftMissingDataCons"><span class="hs-identifier hs-type">LiftMissingDataCons</span></a></span><span> </span><span id="local-6989586621679698840"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698840"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Constructors not created for type: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-operator hs-var">PP.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">PP.viaShow</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698840"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Lift.TH.html#LiftMissingVar"><span class="hs-identifier hs-type">LiftMissingVar</span></a></span><span> </span><span id="local-6989586621679698839"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698839"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Unknown local variable: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-operator hs-var">PP.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a ann. Show a =&gt; a -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">PP.viaShow</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698839"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679698834"><span id="local-6989586621679698837"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#LiftError"><span class="hs-identifier hs-type">LiftError</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-78"></span><span>    </span><span id="local-6989586621679698829"><span class="annot"><span class="annottext">show :: LiftError -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">PP.pretty</span></a></span><span> </span><span class="hs-comment">-- for Control.Exception</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">{- Note [Impredicative function universe wrappers]
We are completely independent of the function universe. We generate constants (so we care about the type universe),
but we never generate builtin functions.

This is indicated in the fact that e.g. 'typeRep' has type 'forall fun . ...'. Note what this says: the
*caller* of 'typeRep` can decide on 'fun'.

So how do we deal with this? A wrong way is to parameterize our (TH) functions by 'fun'. This is wrong, because
this 'fun' is a type variable at TH-generation time, and we want a type variable in the generated code.
Sometimes this will even appear to work, and I don't know what kind of awful magic is going on in trying to persist
type variables into the quote, but I'm pretty sure it's wrong.

We could use 'InstanceSigs', bind 'fun', and then pass it down and use it in our signatures. But you can't splice
types into signatures in typed TH, you need to go to untyped TH and 'unsafeCoerceTExp' back again, which is pretty ugly.

Alternatively, we can *generate* functions which are parameterized over 'fun', and instantiate them at the top-level.
This is totally fine... except that the representation of expressions in typed TH has a type parameter for the type of
the expression, so we would need to write 'TExp (forall fun . ...)'... which is an impredicative type.

The usual solution is to make a datatype that wraps up the quantification, so you write 'newtype X = X (forall a . ...)',
and then you can write 'TExp X' just fine.

We do this, but annoyingly due to the fact that 'fun' appears inside the *value* of our monadic types (e.g. when we compile
to a term we need to have 'fun' in there) we can't do this generically, and instead we end up with a set of repetitive wrappers
for different variants of this impredicative type. Which is annoying, but does work.
-}</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- See Note [Impredicative function universe wrappers]</span><span>
</span><span id="line-108"></span><span class="hs-keyword">newtype</span><span> </span><span id="CompileType"><span class="annot"><a href="PlutusTx.Lift.TH.html#CompileType"><span class="hs-identifier hs-var">CompileType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CompileType"><span class="annot"><a href="PlutusTx.Lift.TH.html#CompileType"><span class="hs-identifier hs-var">CompileType</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unCompileType"><span class="annot"><span class="annottext">CompileType
-&gt; forall fun. RTCompile DefaultUni fun (Type TyName DefaultUni ())
</span><a href="PlutusTx.Lift.TH.html#unCompileType"><span class="hs-identifier hs-var hs-var">unCompileType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679699285"><span class="annot"><a href="#local-6989586621679699285"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="PlutusTx.Lift.Class.html#RTCompile"><span class="hs-identifier hs-type">RTCompile</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">PLC.DefaultUni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699285"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">PLC.DefaultUni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-109"></span><span class="hs-keyword">newtype</span><span> </span><span id="CompileTypeScope"><span class="annot"><a href="PlutusTx.Lift.TH.html#CompileTypeScope"><span class="hs-identifier hs-var">CompileTypeScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CompileTypeScope"><span class="annot"><a href="PlutusTx.Lift.TH.html#CompileTypeScope"><span class="hs-identifier hs-var">CompileTypeScope</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unCompileTypeScope"><span class="annot"><span class="annottext">CompileTypeScope
-&gt; forall fun.
   RTCompileScope DefaultUni fun (Type TyName DefaultUni ())
</span><a href="PlutusTx.Lift.TH.html#unCompileTypeScope"><span class="hs-identifier hs-var hs-var">unCompileTypeScope</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679699281"><span class="annot"><a href="#local-6989586621679699281"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#RTCompileScope"><span class="hs-identifier hs-type">RTCompileScope</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">PLC.DefaultUni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699281"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">PLC.DefaultUni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-110"></span><span class="hs-keyword">newtype</span><span> </span><span id="CompileDeclFun"><span class="annot"><a href="PlutusTx.Lift.TH.html#CompileDeclFun"><span class="hs-identifier hs-var">CompileDeclFun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CompileDeclFun"><span class="annot"><a href="PlutusTx.Lift.TH.html#CompileDeclFun"><span class="hs-identifier hs-var">CompileDeclFun</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unCompileDeclFun"><span class="annot"><span class="annottext">CompileDeclFun
-&gt; forall fun.
   Type TyName DefaultUni ()
   -&gt; RTCompileScope
        DefaultUni fun (VarDecl TyName Name DefaultUni ())
</span><a href="PlutusTx.Lift.TH.html#unCompileDeclFun"><span class="hs-identifier hs-var hs-var">unCompileDeclFun</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679699278"><span class="annot"><a href="#local-6989586621679699278"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">PLC.DefaultUni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#RTCompileScope"><span class="hs-identifier hs-type">RTCompileScope</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">PLC.DefaultUni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699278"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">PLC.DefaultUni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">{- Note [Type variables]
We handle types in almost exactly the same way when we are constructing Typeable
instances and when we are constructing Lift instances. However, there is one key difference
in how we handle type variables.

In the Typeable case, the type variables we see will be the type variables of the
datatype, which we want to map into the variable declarations that we construct. This requires
us to do some mapping between them at *runtime*, and keep a scope around to map between the TH names
and the PLC types.

In the Lift case, type variables will be free type variables in the instance, and should be handled
by appropriate Typeable constraints for those variables. We get the PLC types by just calling
typeRep.

However, for simplicity we always act as though we have a local scope, and fall back to Typeable,
but in the Lift case we will never populate the local scope.
-}</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-comment">-- | A scope for type variables. See note [Type variables].</span><span>
</span><span id="line-131"></span><span class="hs-keyword">type</span><span> </span><span id="LocalVars"><span class="annot"><a href="PlutusTx.Lift.TH.html#LocalVars"><span class="hs-identifier hs-var">LocalVars</span></a></span></span><span> </span><span id="local-6989586621679698817"><span class="annot"><a href="#local-6989586621679698817"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679698817"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">type</span><span> </span><span id="THLocalVars"><span class="annot"><a href="PlutusTx.Lift.TH.html#THLocalVars"><span class="hs-identifier hs-var">THLocalVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">{- Note [Lifting newtypes]
Newtypes are handled differently in the compiler, in that we identify them with their underlying type.
See Note [Coercions and newtypes] for details.

So we need to do the same here. This means two things:
- For Typeable, we look for the unique field of the unique constructor, and then make a type lambda
  binding the type variables whose body is that type.
- For Lift, we assert that all constructors must have precisely one argument (as newtypes do), and we
  simply call lift on that.

Since we don't &quot;compile&quot; all the way, rather relying on the typeclass system, lifting recursive
newtypes will hang a runtime. Don't do that. (This is worse than what we do in the compiler, see
Note [Occurrences of recursive names])
-}</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-comment">-- Dependencies at TH time</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">{- Note [Tracking dependencies]
While running at TH time, we track the requirements that we need in order to be able to compile
the given type/term, which are things like &quot;must be able to type the constructor argument types&quot;.

These are then cashed out into constraints on the instance.
-}</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-keyword">data</span><span> </span><span id="Dep"><span class="annot"><a href="PlutusTx.Lift.TH.html#Dep"><span class="hs-identifier hs-var">Dep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TypeableDep"><span class="annot"><a href="PlutusTx.Lift.TH.html#TypeableDep"><span class="hs-identifier hs-var">TypeableDep</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="LiftDep"><span class="annot"><a href="PlutusTx.Lift.TH.html#LiftDep"><span class="hs-identifier hs-var">LiftDep</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679698804"><span id="local-6989586621679698806"><span id="local-6989586621679698813"><span class="annot"><span class="annottext">Int -&gt; Dep -&gt; ShowS
[Dep] -&gt; ShowS
Dep -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Dep] -&gt; ShowS
$cshowList :: [Dep] -&gt; ShowS
show :: Dep -&gt; String
$cshow :: Dep -&gt; String
showsPrec :: Int -&gt; Dep -&gt; ShowS
$cshowsPrec :: Int -&gt; Dep -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679698797"><span id="local-6989586621679698802"><span class="annot"><span class="annottext">Dep -&gt; Dep -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Dep -&gt; Dep -&gt; Bool
$c/= :: Dep -&gt; Dep -&gt; Bool
== :: Dep -&gt; Dep -&gt; Bool
$c== :: Dep -&gt; Dep -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679698772"><span id="local-6989586621679698774"><span id="local-6989586621679698777"><span id="local-6989586621679698780"><span id="local-6989586621679698783"><span id="local-6989586621679698787"><span id="local-6989586621679698792"><span class="annot"><span class="annottext">Eq Dep
Dep -&gt; Dep -&gt; Bool
Dep -&gt; Dep -&gt; Ordering
Dep -&gt; Dep -&gt; Dep
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: Dep -&gt; Dep -&gt; Dep
$cmin :: Dep -&gt; Dep -&gt; Dep
max :: Dep -&gt; Dep -&gt; Dep
$cmax :: Dep -&gt; Dep -&gt; Dep
&gt;= :: Dep -&gt; Dep -&gt; Bool
$c&gt;= :: Dep -&gt; Dep -&gt; Bool
&gt; :: Dep -&gt; Dep -&gt; Bool
$c&gt; :: Dep -&gt; Dep -&gt; Bool
&lt;= :: Dep -&gt; Dep -&gt; Bool
$c&lt;= :: Dep -&gt; Dep -&gt; Bool
&lt; :: Dep -&gt; Dep -&gt; Bool
$c&lt; :: Dep -&gt; Dep -&gt; Bool
compare :: Dep -&gt; Dep -&gt; Ordering
$ccompare :: Dep -&gt; Dep -&gt; Ordering
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span class="hs-keyword">type</span><span> </span><span id="Deps"><span class="annot"><a href="PlutusTx.Lift.TH.html#Deps"><span class="hs-identifier hs-var">Deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#Dep"><span class="hs-identifier hs-type">Dep</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span id="local-6989586621679699271"><span id="local-6989586621679699273"><span id="local-6989586621679699274"><span class="annot"><a href="PlutusTx.Lift.TH.html#withTyVars"><span class="hs-identifier hs-type">withTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Lift.TH.html#LocalVars"><span class="hs-identifier hs-type">LocalVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699274"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679699273"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679699273"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699271"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679699273"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699271"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-162"></span><span id="withTyVars"><span class="annot"><span class="annottext">withTyVars :: forall (uni :: * -&gt; *) (m :: * -&gt; *) a.
MonadReader (LocalVars uni) m =&gt;
[(Name, TyVarDecl TyName ())] -&gt; m a -&gt; m a
</span><a href="PlutusTx.Lift.TH.html#withTyVars"><span class="hs-identifier hs-var hs-var">withTyVars</span></a></span></span><span> </span><span id="local-6989586621679698765"><span class="annot"><span class="annottext">[(Name, TyVarDecl TyName ())]
</span><a href="#local-6989586621679698765"><span class="hs-identifier hs-var">mappings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679698763"><span class="annot"><span class="annottext">LocalVars uni
</span><a href="#local-6989586621679698763"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679698761"><span class="annot"><span class="annottext">LocalVars uni
</span><a href="#local-6989586621679698761"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679698760"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698760"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679698759"><span class="annot"><span class="annottext">TyVarDecl TyName ()
</span><a href="#local-6989586621679698759"><span class="hs-identifier hs-var">tvd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698760"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ann tyname (uni :: * -&gt; *).
ann -&gt; TyVarDecl tyname ann -&gt; Type tyname uni ann
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">mkTyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyVarDecl TyName ()
</span><a href="#local-6989586621679698759"><span class="hs-identifier hs-var">tvd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalVars uni
</span><a href="#local-6989586621679698761"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LocalVars uni
</span><a href="#local-6989586621679698763"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVarDecl TyName ())]
</span><a href="#local-6989586621679698765"><span class="hs-identifier hs-var">mappings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span id="local-6989586621679699256"><span id="local-6989586621679699257"><span class="annot"><a href="PlutusTx.Lift.TH.html#thWithTyVars"><span class="hs-identifier hs-type">thWithTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THLocalVars"><span class="hs-identifier hs-type">THLocalVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699257"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679699257"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699256"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679699257"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699256"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-165"></span><span id="thWithTyVars"><span class="annot"><span class="annottext">thWithTyVars :: forall (m :: * -&gt; *) a.
MonadReader THLocalVars m =&gt;
[Name] -&gt; m a -&gt; m a
</span><a href="PlutusTx.Lift.TH.html#thWithTyVars"><span class="hs-identifier hs-var hs-var">thWithTyVars</span></a></span></span><span> </span><span id="local-6989586621679698751"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679698751"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679698750"><span class="annot"><span class="annottext">THLocalVars
</span><a href="#local-6989586621679698750"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">THLocalVars
</span><a href="#local-6989586621679698750"><span class="hs-identifier hs-var">scope</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679698751"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- | Get all the named types which we depend on to define the current type.</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- Note that this relies on dependencies having been added with type synonyms</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- resolved!</span><span>
</span><span id="line-170"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#getTyConDeps"><span class="hs-identifier hs-type">getTyConDeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#Deps"><span class="hs-identifier hs-type">Deps</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span>
</span><span id="line-171"></span><span id="getTyConDeps"><span class="annot"><span class="annottext">getTyConDeps :: Deps -&gt; THLocalVars
</span><a href="PlutusTx.Lift.TH.html#getTyConDeps"><span class="hs-identifier hs-var hs-var">getTyConDeps</span></a></span></span><span> </span><span id="local-6989586621679698746"><span class="annot"><span class="annottext">Deps
</span><a href="#local-6989586621679698746"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Dep -&gt; Maybe Name
</span><a href="#local-6989586621679698743"><span class="hs-identifier hs-var">typeableDep</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Deps
</span><a href="#local-6989586621679698746"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-173"></span><span>        </span><span id="local-6989586621679698743"><span class="annot"><span class="annottext">typeableDep :: Dep -&gt; Maybe Name
</span><a href="#local-6989586621679698743"><span class="hs-identifier hs-var hs-var">typeableDep</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Lift.TH.html#TypeableDep"><span class="hs-identifier hs-type">TypeableDep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.ConT</span></a></span><span> </span><span id="local-6989586621679698740"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698740"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698740"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><a href="#local-6989586621679698743"><span class="hs-identifier hs-var">typeableDep</span></a></span><span> </span><span class="annot"><span class="annottext">Dep
</span><span class="hs-identifier">_</span></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#addTypeableDep"><span class="hs-identifier hs-type">addTypeableDep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THCompile"><span class="hs-identifier hs-type">THCompile</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span id="addTypeableDep"><span class="annot"><span class="annottext">addTypeableDep :: Pred -&gt; THCompile ()
</span><a href="PlutusTx.Lift.TH.html#addTypeableDep"><span class="hs-identifier hs-var hs-var">addTypeableDep</span></a></span></span><span> </span><span id="local-6989586621679698738"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698738"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621679698737"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698737"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pred -&gt; THCompile Pred
</span><a href="PlutusTx.Lift.TH.html#normalizeAndResolve"><span class="hs-identifier hs-var">normalizeAndResolve</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698738"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; Dep
</span><a href="PlutusTx.Lift.TH.html#TypeableDep"><span class="hs-identifier hs-var">TypeableDep</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698737"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#addLiftDep"><span class="hs-identifier hs-type">addLiftDep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THCompile"><span class="hs-identifier hs-type">THCompile</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span id="addLiftDep"><span class="annot"><span class="annottext">addLiftDep :: Pred -&gt; THCompile ()
</span><a href="PlutusTx.Lift.TH.html#addLiftDep"><span class="hs-identifier hs-var hs-var">addLiftDep</span></a></span></span><span> </span><span id="local-6989586621679698733"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698733"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621679698732"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698732"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pred -&gt; THCompile Pred
</span><a href="PlutusTx.Lift.TH.html#normalizeAndResolve"><span class="hs-identifier hs-var">normalizeAndResolve</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698733"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; Dep
</span><a href="PlutusTx.Lift.TH.html#LiftDep"><span class="hs-identifier hs-var">LiftDep</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698732"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">-- Constraints</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">-- | Make a 'Typeable' constraint.</span><span>
</span><span id="line-189"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#typeablePir"><span class="hs-identifier hs-type">typeablePir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-190"></span><span id="typeablePir"><span class="annot"><span class="annottext">typeablePir :: Pred -&gt; Pred -&gt; Pred
</span><a href="PlutusTx.Lift.TH.html#typeablePir"><span class="hs-identifier hs-var hs-var">typeablePir</span></a></span></span><span> </span><span id="local-6989586621679698730"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698730"><span class="hs-identifier hs-var">uni</span></a></span></span><span> </span><span id="local-6989586621679698729"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698729"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Pred] -&gt; Pred
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.classPred</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Typeable</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698730"><span class="hs-identifier hs-var">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698729"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-comment">-- | Make a 'Lift' constraint.</span><span>
</span><span id="line-193"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#liftPir"><span class="hs-identifier hs-type">liftPir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-194"></span><span id="liftPir"><span class="annot"><span class="annottext">liftPir :: Pred -&gt; Pred -&gt; Pred
</span><a href="PlutusTx.Lift.TH.html#liftPir"><span class="hs-identifier hs-var hs-var">liftPir</span></a></span></span><span> </span><span id="local-6989586621679698726"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698726"><span class="hs-identifier hs-var">uni</span></a></span></span><span> </span><span id="local-6989586621679698725"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698725"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Pred] -&gt; Pred
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.classPred</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Lift</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698726"><span class="hs-identifier hs-var">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698725"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#toConstraint"><span class="hs-identifier hs-type">toConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#Dep"><span class="hs-identifier hs-type">Dep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Pred</span></a></span><span>
</span><span id="line-197"></span><span id="toConstraint"><span class="annot"><span class="annottext">toConstraint :: Pred -&gt; Dep -&gt; Pred
</span><a href="PlutusTx.Lift.TH.html#toConstraint"><span class="hs-identifier hs-var hs-var">toConstraint</span></a></span></span><span> </span><span id="local-6989586621679698723"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698723"><span class="hs-identifier hs-var">uni</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><a href="PlutusTx.Lift.TH.html#TypeableDep"><span class="hs-identifier hs-type">TypeableDep</span></a></span><span> </span><span id="local-6989586621679698722"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698722"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pred -&gt; Pred -&gt; Pred
</span><a href="PlutusTx.Lift.TH.html#typeablePir"><span class="hs-identifier hs-var">typeablePir</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698723"><span class="hs-identifier hs-var">uni</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698722"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="PlutusTx.Lift.TH.html#LiftDep"><span class="hs-identifier hs-type">LiftDep</span></a></span><span> </span><span id="local-6989586621679698721"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698721"><span class="hs-identifier hs-var">ty</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pred -&gt; Pred -&gt; Pred
</span><a href="PlutusTx.Lift.TH.html#liftPir"><span class="hs-identifier hs-var">liftPir</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698723"><span class="hs-identifier hs-var">uni</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698721"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-comment">{- Note [Closed constraints]
There is no point adding constraints that are &quot;closed&quot;, i.e. don't mention any of the
instance type variables. These will either be satisfied by other instances in scope
(in which case GHC will complain at you), or be unsatisfied in which case the user will
get a useful error anyway.
-}</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#isClosedConstraint"><span class="hs-identifier hs-type">isClosedConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Pred</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-209"></span><span id="isClosedConstraint"><span class="annot"><span class="annottext">isClosedConstraint :: Pred -&gt; Bool
</span><a href="PlutusTx.Lift.TH.html#isClosedConstraint"><span class="hs-identifier hs-var hs-var">isClosedConstraint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; a -&gt; [Name]
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.freeVariables</span></a></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-comment">-- | Convenience wrapper around 'normalizeType' and 'TH.resolveTypeSynonyms'.</span><span>
</span><span id="line-212"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#normalizeAndResolve"><span class="hs-identifier hs-type">normalizeAndResolve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THCompile"><span class="hs-identifier hs-type">THCompile</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-213"></span><span id="normalizeAndResolve"><span class="annot"><span class="annottext">normalizeAndResolve :: Pred -&gt; THCompile Pred
</span><a href="PlutusTx.Lift.TH.html#normalizeAndResolve"><span class="hs-identifier hs-var hs-var">normalizeAndResolve</span></a></span></span><span> </span><span id="local-6989586621679698717"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698717"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pred -&gt; Pred
</span><a href="PlutusTx.Lift.THUtils.html#normalizeType"><span class="hs-identifier hs-var">normalizeType</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">Trans.lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">Trans.lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">Trans.lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; Q Pred
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.resolveTypeSynonyms</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698717"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-comment">-- See Note [Ordering of constructors]</span><span>
</span><span id="line-216"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#sortedCons"><span class="hs-identifier hs-type">sortedCons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TH.DatatypeInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TH.ConstructorInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-217"></span><span id="sortedCons"><span class="annot"><span class="annottext">sortedCons :: DatatypeInfo -&gt; [ConstructorInfo]
</span><a href="PlutusTx.Lift.TH.html#sortedCons"><span class="hs-identifier hs-var hs-var">sortedCons</span></a></span></span><span> </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TH.DatatypeInfo</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">datatypeName :: DatatypeInfo -&gt; Name
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.datatypeName</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679698710"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698710"><span class="hs-identifier hs-var">tyName</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">datatypeCons :: DatatypeInfo -&gt; [ConstructorInfo]
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.datatypeCons</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679698708"><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679698708"><span class="hs-identifier hs-var">cons</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-comment">-- We need to compare 'TH.Name's on their string name *not* on the unique</span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679698705"><span class="annot"><span class="annottext">sorted :: [ConstructorInfo]
</span><a href="#local-6989586621679698705"><span class="hs-identifier hs-var hs-var">sorted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstructorInfo -&gt; Name
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.constructorName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span id="local-6989586621679698702"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621679698702"><span class="hs-identifier hs-var">o1</span></a></span></span><span> </span><span class="annot"><span class="annottext">NameFlavour
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstructorInfo -&gt; Name
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.constructorName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span id="local-6989586621679698701"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621679698701"><span class="hs-identifier hs-var">o2</span></a></span></span><span> </span><span class="annot"><span class="annottext">NameFlavour
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">compare</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621679698702"><span class="hs-identifier hs-var">o1</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621679698701"><span class="hs-identifier hs-var">o2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679698708"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698710"><span class="hs-identifier hs-var">tyName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Bool</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698710"><span class="hs-identifier hs-var">tyName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679698705"><span class="hs-identifier hs-var">sorted</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679698705"><span class="hs-identifier hs-var">sorted</span></a></span><span class="hs-cpp">

#if MIN_VERSION_template_haskell(2,17,0)
</span><span class="annot"><a href="PlutusTx.Lift.TH.html#tvNameAndKind"><span class="hs-identifier hs-type">tvNameAndKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.TyVarBndrUnit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THCompile"><span class="hs-identifier hs-type">THCompile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span id="tvNameAndKind"><span class="annot"><span class="annottext">tvNameAndKind :: TyVarBndrUnit -&gt; THCompile (Name, Kind ())
</span><a href="PlutusTx.Lift.TH.html#tvNameAndKind"><span class="hs-identifier hs-var hs-var">tvNameAndKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.KindedTV</span></a></span><span> </span><span id="local-6989586621679698695"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698695"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679698694"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698694"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-226"></span><span>        </span><span id="local-6989586621679698693"><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621679698693"><span class="hs-identifier hs-var">kind'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pred -&gt; THCompile (Kind ())
</span><a href="PlutusTx.Lift.TH.html#compileKind"><span class="hs-identifier hs-var">compileKind</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;=&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; THCompile Pred
</span><a href="PlutusTx.Lift.TH.html#normalizeAndResolve"><span class="hs-identifier hs-var">normalizeAndResolve</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698694"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-227"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698695"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621679698693"><span class="hs-identifier hs-var">kind'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-comment">-- TODO: is this what PlainTV actually means? That it's of kind Type?</span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.PlainTV</span></a></span><span> </span><span id="local-6989586621679698689"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698689"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698689"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall ann. ann -&gt; Kind ann
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-identifier">tvNameAndKind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">TH.TyVarBndr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">THCompile</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TH.Name</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Kind</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span class="hs-identifier">tvNameAndKind</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-identifier">TH.KindedTV</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">kind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-identifier">kind'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">compileKind</span><span> </span><span class="hs-operator">&lt;=&lt;</span><span> </span><span class="hs-identifier">normalizeAndResolve</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">kind</span><span>
</span><span id="line-235"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">name</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">kind'</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-comment">-- TODO: is this what PlainTV actually means? That it's of kind Type?</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-identifier">TH.PlainTV</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">name</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-240"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-241"></span><span class="hs-comment">-- Types and kinds</span><span>
</span><span id="line-242"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-comment">-- Note: we can actually do this entirely at TH-time, which is nice</span><span>
</span><span id="line-245"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#compileKind"><span class="hs-identifier hs-type">compileKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THCompile"><span class="hs-identifier hs-type">THCompile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span id="compileKind"><span class="annot"><span class="annottext">compileKind :: Pred -&gt; THCompile (Kind ())
</span><a href="PlutusTx.Lift.TH.html#compileKind"><span class="hs-identifier hs-var hs-var">compileKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><span class="annottext">Pred
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.StarT</span></a></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall ann. ann -&gt; Kind ann
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.AppT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.AppT</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.ArrowT</span></a></span><span> </span><span id="local-6989586621679698684"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698684"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679698683"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698683"><span class="hs-identifier hs-var">k2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall ann. ann -&gt; Kind ann -&gt; Kind ann -&gt; Kind ann
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">KindArrow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; THCompile (Kind ())
</span><a href="PlutusTx.Lift.TH.html#compileKind"><span class="hs-identifier hs-var">compileKind</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698684"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; THCompile (Kind ())
</span><a href="PlutusTx.Lift.TH.html#compileKind"><span class="hs-identifier hs-var">compileKind</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698683"><span class="hs-identifier hs-var">k2</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621679698681"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698681"><span class="hs-identifier hs-var">k</span></a></span></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; LiftError
</span><a href="PlutusTx.Lift.TH.html#UnsupportedLiftKind"><span class="hs-identifier hs-var">UnsupportedLiftKind</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698681"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#compileType"><span class="hs-identifier hs-type">compileType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THCompile"><span class="hs-identifier hs-type">THCompile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.TExpQ</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#CompileTypeScope"><span class="hs-identifier hs-type">CompileTypeScope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span id="compileType"><span class="annot"><span class="annottext">compileType :: Pred -&gt; THCompile (TExpQ CompileTypeScope)
</span><a href="PlutusTx.Lift.TH.html#compileType"><span class="hs-identifier hs-var hs-var">compileType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-253"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.AppT</span></a></span><span> </span><span id="local-6989586621679698678"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698678"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679698677"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698677"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-254"></span><span>        </span><span id="local-6989586621679698676"><span class="annot"><span class="annottext">TExpQ CompileTypeScope
</span><a href="#local-6989586621679698676"><span class="hs-identifier hs-var">t1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pred -&gt; THCompile (TExpQ CompileTypeScope)
</span><a href="PlutusTx.Lift.TH.html#compileType"><span class="hs-identifier hs-var">compileType</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698678"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-255"></span><span>        </span><span id="local-6989586621679698675"><span class="annot"><span class="annottext">TExpQ CompileTypeScope
</span><a href="#local-6989586621679698675"><span class="hs-identifier hs-var">t2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pred -&gt; THCompile (TExpQ CompileTypeScope)
</span><a href="PlutusTx.Lift.TH.html#compileType"><span class="hs-identifier hs-var">compileType</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698677"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Splice m a -&gt; m (TExp a)
</span><a href="../../../../th-compat/html/src"><span class="hs-identifier hs-var">TH.examineSplice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-identifier">CompileTypeScope</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TyApp</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">unCompileTypeScope</span><span> </span><span class="hs-special">(</span><span class="hs-special">$$</span><span class="hs-special">(</span><span class="hs-identifier">TH.liftSplice</span><span> </span><span class="hs-identifier">t1'</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-identifier">unCompileTypeScope</span><span> </span><span class="hs-special">(</span><span class="hs-special">$$</span><span class="hs-special">(</span><span class="hs-identifier">TH.liftSplice</span><span> </span><span class="hs-identifier">t2'</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">||]</span><span>
</span><span id="line-257"></span><span>    </span><span id="local-6989586621679698673"><span class="annot"><span class="annottext">t :: Pred
</span><a href="#local-6989586621679698673"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.ConT</span></a></span><span> </span><span id="local-6989586621679698672"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698672"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pred -&gt; Name -&gt; THCompile (TExpQ CompileTypeScope)
</span><a href="PlutusTx.Lift.TH.html#compileTypeableType"><span class="hs-identifier hs-var">compileTypeableType</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698673"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698672"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-comment">-- See note [Type variables]</span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621679698670"><span class="annot"><span class="annottext">t :: Pred
</span><a href="#local-6989586621679698670"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.VarT</span></a></span><span> </span><span id="local-6989586621679698668"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698668"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-260"></span><span>        </span><span id="local-6989586621679698667"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679698667"><span class="hs-identifier hs-var">isLocal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.member</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698668"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679698667"><span class="hs-identifier hs-var">isLocal</span></a></span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Splice m a -&gt; m (TExp a)
</span><a href="../../../../th-compat/html/src"><span class="hs-identifier hs-var">TH.examineSplice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[||</span><span>
</span><span id="line-263"></span><span>              </span><span class="hs-identifier">CompileTypeScope</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-264"></span><span>                  </span><span class="hs-identifier">vars</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ask</span><span>
</span><span id="line-265"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">Map.lookup</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">vars</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-266"></span><span>                      </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">ty</span><span>
</span><span id="line-267"></span><span>                      </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Prelude.throw</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">LiftMissingVar</span><span> </span><span class="hs-identifier">name</span><span>
</span><span id="line-268"></span><span>             </span><span class="hs-special">||]</span><span>
</span><span id="line-269"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Pred -&gt; Name -&gt; THCompile (TExpQ CompileTypeScope)
</span><a href="PlutusTx.Lift.TH.html#compileTypeableType"><span class="hs-identifier hs-var">compileTypeableType</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698670"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698668"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span id="local-6989586621679698664"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698664"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; LiftError
</span><a href="PlutusTx.Lift.TH.html#UnsupportedLiftType"><span class="hs-identifier hs-var">UnsupportedLiftType</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698664"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="hs-comment">-- | Compile a type with the given name using 'typeRep' and incurring a corresponding 'Typeable' dependency.</span><span>
</span><span id="line-273"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#compileTypeableType"><span class="hs-identifier hs-type">compileTypeableType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THCompile"><span class="hs-identifier hs-type">THCompile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.TExpQ</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#CompileTypeScope"><span class="hs-identifier hs-type">CompileTypeScope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span id="compileTypeableType"><span class="annot"><span class="annottext">compileTypeableType :: Pred -&gt; Name -&gt; THCompile (TExpQ CompileTypeScope)
</span><a href="PlutusTx.Lift.TH.html#compileTypeableType"><span class="hs-identifier hs-var hs-var">compileTypeableType</span></a></span></span><span> </span><span id="local-6989586621679698663"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698663"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621679698662"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698662"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><span class="annottext">Pred -&gt; THCompile ()
</span><a href="PlutusTx.Lift.TH.html#addTypeableDep"><span class="hs-identifier hs-var">addTypeableDep</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698663"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-comment">-- We need the `unsafeTExpCoerce` since this will necessarily involve</span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-comment">-- types we don't know now: the type which this instance is for (which</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-comment">-- appears in the proxy argument). However, since we know the type of</span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-comment">-- `typeRep` we can get back into typed land quickly.</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679698661"><span class="hs-identifier hs-type">trep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.TExpQ</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#CompileType"><span class="hs-identifier hs-type">CompileType</span></a></span><span>
</span><span id="line-281"></span><span>        </span><span id="local-6989586621679698661"><span class="annot"><span class="annottext">trep :: TExpQ CompileType
</span><a href="#local-6989586621679698661"><span class="hs-identifier hs-var hs-var">trep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *). Quote m =&gt; m Exp -&gt; m (TExp a)
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.unsafeTExpCoerce</span></a></span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-identifier">CompileType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">typeRep</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Splice m a -&gt; m (TExp a)
</span><a href="../../../../th-compat/html/src"><span class="hs-identifier hs-var">TH.examineSplice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[||</span><span>
</span><span id="line-283"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">trep'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">RTCompileScope</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Type</span><span> </span><span class="hs-identifier">TyName</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>              </span><span class="hs-identifier">trep'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Trans.lift</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">unCompileType</span><span> </span><span class="hs-special">(</span><span class="hs-special">$$</span><span class="hs-special">(</span><span class="hs-identifier">TH.liftSplice</span><span> </span><span class="hs-identifier">trep</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">CompileTypeScope</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-286"></span><span>              </span><span class="hs-identifier">maybeType</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">lookupType</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">name</span><span>
</span><span id="line-287"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">maybeType</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-288"></span><span>                  </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">t</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">t</span><span>
</span><span id="line-289"></span><span>                  </span><span class="hs-comment">-- this will need some additional constraints in scope</span><span>
</span><span id="line-290"></span><span>                  </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">trep'</span><span>
</span><span id="line-291"></span><span>          </span><span class="hs-special">||]</span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">-- Just here so we can pin down the type variables without using TypeApplications in the generated code</span><span>
</span><span id="line-294"></span><span id="local-6989586621679699201"><span class="annot"><a href="PlutusTx.Lift.TH.html#recordAlias%27"><span class="hs-identifier hs-type">recordAlias'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#RTCompileScope"><span class="hs-identifier hs-type">RTCompileScope</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">PLC.DefaultUni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699201"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-295"></span><span id="recordAlias%27"><span class="annot"><span class="annottext">recordAlias' :: forall fun. Name -&gt; RTCompileScope DefaultUni fun ()
</span><a href="PlutusTx.Lift.TH.html#recordAlias%27"><span class="hs-identifier hs-var hs-var">recordAlias'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall key (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadDefs key uni fun ann m =&gt;
key -&gt; m ()
</span><span class="hs-identifier hs-var">recordAlias</span></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="hs-comment">-- Just here so we can pin down the type variables without using TypeApplications in the generated code</span><span>
</span><span id="line-298"></span><span id="local-6989586621679699187"><span class="annot"><a href="PlutusTx.Lift.TH.html#defineDatatype%27"><span class="hs-identifier hs-type">defineDatatype'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DatatypeDef</span></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">PLC.DefaultUni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#RTCompileScope"><span class="hs-identifier hs-type">RTCompileScope</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">PLC.DefaultUni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699187"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-299"></span><span id="defineDatatype%27"><span class="annot"><span class="annottext">defineDatatype' :: forall fun.
Name
-&gt; DatatypeDef TyName Name DefaultUni ()
-&gt; THLocalVars
-&gt; RTCompileScope DefaultUni fun ()
</span><a href="PlutusTx.Lift.TH.html#defineDatatype%27"><span class="hs-identifier hs-var hs-var">defineDatatype'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall key (uni :: * -&gt; *) fun ann (m :: * -&gt; *).
MonadDefs key uni fun ann m =&gt;
key -&gt; DatatypeDef TyName Name uni ann -&gt; Set key -&gt; m ()
</span><span class="hs-identifier hs-var">defineDatatype</span></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-comment">-- TODO: there is an unpleasant amount of duplication between this and the main compiler, but</span><span>
</span><span id="line-302"></span><span class="hs-comment">-- I'm not sure how to unify them better</span><span>
</span><span id="line-303"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#compileTypeRep"><span class="hs-identifier hs-type">compileTypeRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TH.DatatypeInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THCompile"><span class="hs-identifier hs-type">THCompile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.TExpQ</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#CompileType"><span class="hs-identifier hs-type">CompileType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span id="compileTypeRep"><span class="annot"><span class="annottext">compileTypeRep :: DatatypeInfo -&gt; THCompile (TExpQ CompileType)
</span><a href="PlutusTx.Lift.TH.html#compileTypeRep"><span class="hs-identifier hs-var hs-var">compileTypeRep</span></a></span></span><span> </span><span id="local-6989586621679698649"><span class="annot"><span class="annottext">dt :: DatatypeInfo
</span><a href="#local-6989586621679698649"><span class="hs-identifier hs-var">dt</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TH.DatatypeInfo</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">datatypeName :: DatatypeInfo -&gt; Name
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.datatypeName</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679698648"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698648"><span class="hs-identifier hs-var">tyName</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">datatypeVars :: DatatypeInfo -&gt; [TyVarBndrUnit]
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.datatypeVars</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679698646"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679698646"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-305"></span><span>    </span><span id="local-6989586621679698645"><span class="annot"><span class="annottext">[(Name, Kind ())]
</span><a href="#local-6989586621679698645"><span class="hs-identifier hs-var">tvNamesAndKinds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; THCompile (Name, Kind ())
</span><a href="PlutusTx.Lift.TH.html#tvNameAndKind"><span class="hs-identifier hs-var">tvNameAndKind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679698646"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-comment">-- annoyingly th-abstraction doesn't give us a kind we can compile here</span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679698642"><span class="annot"><span class="annottext">typeKind :: Kind ()
</span><a href="#local-6989586621679698642"><span class="hs-identifier hs-var hs-var">typeKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679698641"><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621679698641"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679698640"><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621679698640"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall ann. ann -&gt; Kind ann -&gt; Kind ann -&gt; Kind ann
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">KindArrow</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621679698641"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621679698640"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall ann. ann -&gt; Kind ann
</span><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, Kind ())]
</span><a href="#local-6989586621679698645"><span class="hs-identifier hs-var">tvNamesAndKinds</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679698639"><span class="annot"><span class="annottext">cons :: [ConstructorInfo]
</span><a href="#local-6989586621679698639"><span class="hs-identifier hs-var hs-var">cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DatatypeInfo -&gt; [ConstructorInfo]
</span><a href="PlutusTx.Lift.TH.html#sortedCons"><span class="hs-identifier hs-var">sortedCons</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679698649"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadReader THLocalVars m =&gt;
[Name] -&gt; m a -&gt; m a
</span><a href="PlutusTx.Lift.TH.html#thWithTyVars"><span class="hs-identifier hs-var">thWithTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Kind ())]
</span><a href="#local-6989586621679698645"><span class="hs-identifier hs-var">tvNamesAndKinds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DatatypeInfo -&gt; Bool
</span><a href="PlutusTx.Lift.THUtils.html#isNewtype"><span class="hs-identifier hs-var">isNewtype</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679698649"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-312"></span><span>        </span><span class="hs-comment">-- Extract the unique field of the unique constructor</span><span>
</span><span id="line-313"></span><span>        </span><span id="local-6989586621679698637"><span class="annot"><span class="annottext">TExpQ CompileTypeScope
</span><a href="#local-6989586621679698637"><span class="hs-identifier hs-var">argTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679698639"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-314"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TH.ConstructorInfo</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">constructorFields :: ConstructorInfo -&gt; [Pred]
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.constructorFields</span></a></span><span class="hs-glyph">=</span><span class="hs-special">[</span><span id="local-6989586621679698634"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698634"><span class="hs-identifier hs-var">argTy</span></a></span></span><span class="hs-special">]</span><span class="hs-special">}</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pred -&gt; THCompile (TExpQ CompileTypeScope)
</span><a href="PlutusTx.Lift.TH.html#compileType"><span class="hs-identifier hs-var">compileType</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;=&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; THCompile Pred
</span><a href="PlutusTx.Lift.TH.html#normalizeAndResolve"><span class="hs-identifier hs-var">normalizeAndResolve</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698634"><span class="hs-identifier hs-var">argTy</span></a></span><span>
</span><span id="line-315"></span><span>            </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; LiftError
</span><a href="PlutusTx.Lift.TH.html#UserLiftError"><span class="hs-identifier hs-var">UserLiftError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Newtypes must have a single constructor with a single argument&quot;</span></span><span>
</span><span id="line-316"></span><span>        </span><span id="local-6989586621679698633"><span class="annot"><span class="annottext">THLocalVars
</span><a href="#local-6989586621679698633"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Deps -&gt; THLocalVars
</span><a href="PlutusTx.Lift.TH.html#getTyConDeps"><span class="hs-identifier hs-var">getTyConDeps</span></a></span><span>
</span><span id="line-317"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Splice m a -&gt; m (TExp a)
</span><a href="../../../../th-compat/html/src"><span class="hs-identifier hs-var">TH.examineSplice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[||</span><span>
</span><span id="line-318"></span><span>            </span><span class="hs-keyword">let</span><span>
</span><span id="line-319"></span><span>                </span><span class="hs-identifier">argTy'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">RTCompileScope</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Type</span><span> </span><span class="hs-identifier">TyName</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>                </span><span class="hs-identifier">argTy'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unCompileTypeScope</span><span> </span><span class="hs-special">$$</span><span class="hs-special">(</span><span class="hs-identifier">TH.liftSplice</span><span> </span><span class="hs-identifier">argTy</span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>                </span><span class="hs-identifier">act</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">RTCompileScope</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Type</span><span> </span><span class="hs-identifier">TyName</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>                </span><span class="hs-identifier">act</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-323"></span><span>                    </span><span class="hs-identifier">maybeDefined</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">lookupType</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tyName</span><span>
</span><span id="line-324"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">maybeDefined</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-325"></span><span>                        </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">ty</span><span>
</span><span id="line-326"></span><span>                        </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-327"></span><span>                            </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dtvd</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mkTyVarDecl</span><span> </span><span class="hs-identifier">tyName</span><span> </span><span class="hs-identifier">typeKind</span><span>
</span><span id="line-328"></span><span>                            </span><span class="hs-identifier">tvds</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">traverse</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">uncurry</span><span> </span><span class="hs-identifier">mkTyVarDecl</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tvNamesAndKinds</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>                            </span><span class="hs-identifier">alias</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withTyVars</span><span> </span><span class="hs-identifier">tvds</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">mkIterTyLam</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fmap</span><span> </span><span class="hs-identifier">snd</span><span> </span><span class="hs-identifier">tvds</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">argTy'</span><span>
</span><span id="line-331"></span><span>                            </span><span class="hs-identifier">defineType</span><span> </span><span class="hs-identifier">tyName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PLC.Def</span><span> </span><span class="hs-identifier">dtvd</span><span> </span><span class="hs-identifier">alias</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">deps</span><span>
</span><span id="line-332"></span><span>                            </span><span class="hs-identifier">recordAlias'</span><span> </span><span class="hs-identifier">tyName</span><span>
</span><span id="line-333"></span><span>                            </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">alias</span><span>
</span><span id="line-334"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">CompileType</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">runReaderT</span><span> </span><span class="hs-identifier">act</span><span> </span><span class="hs-identifier">mempty</span><span>
</span><span id="line-335"></span><span>         </span><span class="hs-special">||]</span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>        </span><span id="local-6989586621679698631"><span class="annot"><span class="annottext">[TExpQ CompileDeclFun]
</span><a href="#local-6989586621679698631"><span class="hs-identifier hs-var">constrExprs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorInfo -&gt; THCompile (TExpQ CompileDeclFun)
</span><a href="PlutusTx.Lift.TH.html#compileConstructorDecl"><span class="hs-identifier hs-var">compileConstructorDecl</span></a></span><span> </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679698639"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-338"></span><span>        </span><span id="local-6989586621679698629"><span class="annot"><span class="annottext">THLocalVars
</span><a href="#local-6989586621679698629"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Deps -&gt; THLocalVars
</span><a href="PlutusTx.Lift.TH.html#getTyConDeps"><span class="hs-identifier hs-var">getTyConDeps</span></a></span><span>
</span><span id="line-339"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Splice m a -&gt; m (TExp a)
</span><a href="../../../../th-compat/html/src"><span class="hs-identifier hs-var">TH.examineSplice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[||</span><span>
</span><span id="line-340"></span><span>          </span><span class="hs-keyword">let</span><span>
</span><span id="line-341"></span><span>              </span><span class="hs-identifier">constrExprs'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">CompileDeclFun</span><span class="hs-special">]</span><span>
</span><span id="line-342"></span><span>              </span><span class="hs-identifier">constrExprs'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$$</span><span class="hs-special">(</span><span class="hs-identifier">TH.liftSplice</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyListE</span><span> </span><span class="hs-identifier">constrExprs</span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>              </span><span class="hs-identifier">act</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">RTCompileScope</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Type</span><span> </span><span class="hs-identifier">TyName</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>              </span><span class="hs-identifier">act</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span>                </span><span class="hs-identifier">maybeDefined</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">lookupType</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tyName</span><span>
</span><span id="line-346"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">maybeDefined</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-347"></span><span>                    </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">ty</span><span>
</span><span id="line-348"></span><span>                    </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-349"></span><span>                        </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dtvd</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mkTyVarDecl</span><span> </span><span class="hs-identifier">tyName</span><span> </span><span class="hs-identifier">typeKind</span><span>
</span><span id="line-350"></span><span>                        </span><span class="hs-identifier">tvds</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">traverse</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">uncurry</span><span> </span><span class="hs-identifier">mkTyVarDecl</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tvNamesAndKinds</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">resultType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mkIterTyApp</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mkTyVar</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">dtvd</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mkTyVar</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">snd</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tvds</span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>                        </span><span class="hs-identifier">matchName</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">safeFreshName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">T.pack</span><span> </span><span class="hs-string">&quot;match_&quot;</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">showName</span><span> </span><span class="hs-identifier">tyName</span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>                        </span><span class="hs-comment">-- See Note [Occurrences of recursive names]</span><span>
</span><span id="line-356"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">fakeDatatype</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Datatype</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">dtvd</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">matchName</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span>                        </span><span class="hs-identifier">defineDatatype'</span><span> </span><span class="hs-identifier">tyName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PLC.Def</span><span> </span><span class="hs-identifier">dtvd</span><span> </span><span class="hs-identifier">fakeDatatype</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Set.empty</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>                        </span><span class="hs-identifier">withTyVars</span><span> </span><span class="hs-identifier">tvds</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-361"></span><span>                            </span><span class="hs-comment">-- The TH expressions are in fact all functions that take the result type, so</span><span>
</span><span id="line-362"></span><span>                            </span><span class="hs-comment">-- we need to apply them</span><span>
</span><span id="line-363"></span><span>                            </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">constrActs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">RTCompileScope</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">VarDecl</span><span> </span><span class="hs-identifier">TyName</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-364"></span><span>                                </span><span class="hs-identifier">constrActs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sequence</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unCompileDeclFun</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">constrExprs'</span><span> </span><span class="hs-operator">&lt;*&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">resultType</span><span class="hs-special">]</span><span>
</span><span id="line-365"></span><span>                            </span><span class="hs-identifier">constrs</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">constrActs</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>                            </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">datatype</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Datatype</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">dtvd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fmap</span><span> </span><span class="hs-identifier">snd</span><span> </span><span class="hs-identifier">tvds</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">matchName</span><span> </span><span class="hs-identifier">constrs</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>                            </span><span class="hs-identifier">defineDatatype</span><span> </span><span class="hs-identifier">tyName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PLC.Def</span><span> </span><span class="hs-identifier">dtvd</span><span> </span><span class="hs-identifier">datatype</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">deps</span><span>
</span><span id="line-370"></span><span>                        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">mkTyVar</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">dtvd</span><span>
</span><span id="line-371"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">CompileType</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">runReaderT</span><span> </span><span class="hs-identifier">act</span><span> </span><span class="hs-identifier">mempty</span><span>
</span><span id="line-372"></span><span>          </span><span class="hs-special">||]</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#compileConstructorDecl"><span class="hs-identifier hs-type">compileConstructorDecl</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TH.ConstructorInfo</span></a></span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THCompile"><span class="hs-identifier hs-type">THCompile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.TExpQ</span></a></span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#CompileDeclFun"><span class="hs-identifier hs-type">CompileDeclFun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span id="compileConstructorDecl"><span class="annot"><span class="annottext">compileConstructorDecl :: ConstructorInfo -&gt; THCompile (TExpQ CompileDeclFun)
</span><a href="PlutusTx.Lift.TH.html#compileConstructorDecl"><span class="hs-identifier hs-var hs-var">compileConstructorDecl</span></a></span></span><span> </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TH.ConstructorInfo</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">constructorName :: ConstructorInfo -&gt; Name
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.constructorName</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679698628"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698628"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">constructorFields :: ConstructorInfo -&gt; [Pred]
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.constructorFields</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679698627"><span class="annot"><span class="annottext">[Pred]
</span><a href="#local-6989586621679698627"><span class="hs-identifier hs-var">argTys</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-378"></span><span>    </span><span id="local-6989586621679698626"><span class="annot"><span class="annottext">[TExpQ CompileTypeScope]
</span><a href="#local-6989586621679698626"><span class="hs-identifier hs-var">tyExprs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pred -&gt; THCompile (TExpQ CompileTypeScope)
</span><a href="PlutusTx.Lift.TH.html#compileType"><span class="hs-identifier hs-var">compileType</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;=&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; THCompile Pred
</span><a href="PlutusTx.Lift.TH.html#normalizeAndResolve"><span class="hs-identifier hs-var">normalizeAndResolve</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Pred]
</span><a href="#local-6989586621679698627"><span class="hs-identifier hs-var">argTys</span></a></span><span>
</span><span id="line-379"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Splice m a -&gt; m (TExp a)
</span><a href="../../../../th-compat/html/src"><span class="hs-identifier hs-var">TH.examineSplice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[||</span><span>
</span><span id="line-380"></span><span>         </span><span class="hs-keyword">let</span><span>
</span><span id="line-381"></span><span>             </span><span class="hs-identifier">tyExprs'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">RTCompileScope</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Type</span><span> </span><span class="hs-identifier">TyName</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-382"></span><span>             </span><span class="hs-identifier">tyExprs'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unCompileTypeScope</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span> </span><span class="hs-special">$$</span><span class="hs-special">(</span><span class="hs-identifier">TH.liftSplice</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyListE</span><span> </span><span class="hs-identifier">tyExprs</span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>          </span><span class="hs-comment">-- we won't know the result type until runtime, so take it as an argument</span><span>
</span><span id="line-384"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">CompileDeclFun</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">resultType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-385"></span><span>              </span><span class="hs-identifier">tys'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">sequence</span><span> </span><span class="hs-identifier">tyExprs'</span><span>
</span><span id="line-386"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">constrTy</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mkIterTyFun</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tys'</span><span> </span><span class="hs-identifier">resultType</span><span>
</span><span id="line-387"></span><span>              </span><span class="hs-identifier">constrName</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">safeFreshName</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">showName</span><span> </span><span class="hs-identifier">name</span><span>
</span><span id="line-388"></span><span>              </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">VarDecl</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">constrName</span><span> </span><span class="hs-identifier">constrTy</span><span>
</span><span id="line-389"></span><span>          </span><span class="hs-special">||]</span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#makeTypeable"><span class="hs-identifier hs-type">makeTypeable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-392"></span><span id="makeTypeable"><span class="annot"><span class="annottext">makeTypeable :: Pred -&gt; Name -&gt; Q [Dec]
</span><a href="PlutusTx.Lift.TH.html#makeTypeable"><span class="hs-identifier hs-var hs-var">makeTypeable</span></a></span></span><span> </span><span id="local-6989586621679698625"><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698625"><span class="hs-identifier hs-var">uni</span></a></span></span><span> </span><span id="local-6989586621679698624"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698624"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-393"></span><span>    </span><span class="annot"><span class="annottext">Extension -&gt; Q ()
</span><a href="PlutusTx.Lift.THUtils.html#requireExtension"><span class="hs-identifier hs-var">requireExtension</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../../../ghc/html/libraries/ghc-boot-th-9.2.5/src"><span class="hs-identifier hs-var">TH.ScopedTypeVariables</span></a></span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span>    </span><span id="local-6989586621679698621"><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679698621"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Q DatatypeInfo
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.reifyDatatype</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698624"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679698619"><span class="annot"><span class="annottext">TExpQ CompileType
</span><a href="#local-6989586621679698619"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679698618"><span class="annot"><span class="annottext">Deps
</span><a href="#local-6989586621679698618"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. THCompile a -&gt; Q (a, Deps)
</span><a href="PlutusTx.Lift.TH.html#runTHCompile"><span class="hs-identifier hs-var">runTHCompile</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo -&gt; THCompile (TExpQ CompileType)
</span><a href="PlutusTx.Lift.TH.html#compileTypeRep"><span class="hs-identifier hs-var">compileTypeRep</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679698621"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-comment">-- See Note [Closed constraints]</span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679698615"><span class="annot"><span class="annottext">constraints :: [Pred]
</span><a href="#local-6989586621679698615"><span class="hs-identifier hs-var hs-var">constraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; Bool
</span><a href="PlutusTx.Lift.TH.html#isClosedConstraint"><span class="hs-identifier hs-var">isClosedConstraint</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; Dep -&gt; Pred
</span><a href="PlutusTx.Lift.TH.html#toConstraint"><span class="hs-identifier hs-var">toConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698625"><span class="hs-identifier hs-var">uni</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Deps
</span><a href="#local-6989586621679698618"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-comment">-- We need to unwrap the wrapper at the last minute, see Note [Impredicative function universe wrappers]</span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679698610"><span class="annot"><span class="annottext">unwrappedRhs :: Q Exp
</span><a href="#local-6989586621679698610"><span class="hs-identifier hs-var hs-var">unwrappedRhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-identifier">unCompileType</span><span> </span><span class="hs-special">|]</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; m Exp -&gt; m Exp -&gt; m Exp
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-operator hs-var">`TH.appE`</span></a></span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *). Quote m =&gt; m (TExp a) -&gt; m Exp
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.unTypeQ</span></a></span><span> </span><span class="annot"><span class="annottext">TExpQ CompileType
</span><a href="#local-6989586621679698619"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>    </span><span id="local-6989586621679698608"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679698608"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; [m Clause] -&gt; m Dec
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.funD</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">typeRep</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Quote m =&gt;
[m Pat] -&gt; m Body -&gt; [m Dec] -&gt; m Clause
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.clause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; m Pat
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.wildP</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; m Exp -&gt; m Body
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.normalB</span></a></span><span> </span><span class="annot"><span class="annottext">Q Exp
</span><a href="#local-6989586621679698610"><span class="hs-identifier hs-var">unwrappedRhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-404"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Maybe Overlap -&gt; [Pred] -&gt; Pred -&gt; [Dec] -&gt; Dec
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.InstanceD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">[Pred]
</span><a href="#local-6989586621679698615"><span class="hs-identifier hs-var">constraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pred -&gt; Pred -&gt; Pred
</span><a href="PlutusTx.Lift.TH.html#typeablePir"><span class="hs-identifier hs-var">typeablePir</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698625"><span class="hs-identifier hs-var">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Pred
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698624"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679698608"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#compileLift"><span class="hs-identifier hs-type">compileLift</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TH.DatatypeInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THCompile"><span class="hs-identifier hs-type">THCompile</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Clause</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-407"></span><span id="compileLift"><span class="annot"><span class="annottext">compileLift :: DatatypeInfo -&gt; THCompile [Q Clause]
</span><a href="PlutusTx.Lift.TH.html#compileLift"><span class="hs-identifier hs-var hs-var">compileLift</span></a></span></span><span> </span><span id="local-6989586621679698605"><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679698605"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DatatypeInfo -&gt; Int -&gt; ConstructorInfo -&gt; THCompile (Q Clause)
</span><a href="PlutusTx.Lift.TH.html#compileConstructorClause"><span class="hs-identifier hs-var">compileConstructorClause</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679698605"><span class="hs-identifier hs-var">dt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DatatypeInfo -&gt; [ConstructorInfo]
</span><a href="PlutusTx.Lift.TH.html#sortedCons"><span class="hs-identifier hs-var">sortedCons</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679698605"><span class="hs-identifier hs-var">dt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#compileConstructorClause"><span class="hs-identifier hs-type">compileConstructorClause</span></a></span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TH.DatatypeInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TH.ConstructorInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THCompile"><span class="hs-identifier hs-type">THCompile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Clause</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span id="compileConstructorClause"><span class="annot"><span class="annottext">compileConstructorClause :: DatatypeInfo -&gt; Int -&gt; ConstructorInfo -&gt; THCompile (Q Clause)
</span><a href="PlutusTx.Lift.TH.html#compileConstructorClause"><span class="hs-identifier hs-var hs-var">compileConstructorClause</span></a></span></span><span> </span><span id="local-6989586621679698602"><span class="annot"><span class="annottext">dt :: DatatypeInfo
</span><a href="#local-6989586621679698602"><span class="hs-identifier hs-var">dt</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TH.DatatypeInfo</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">datatypeName :: DatatypeInfo -&gt; Name
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.datatypeName</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679698601"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698601"><span class="hs-identifier hs-var">tyName</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">datatypeVars :: DatatypeInfo -&gt; [TyVarBndrUnit]
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.datatypeVars</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679698600"><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679698600"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679698599"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679698599"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TH.ConstructorInfo</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">constructorName :: ConstructorInfo -&gt; Name
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.constructorName</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679698598"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698598"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">constructorFields :: ConstructorInfo -&gt; [Pred]
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.constructorFields</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621679698597"><span class="annot"><span class="annottext">[Pred]
</span><a href="#local-6989586621679698597"><span class="hs-identifier hs-var">argTys</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-comment">-- need to be able to lift the argument types</span><span>
</span><span id="line-413"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">traverse_</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; THCompile ()
</span><a href="PlutusTx.Lift.TH.html#addLiftDep"><span class="hs-identifier hs-var">addLiftDep</span></a></span><span> </span><span class="annot"><span class="annottext">[Pred]
</span><a href="#local-6989586621679698597"><span class="hs-identifier hs-var">argTys</span></a></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span>    </span><span class="hs-comment">-- We need the actual type parameters for the non-newtype case, and we have to do</span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-comment">-- it out here, but it will give us redundant constraints in the newtype case,</span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-comment">-- so we fudge it.</span><span>
</span><span id="line-418"></span><span>    </span><span id="local-6989586621679698595"><span class="annot"><span class="annottext">[TExpQ CompileTypeScope]
</span><a href="#local-6989586621679698595"><span class="hs-identifier hs-var">tyExprs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DatatypeInfo -&gt; Bool
</span><a href="PlutusTx.Lift.THUtils.html#isNewtype"><span class="hs-identifier hs-var">isNewtype</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679698602"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndrUnit]
</span><a href="#local-6989586621679698600"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679698593"><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679698593"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679698592"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698592"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit -&gt; THCompile (Name, Kind ())
</span><a href="PlutusTx.Lift.TH.html#tvNameAndKind"><span class="hs-identifier hs-var">tvNameAndKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBndrUnit
</span><a href="#local-6989586621679698593"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-420"></span><span>      </span><span class="annot"><span class="annottext">Pred -&gt; THCompile (TExpQ CompileTypeScope)
</span><a href="PlutusTx.Lift.TH.html#compileType"><span class="hs-identifier hs-var">compileType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Pred
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.VarT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698592"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span>    </span><span class="hs-comment">-- Build the patter for the clause definition. All the argument will be called &quot;arg&quot;.</span><span>
</span><span id="line-423"></span><span>    </span><span id="local-6989586621679698591"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679698591"><span class="hs-identifier hs-var">patNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">Trans.lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">Trans.lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">Trans.lift</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">[Pred]
</span><a href="#local-6989586621679698597"><span class="hs-identifier hs-var">argTys</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; String -&gt; m Name
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.newName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arg&quot;</span></span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679698587"><span class="annot"><span class="annottext">pat :: Q Pat
</span><a href="#local-6989586621679698587"><span class="hs-identifier hs-var hs-var">pat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; [m Pat] -&gt; m Pat
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.conP</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698598"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Pat
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.varP</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679698591"><span class="hs-identifier hs-var">patNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span>    </span><span class="hs-comment">-- `lift arg` for each arg we bind in the pattern. We need the `unsafeTExpCoerce` since this will</span><span>
</span><span id="line-427"></span><span>    </span><span class="hs-comment">-- necessarily involve types we don't know now: the types of each argument. However, since we</span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-comment">-- know the type of `lift arg` we can get back into typed land quickly.</span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679699140"><span class="annot"><a href="#local-6989586621679698585"><span class="hs-identifier hs-type">liftExprs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.TExpQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusTx.Lift.Class.html#RTCompile"><span class="hs-identifier hs-type">RTCompile</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">PLC.DefaultUni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699140"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-core/html/src"><span class="hs-identifier hs-type">PLC.DefaultUni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699140"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-430"></span><span>        </span><span id="local-6989586621679698585"><span class="annot"><span class="annottext">liftExprs :: forall fun.
[TExpQ
   (RTCompile DefaultUni fun (Term TyName Name DefaultUni fun ()))]
</span><a href="#local-6989586621679698585"><span class="hs-identifier hs-var hs-var">liftExprs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679698579"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698579"><span class="hs-identifier hs-var">pn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *). Quote m =&gt; m Exp -&gt; m (TExp a)
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.unsafeTExpCoerce</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Exp
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.varE</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">lift</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; m Exp -&gt; m Exp -&gt; m Exp
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-operator hs-var">`TH.appE`</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Exp
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.varE</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698579"><span class="hs-identifier hs-var">pn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679698591"><span class="hs-identifier hs-var">patNames</span></a></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span>    </span><span id="local-6989586621679698578"><span class="annot"><span class="annottext">TExpQ
  (RTCompile DefaultUni Any (Term TyName Name DefaultUni Any ()))
</span><a href="#local-6989586621679698578"><span class="hs-identifier hs-var">rhsExpr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DatatypeInfo -&gt; Bool
</span><a href="PlutusTx.Lift.THUtils.html#isNewtype"><span class="hs-identifier hs-var">isNewtype</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679698602"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-433"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall fun.
[TExpQ
   (RTCompile DefaultUni fun (Term TyName Name DefaultUni fun ()))]
</span><a href="#local-6989586621679698585"><span class="hs-identifier hs-var">liftExprs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-434"></span><span>                    </span><span class="hs-special">[</span><span id="local-6989586621679698577"><span class="annot"><span class="annottext">TExpQ
  (RTCompile DefaultUni Any (Term TyName Name DefaultUni Any ()))
</span><a href="#local-6989586621679698577"><span class="hs-identifier hs-var">argExpr</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">TExpQ
  (RTCompile DefaultUni Any (Term TyName Name DefaultUni Any ()))
</span><a href="#local-6989586621679698577"><span class="hs-identifier hs-var">argExpr</span></a></span><span>
</span><span id="line-435"></span><span>                    </span><span class="annot"><span class="annottext">[TExpQ
   (RTCompile DefaultUni Any (Term TyName Name DefaultUni Any ()))]
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; LiftError
</span><a href="PlutusTx.Lift.TH.html#UserLiftError"><span class="hs-identifier hs-var">UserLiftError</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Newtypes must have a single constructor with a single argument&quot;</span></span><span>
</span><span id="line-436"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-437"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Splice m a -&gt; m (TExp a)
</span><a href="../../../../th-compat/html/src"><span class="hs-identifier hs-var">TH.examineSplice</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">[||</span><span>
</span><span id="line-438"></span><span>                    </span><span class="hs-comment">-- We bind all the splices with explicit signatures to ensure we</span><span>
</span><span id="line-439"></span><span>                    </span><span class="hs-comment">-- get type errors as soon as possible, and to aid debugging.</span><span>
</span><span id="line-440"></span><span>                    </span><span class="hs-keyword">let</span><span>
</span><span id="line-441"></span><span>                        </span><span class="hs-identifier">liftExprs'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">RTCompile</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Term</span><span> </span><span class="hs-identifier">TyName</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-442"></span><span>                        </span><span class="hs-identifier">liftExprs'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$$</span><span class="hs-special">(</span><span class="hs-identifier">TH.liftSplice</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyListE</span><span> </span><span class="hs-identifier">liftExprs</span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>                        </span><span class="hs-comment">-- We need the `unsafeTExpCoerce` since this will necessarily involve</span><span>
</span><span id="line-444"></span><span>                        </span><span class="hs-comment">-- types we don't know now: the type which this instance is for (which</span><span>
</span><span id="line-445"></span><span>                        </span><span class="hs-comment">-- appears in the proxy argument). However, since we know the type of</span><span>
</span><span id="line-446"></span><span>                        </span><span class="hs-comment">-- `typeRep` we can get back into typed land quickly.</span><span>
</span><span id="line-447"></span><span>                        </span><span class="hs-identifier">trep</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">RTCompile</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Type</span><span> </span><span class="hs-identifier">TyName</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>                        </span><span class="hs-identifier">trep</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$$</span><span class="hs-special">(</span><span class="hs-identifier">TH.unsafeSpliceCoerce</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-identifier">typeRep</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Proxy</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="hs-identifier">TH.conT</span><span> </span><span class="hs-identifier">tyName</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-450"></span><span>                        </span><span class="hs-comment">-- force creation of datatype</span><span>
</span><span id="line-451"></span><span>                        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">trep</span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span>                        </span><span class="hs-comment">-- get the right constructor</span><span>
</span><span id="line-454"></span><span>                        </span><span class="hs-identifier">maybeConstructors</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">lookupConstructors</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">tyName</span><span>
</span><span id="line-455"></span><span>                        </span><span class="hs-identifier">constrs</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">maybeConstructors</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-456"></span><span>                            </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Prelude.throw</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">LiftMissingDataCons</span><span> </span><span class="hs-identifier">tyName</span><span>
</span><span id="line-457"></span><span>                            </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">cs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">cs</span><span>
</span><span id="line-458"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">constr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">constrs</span><span> </span><span class="hs-operator">!!</span><span> </span><span class="hs-identifier">index</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span>                        </span><span class="hs-identifier">lifts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Term</span><span> </span><span class="hs-identifier">TyName</span><span> </span><span class="hs-identifier">Name</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">sequence</span><span> </span><span class="hs-identifier">liftExprs'</span><span>
</span><span id="line-461"></span><span>                        </span><span class="hs-comment">-- The 'fun' that is referenced here is the 'fun' that we bind the line above.</span><span>
</span><span id="line-462"></span><span>                        </span><span class="hs-comment">-- If it was forall-bound instead, 'typeExprs\'' wouldn't type check,</span><span>
</span><span id="line-463"></span><span>                        </span><span class="hs-comment">-- because 'Type' does not determine 'fun' (unlike 'Term' in 'liftExprs\''</span><span>
</span><span id="line-464"></span><span>                        </span><span class="hs-comment">-- above).</span><span>
</span><span id="line-465"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">tyExprs'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">RTCompileScope</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-identifier">fun</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Type</span><span> </span><span class="hs-identifier">TyName</span><span> </span><span class="hs-identifier">PLC.DefaultUni</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-466"></span><span>                            </span><span class="hs-identifier">tyExprs'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unCompileTypeScope</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span> </span><span class="hs-special">$$</span><span class="hs-special">(</span><span class="hs-identifier">TH.liftSplice</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tyListE</span><span> </span><span class="hs-identifier">tyExprs</span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>                        </span><span class="hs-comment">-- The types are compiled in an (empty) local scope.</span><span>
</span><span id="line-468"></span><span>                        </span><span class="hs-identifier">types</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">flip</span><span> </span><span class="hs-identifier">runReaderT</span><span> </span><span class="hs-identifier">mempty</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">sequence</span><span> </span><span class="hs-identifier">tyExprs'</span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span>                        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">mkIterApp</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mkIterInst</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">constr</span><span> </span><span class="hs-identifier">types</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">lifts</span><span>
</span><span id="line-471"></span><span>                  </span><span class="hs-special">||]</span><span>
</span><span id="line-472"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Quote m =&gt;
[m Pat] -&gt; m Body -&gt; [m Dec] -&gt; m Clause
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.clause</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Q Pat
</span><a href="#local-6989586621679698587"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; m Exp -&gt; m Body
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.normalB</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *). Quote m =&gt; m (TExp a) -&gt; m Exp
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.unTypeQ</span></a></span><span> </span><span class="annot"><span class="annottext">TExpQ
  (RTCompile DefaultUni Any (Term TyName Name DefaultUni Any ()))
</span><a href="#local-6989586621679698578"><span class="hs-identifier hs-var">rhsExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span class="annot"><a href="PlutusTx.Lift.TH.html#makeLift"><span class="hs-identifier hs-type">makeLift</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-475"></span><span id="makeLift"><span class="annot"><span class="annottext">makeLift :: Name -&gt; Q [Dec]
</span><a href="PlutusTx.Lift.TH.html#makeLift"><span class="hs-identifier hs-var hs-var">makeLift</span></a></span></span><span> </span><span id="local-6989586621679698576"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698576"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-476"></span><span>    </span><span class="annot"><span class="annottext">Extension -&gt; Q ()
</span><a href="PlutusTx.Lift.THUtils.html#requireExtension"><span class="hs-identifier hs-var">requireExtension</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../../../ghc/html/libraries/ghc-boot-th-9.2.5/src"><span class="hs-identifier hs-var">TH.ScopedTypeVariables</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679698575"><span class="annot"><span class="annottext">uni :: Pred
</span><a href="#local-6989586621679698575"><span class="hs-identifier hs-var hs-var">uni</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Pred
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PLC.DefaultUni</span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-comment">-- we need this too if we're lifting</span><span>
</span><span id="line-480"></span><span>    </span><span id="local-6989586621679698574"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679698574"><span class="hs-identifier hs-var">typeableDecs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pred -&gt; Name -&gt; Q [Dec]
</span><a href="PlutusTx.Lift.TH.html#makeTypeable"><span class="hs-identifier hs-var">makeTypeable</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698575"><span class="hs-identifier hs-var">uni</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698576"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-481"></span><span>    </span><span id="local-6989586621679698573"><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679698573"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Q DatatypeInfo
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.reifyDatatype</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679698576"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679698572"><span class="annot"><span class="annottext">datatypeType :: Pred
</span><a href="#local-6989586621679698572"><span class="hs-identifier hs-var hs-var">datatypeType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DatatypeInfo -&gt; Pred
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">TH.datatypeType</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679698573"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679698570"><span class="annot"><span class="annottext">[Q Clause]
</span><a href="#local-6989586621679698570"><span class="hs-identifier hs-var">clauses</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679698569"><span class="annot"><span class="annottext">Deps
</span><a href="#local-6989586621679698569"><span class="hs-identifier hs-var">deps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. THCompile a -&gt; Q (a, Deps)
</span><a href="PlutusTx.Lift.TH.html#runTHCompile"><span class="hs-identifier hs-var">runTHCompile</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo -&gt; THCompile [Q Clause]
</span><a href="PlutusTx.Lift.TH.html#compileLift"><span class="hs-identifier hs-var">compileLift</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeInfo
</span><a href="#local-6989586621679698573"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span>    </span><span class="hs-comment">{-
    Here we *do* need to add some constraints, because we're going to generate things like
    `instance Lift a =&gt; Lift (Maybe a)`. We can't just leave these open because they refer to type variables.

    We *could* put in a Typeable constraint for the type itself. This is somewhat more correct,
    but GHC warns us if we do this because we always also define the instance alongside. So we just
    leave it out.

    We also need to remove any Lift constraints we get for the type we're defining. This can happen if
    we're recursive, since we'll probably end up with constructor arguments of the current type.
    We don't want `instance Lift [a] =&gt; Lift [a]`!
    -}</span><span>
</span><span id="line-499"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679698567"><span class="annot"><span class="annottext">prunedDeps :: Deps
</span><a href="#local-6989586621679698567"><span class="hs-identifier hs-var hs-var">prunedDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.delete</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pred -&gt; Dep
</span><a href="PlutusTx.Lift.TH.html#LiftDep"><span class="hs-identifier hs-var">LiftDep</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698572"><span class="hs-identifier hs-var">datatypeType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Deps
</span><a href="#local-6989586621679698569"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-comment">-- See Note [Closed constraints]</span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679698564"><span class="annot"><span class="annottext">constraints :: [Pred]
</span><a href="#local-6989586621679698564"><span class="hs-identifier hs-var hs-var">constraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; Bool
</span><a href="PlutusTx.Lift.TH.html#isClosedConstraint"><span class="hs-identifier hs-var">isClosedConstraint</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Pred -&gt; Dep -&gt; Pred
</span><a href="PlutusTx.Lift.TH.html#toConstraint"><span class="hs-identifier hs-var">toConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698575"><span class="hs-identifier hs-var">uni</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Deps
</span><a href="#local-6989586621679698567"><span class="hs-identifier hs-var">prunedDeps</span></a></span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span>    </span><span id="local-6989586621679698563"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679698563"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; [m Clause] -&gt; m Dec
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.funD</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-identifier">lift</span><span> </span><span class="annot"><span class="annottext">[Q Clause]
</span><a href="#local-6989586621679698570"><span class="hs-identifier hs-var">clauses</span></a></span><span>
</span><span id="line-504"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679698562"><span class="annot"><span class="annottext">liftDecs :: [Dec]
</span><a href="#local-6989586621679698562"><span class="hs-identifier hs-var hs-var">liftDecs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Maybe Overlap -&gt; [Pred] -&gt; Pred -&gt; [Dec] -&gt; Dec
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">TH.InstanceD</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">[Pred]
</span><a href="#local-6989586621679698564"><span class="hs-identifier hs-var">constraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pred -&gt; Pred -&gt; Pred
</span><a href="PlutusTx.Lift.TH.html#liftPir"><span class="hs-identifier hs-var">liftPir</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698575"><span class="hs-identifier hs-var">uni</span></a></span><span> </span><span class="annot"><span class="annottext">Pred
</span><a href="#local-6989586621679698572"><span class="hs-identifier hs-var">datatypeType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679698563"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-505"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679698574"><span class="hs-identifier hs-var">typeableDecs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679698562"><span class="hs-identifier hs-var">liftDecs</span></a></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="hs-comment">-- | In case of exception, it will call `fail` in TemplateHaskell</span><span>
</span><span id="line-508"></span><span id="local-6989586621679699167"><span class="annot"><a href="PlutusTx.Lift.TH.html#runTHCompile"><span class="hs-identifier hs-type">runTHCompile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#THCompile"><span class="hs-identifier hs-type">THCompile</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679699167"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679699167"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusTx.Lift.TH.html#Deps"><span class="hs-identifier hs-type">Deps</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-509"></span><span id="runTHCompile"><span class="annot"><span class="annottext">runTHCompile :: forall a. THCompile a -&gt; Q (a, Deps)
</span><a href="PlutusTx.Lift.TH.html#runTHCompile"><span class="hs-identifier hs-var hs-var">runTHCompile</span></a></span></span><span> </span><span id="local-6989586621679698549"><span class="annot"><span class="annottext">THCompile a
</span><a href="#local-6989586621679698549"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-510"></span><span>    </span><span id="local-6989586621679698548"><span class="annot"><span class="annottext">Either LiftError (a, Deps)
</span><a href="#local-6989586621679698548"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-511"></span><span>          </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-512"></span><span>          </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. StateT s m a -&gt; s -&gt; m (a, s)
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runStateT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">THCompile a
</span><a href="#local-6989586621679698549"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-513"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either LiftError (a, Deps)
</span><a href="#local-6989586621679698548"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-514"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679698543"><span class="annot"><span class="annottext">LiftError
</span><a href="#local-6989586621679698543"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Generating Lift instances: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><a href="../../../../prettyprinter/html/src"><span class="hs-identifier hs-var">PP.pretty</span></a></span><span> </span><span class="annot"><span class="annottext">LiftError
</span><a href="#local-6989586621679698543"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679698542"><span class="annot"><span class="annottext">(a, Deps)
</span><a href="#local-6989586621679698542"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Deps)
</span><a href="#local-6989586621679698542"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-516"></span></pre></body></html>