<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- editorconfig-checker-disable-file</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- GHC doesn't like the definition of 'TrySpecializeAsVar'.</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-redundant-constraints #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds          #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE DataKinds                #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances        #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies   #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds                #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE StandaloneKindSignatures #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications         #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies             #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators            #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances     #-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusCore.Builtin.Elaborate</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ElaborateFromTo"><span class="hs-identifier">ElaborateFromTo</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html"><span class="hs-identifier">PlutusCore.Builtin.KnownTypeAst</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Polymorphism.html"><span class="hs-identifier">PlutusCore.Builtin.Polymorphism</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html"><span class="hs-identifier">PlutusCore.Core.Type</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Kind</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">GHC</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Type.Bool</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Type.Equality</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">GHC.TypeLits</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">-- The 'TryUnify' gadget explained in detail in https://github.com/effectfully/sketches/tree/master/poly-type-of-saga/part1-try-unify</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-comment">-- | Check if two values of different kinds are in fact the same value (with the same kind).</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- A heterogeneous version of @Type.Equality.(==)@.</span><span>
</span><span id="line-33"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-type">(===)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680864291"><span class="annot"><a href="#local-6989586621680864291"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680864290"><span class="annot"><a href="#local-6989586621680864290"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680864291"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864290"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="local-6989586621680864289"><span class="annot"><a href="#local-6989586621680864289"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="%3D%3D%3D"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-var">===</span></a></span></span><span> </span><span id="local-6989586621680864288"><span class="annot"><a href="#local-6989586621680864288"><span class="hs-identifier hs-type">y</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>    </span><span id="local-6989586621680864287"><span class="annot"><a href="#local-6989586621680864287"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span id="%3D%3D%3D"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-var">===</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680864287"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">True</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span id="local-6989586621680864285"><span id="local-6989586621680864286"><span class="annot"><a href="#local-6989586621680864286"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span id="%3D%3D%3D"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-var">===</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680864285"><span class="hs-identifier hs-type">y</span></a></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">False</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TryUnify"><span class="hs-identifier hs-type">TryUnify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680864478"><span class="annot"><a href="#local-6989586621680864478"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680864477"><span class="annot"><a href="#local-6989586621680864477"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864478"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864477"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><a href="#local-6989586621680864476"><span class="hs-identifier hs-type">same</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864475"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-type">===</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864474"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="TryUnify"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TryUnify"><span class="hs-identifier hs-var">TryUnify</span></a></span></span><span> </span><span id="local-6989586621680864476"><span class="annot"><a href="#local-6989586621680864476"><span class="hs-identifier hs-type">same</span></a></span></span><span> </span><span id="local-6989586621680864475"><span class="annot"><a href="#local-6989586621680864475"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680864474"><span class="annot"><a href="#local-6989586621680864474"><span class="hs-identifier hs-type">y</span></a></span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680864464"><span id="local-6989586621680864465"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864465"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-type">===</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864464"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">False</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TryUnify"><span class="hs-identifier hs-type">TryUnify</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">False</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864465"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864464"><span class="hs-identifier hs-type">y</span></a></span></span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# INCOHERENT</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span id="local-6989586621680864454"><span id="local-6989586621680864455"><span id="local-6989586621680864456"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864456"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~~</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864455"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680864454"><span class="hs-identifier hs-type">same</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">True</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TryUnify"><span class="hs-identifier hs-type">TryUnify</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864454"><span class="hs-identifier hs-type">same</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864456"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864455"><span class="hs-identifier hs-type">y</span></a></span></span></span></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-comment">-- | Unify two values unless they're obviously distinct (in which case do nothing).</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- Allows us to detect and specialize type variables, since a type variable is not obviously</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- distinct from anything else and so the INCOHERENT instance of 'TryUnify' gets triggered and the</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- variable gets unified with whatever we want it to.</span><span>
</span><span id="line-47"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#~%3F~"><span class="hs-operator hs-type">(~?~)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680864266"><span class="annot"><a href="#local-6989586621680864266"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680864265"><span class="annot"><a href="#local-6989586621680864265"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680864266"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864265"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">type</span><span> </span><span id="local-6989586621680864264"><span class="annot"><a href="#local-6989586621680864264"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="~%3F~"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#~%3F~"><span class="hs-operator hs-var">~?~</span></a></span></span><span> </span><span id="local-6989586621680864263"><span class="annot"><a href="#local-6989586621680864263"><span class="hs-identifier hs-type">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TryUnify"><span class="hs-identifier hs-type">TryUnify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864264"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-type">===</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864263"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680864264"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864263"><span class="hs-identifier hs-type">y</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-comment">-- | Get the element at an @i@th position in a list.</span><span>
</span><span id="line-51"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-type">Lookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680864261"><span class="annot"><a href="#local-6989586621680864261"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680864261"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864261"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Lookup"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-var">Lookup</span></a></span></span><span> </span><span id="local-6989586621680864260"><span class="annot"><a href="#local-6989586621680864260"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span id="local-6989586621680864259"><span class="annot"><a href="#local-6989586621680864259"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-53"></span><span>    </span><span id="Lookup"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-var">Lookup</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Not enough elements&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>    </span><span id="Lookup"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-var">Lookup</span></a></span></span><span> </span><span id="local-6989586621680864257"><span id="local-6989586621680864258"><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864258"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680864257"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680864258"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span id="Lookup"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-var">Lookup</span></a></span></span><span> </span><span id="local-6989586621680864255"><span id="local-6989586621680864256"><span class="annot"><a href="#local-6989586621680864256"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680864255"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-type">Lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864256"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-glyph hs-type">-</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680864255"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-comment">-- | Get the name at the @i@th position in the list of default names. We could use @a_0@, @a_1@,</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- @a_2@ etc instead, but @a@, @b@, @c@ etc are nicer.</span><span>
</span><span id="line-59"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#GetName"><span class="hs-identifier hs-type">GetName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Symbol</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="GetName"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#GetName"><span class="hs-identifier hs-var">GetName</span></a></span></span><span> </span><span id="local-6989586621680864254"><span class="annot"><a href="#local-6989586621680864254"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621680864253"><span class="annot"><a href="#local-6989586621680864253"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-61"></span><span>    </span><span id="GetName"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#GetName"><span class="hs-identifier hs-var">GetName</span></a></span></span><span> </span><span id="local-6989586621680864252"><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864252"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-type">Lookup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864252"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;a&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;b&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;c&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;d&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;e&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;i&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;j&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;k&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;l&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-62"></span><span>    </span><span id="GetName"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#GetName"><span class="hs-identifier hs-var">GetName</span></a></span></span><span> </span><span id="local-6989586621680864251"><span class="annot"><span class="hs-identifier">_</span></span><span>        </span><span class="annot"><a href="#local-6989586621680864251"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#Lookup"><span class="hs-identifier hs-type">Lookup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864251"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;f&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;g&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;h&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;m&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;n&quot;</span></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- For higher-kinded types.</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- | Apply the function stored in the provided 'Maybe' if there's one.</span><span>
</span><span id="line-65"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#MaybeApply"><span class="hs-identifier hs-type">MaybeApply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680864250"><span class="annot"><a href="#local-6989586621680864250"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864250"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864250"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864250"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864250"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="MaybeApply"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#MaybeApply"><span class="hs-identifier hs-var">MaybeApply</span></a></span></span><span> </span><span id="local-6989586621680864249"><span class="annot"><a href="#local-6989586621680864249"><span class="hs-identifier hs-type">mayVal</span></a></span></span><span> </span><span id="local-6989586621680864248"><span class="annot"><a href="#local-6989586621680864248"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-67"></span><span>    </span><span id="MaybeApply"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#MaybeApply"><span class="hs-identifier hs-var">MaybeApply</span></a></span></span><span> </span><span id="local-6989586621680864247"><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nothing</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621680864247"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680864247"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span id="MaybeApply"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#MaybeApply"><span class="hs-identifier hs-var">MaybeApply</span></a></span></span><span> </span><span id="local-6989586621680864245"><span id="local-6989586621680864246"><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864246"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680864245"><span class="hs-identifier hs-type">a</span></a></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680864246"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864245"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | Try to specialize @a@ as a type representing a PLC type variable.</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- @i@ is a fresh id and @j@ is a final one (either @i + 1@ or @i@ depending on whether</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- specialization attempt is successful or not).</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- @mw@ is for wrapping 'TyVarRep', if there's a wrapper inside (see 'HandleHole' for how it's</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- used).</span><span>
</span><span id="line-75"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsVar"><span class="hs-identifier hs-type">TrySpecializeAsVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680864452"><span class="annot"><a href="#local-6989586621680864452"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864452"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864452"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864452"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">class</span><span> </span><span id="TrySpecializeAsVar"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsVar"><span class="hs-identifier hs-var">TrySpecializeAsVar</span></a></span></span><span> </span><span id="local-6989586621680864451"><span class="annot"><a href="#local-6989586621680864451"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680864450"><span class="annot"><a href="#local-6989586621680864450"><span class="hs-identifier hs-type">j</span></a></span></span><span> </span><span id="local-6989586621680864449"><span class="annot"><a href="#local-6989586621680864449"><span class="hs-identifier hs-type">mw</span></a></span></span><span> </span><span id="local-6989586621680864448"><span class="annot"><a href="#local-6989586621680864448"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621680864451"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864449"><span class="hs-identifier hs-type">mw</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864448"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864450"><span class="hs-identifier hs-type">j</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-78"></span><span>    </span><span id="local-6989586621680864429"><span id="local-6989586621680864430"><span id="local-6989586621680864431"><span id="local-6989586621680864432"><span id="local-6989586621680864433"><span id="local-6989586621680864434"><span class="hs-special">(</span><span> </span><span class="annot"><a href="#local-6989586621680864433"><span class="hs-identifier hs-type">var</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#MaybeApply"><span class="hs-identifier hs-type">MaybeApply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864432"><span class="hs-identifier hs-type">mw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Polymorphism.html#TyVarRep"><span class="hs-identifier hs-type">TyVarRep</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680864434"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="PlutusCore.Builtin.Polymorphism.html#TyNameRep"><span class="hs-identifier hs-type">TyNameRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#GetName"><span class="hs-identifier hs-type">GetName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864434"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864431"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680864431"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- Try to unify @a@ with a freshly created @var@.</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680864430"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#~%3F~"><span class="hs-operator hs-type">~?~</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864433"><span class="hs-identifier hs-type">var</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-comment">-- If @a@ is equal to @var@ then unification was successful and we just used the fresh id and</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-comment">-- so we need to bump it up. Otherwise @var@ was discarded and so the fresh id is still fresh.</span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-comment">-- Replacing @(===)@ with @(==)@ causes errors at use site, for whatever reason.</span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680864429"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864430"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#%3D%3D%3D"><span class="hs-operator hs-type">===</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864433"><span class="hs-identifier hs-type">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864431"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-type">+</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680864431"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsVar"><span class="hs-identifier hs-type">TrySpecializeAsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864431"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864429"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864432"><span class="hs-identifier hs-type">mw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864430"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680864434"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-keyword">type</span><span> </span><span id="NoAppliedVarsHeader"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#NoAppliedVarsHeader"><span class="hs-identifier hs-var">NoAppliedVarsHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;A built-in function is not allowed to have applied type variables in its type&quot;</span></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- See Note [Rep vs Type context].</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | Throw an error telling the user not to apply type variables to anything.</span><span>
</span><span id="line-92"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowNoAppliedVars"><span class="hs-identifier hs-type">ThrowNoAppliedVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="ThrowNoAppliedVars"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowNoAppliedVars"><span class="hs-identifier hs-var">ThrowNoAppliedVars</span></a></span></span><span> </span><span id="local-6989586621680864238"><span class="annot"><a href="#local-6989586621680864238"><span class="hs-identifier hs-type">hole</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-comment">-- In the Rep context higher-kinded type variables are allowed, but need to be applied via</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-comment">-- 'TyAppRep', hence the error message.</span><span>
</span><span id="line-96"></span><span>    </span><span id="ThrowNoAppliedVars"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowNoAppliedVars"><span class="hs-identifier hs-var">ThrowNoAppliedVars</span></a></span></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#RepHole"><span class="hs-identifier hs-type">RepHole</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">TypeError</span></a></span><span>
</span><span id="line-97"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#NoAppliedVarsHeader"><span class="hs-identifier hs-type">NoAppliedVarsHeader</span></a></span><span>
</span><span id="line-98"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;To fix this error apply type variables via explicit &#8216;TyAppRep&#8217;&quot;</span></span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-comment">-- In the Type context no higher-kinded type variables are allowed.</span><span>
</span><span id="line-101"></span><span>    </span><span id="ThrowNoAppliedVars"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowNoAppliedVars"><span class="hs-identifier hs-var">ThrowNoAppliedVars</span></a></span></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#TypeHole"><span class="hs-identifier hs-type">TypeHole</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">TypeError</span></a></span><span>
</span><span id="line-102"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#NoAppliedVarsHeader"><span class="hs-identifier hs-type">NoAppliedVarsHeader</span></a></span><span>
</span><span id="line-103"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;To fix this error specialize all higher-kinded type variables&quot;</span></span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-comment">-- In case we add more contexts.</span><span>
</span><span id="line-106"></span><span>    </span><span id="ThrowNoAppliedVars"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowNoAppliedVars"><span class="hs-identifier hs-var">ThrowNoAppliedVars</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">TypeError</span></a></span><span>
</span><span id="line-107"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#NoAppliedVarsHeader"><span class="hs-identifier hs-type">NoAppliedVarsHeader</span></a></span><span>
</span><span id="line-108"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Internal error: the context is not recognized. Please report&quot;</span></span><span>
</span><span id="line-109"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-comment">-- See Note [Elaboration of higher-kinded type variables].</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | Check that the higher-kinded type does not represent a PLC type variable and if it does.</span><span>
</span><span id="line-113"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#CheckNotAppliedVar"><span class="hs-identifier hs-type">CheckNotAppliedVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680864237"><span class="annot"><a href="#local-6989586621680864237"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864237"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-114"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="CheckNotAppliedVar"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#CheckNotAppliedVar"><span class="hs-identifier hs-var">CheckNotAppliedVar</span></a></span></span><span> </span><span id="local-6989586621680864236"><span class="annot"><a href="#local-6989586621680864236"><span class="hs-identifier hs-type">hole</span></a></span></span><span> </span><span id="local-6989586621680864235"><span class="annot"><a href="#local-6989586621680864235"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>    </span><span id="CheckNotAppliedVar"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#CheckNotAppliedVar"><span class="hs-identifier hs-var">CheckNotAppliedVar</span></a></span></span><span> </span><span id="local-6989586621680864234"><span class="annot"><a href="#local-6989586621680864234"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Polymorphism.html#TyVarRep"><span class="hs-identifier hs-type">TyVarRep</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowNoAppliedVars"><span class="hs-identifier hs-type">ThrowNoAppliedVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864234"><span class="hs-identifier hs-type">hole</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span id="CheckNotAppliedVar"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#CheckNotAppliedVar"><span class="hs-identifier hs-var">CheckNotAppliedVar</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-- | Try to specialize the head of a (possibly nullary) type application to a type representing a</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- PLC variable and throw if that succeeds or if it already was one.</span><span>
</span><span id="line-120"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeHeadAsVar"><span class="hs-identifier hs-type">TrySpecializeHeadAsVar</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680864428"><span class="annot"><a href="#local-6989586621680864428"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680864427"><span class="annot"><a href="#local-6989586621680864427"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864428"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864427"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-122"></span><span class="hs-keyword">class</span><span> </span><span id="TrySpecializeHeadAsVar"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeHeadAsVar"><span class="hs-identifier hs-var">TrySpecializeHeadAsVar</span></a></span></span><span> </span><span id="local-6989586621680864426"><span class="annot"><a href="#local-6989586621680864426"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680864425"><span class="annot"><a href="#local-6989586621680864425"><span class="hs-identifier hs-type">j</span></a></span></span><span> </span><span id="local-6989586621680864424"><span class="annot"><a href="#local-6989586621680864424"><span class="hs-identifier hs-type">hole</span></a></span></span><span> </span><span id="local-6989586621680864423"><span class="annot"><a href="#local-6989586621680864423"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621680864426"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864423"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864425"><span class="hs-identifier hs-type">j</span></a></span><span>
</span><span id="line-123"></span><span class="hs-comment">-- | Recurse to reach the head.</span><span>
</span><span id="line-124"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPABLE</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621680864407"><span id="local-6989586621680864408"><span id="local-6989586621680864409"><span id="local-6989586621680864410"><span id="local-6989586621680864411"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeHeadAsVar"><span class="hs-identifier hs-type">TrySpecializeHeadAsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864411"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864410"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864409"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864408"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeHeadAsVar"><span class="hs-identifier hs-type">TrySpecializeHeadAsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864411"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864410"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864409"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864408"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864407"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- | Reached the head, it's a 'TyVarRep', throwing. Mostly to ensure that a 'TyVarRep' doesn't slip</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- in via user input, but also out of pure paranoia (GHC seems to occasionally solve constraints</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- for the same type multiple times by racing through different routes in the presence of</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- @INCOHERENT@ pragmas, but this is not confirmed. It wouldn't be unreasonable, though).</span><span>
</span><span id="line-130"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPING</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621680864396"><span id="local-6989586621680864397"><span id="local-6989586621680864398"><span id="local-6989586621680864399"><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowNoAppliedVars"><span class="hs-identifier hs-type">ThrowNoAppliedVars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864399"><span class="hs-identifier hs-type">hole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680864398"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864397"><span class="hs-identifier hs-type">j</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeHeadAsVar"><span class="hs-identifier hs-type">TrySpecializeHeadAsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864398"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864397"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864399"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Polymorphism.html#TyVarRep"><span class="hs-identifier hs-type">TyVarRep</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864396"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- | Reached the head, try to specialize it as a variable and throw if that succeeds.</span><span>
</span><span id="line-133"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# INCOHERENT</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621680864383"><span id="local-6989586621680864384"><span id="local-6989586621680864385"><span id="local-6989586621680864386"><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsVar"><span class="hs-identifier hs-type">TrySpecializeAsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864386"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864385"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nothing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864384"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#CheckNotAppliedVar"><span class="hs-identifier hs-type">CheckNotAppliedVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864383"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864384"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeHeadAsVar"><span class="hs-identifier hs-type">TrySpecializeHeadAsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864386"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864385"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864383"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864384"><span class="hs-identifier hs-type">f</span></a></span></span></span></span></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">{- | Try to specialize @a@ as a type representing a PLC type variable.
Same as 'TrySpecializeAsVar' (in particular, the parameters are the same), except this one also
checks if the given type is a type application, in which case it tries to specialize the head of the
application to a type representing a PLC type variable and throws if that succeeds.

We need this because blindly specializing an @f A@ (where @f@ is a type variable and @A@ is an
arbitrary type) in the Type context would give us @Opaque val A@ (by @f ~ Opaque val@) instead of
@Opaque val (f' A)@, which would be very confusing to the user: the only reasonable way to elaborate
an application of a type variable in Haskell is to make an application of a type variable in PLC,
not to randomly drop the type variable.

There's no way we could elaborate an applied type variable without surprising the user, because no
instantiation of @f@ could turn @f A@ into @Opaque val (f' A)@, hence we simply forbid applied type
variables and throw upon encountering one. It would be a pain to handle an iterated application of a
type representing a PLC type variable anyway.

It's not possible to determine if @Opaque val A@ is a specialization of @f a@ or @a@ (for a type
variable @a@), hence we have to make this whole check during elaboration and not any later.

Regardless of whether the given argument is a type application or not, it's attempted to be
specialized as a type representing a PLC type variable, because such a type is a type application
itself. Unifying an already known type variable with a fresh one is useful when the name part
of the former is unknown.
-}</span><span>
</span><span id="line-162"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsUnappliedVar"><span class="hs-identifier hs-type">TrySpecializeAsUnappliedVar</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680864382"><span class="annot"><a href="#local-6989586621680864382"><span class="hs-identifier hs-type">k</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864382"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864382"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864382"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-164"></span><span class="hs-keyword">class</span><span> </span><span id="TrySpecializeAsUnappliedVar"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsUnappliedVar"><span class="hs-identifier hs-var">TrySpecializeAsUnappliedVar</span></a></span></span><span> </span><span id="local-6989586621680864381"><span class="annot"><a href="#local-6989586621680864381"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680864380"><span class="annot"><a href="#local-6989586621680864380"><span class="hs-identifier hs-type">j</span></a></span></span><span> </span><span id="local-6989586621680864379"><span class="annot"><a href="#local-6989586621680864379"><span class="hs-identifier hs-type">hole</span></a></span></span><span> </span><span id="local-6989586621680864378"><span class="annot"><a href="#local-6989586621680864378"><span class="hs-identifier hs-type">mw</span></a></span></span><span> </span><span id="local-6989586621680864377"><span class="annot"><a href="#local-6989586621680864377"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621680864381"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864378"><span class="hs-identifier hs-type">mw</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864377"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864380"><span class="hs-identifier hs-type">j</span></a></span><span>
</span><span id="line-165"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621680864358"><span id="local-6989586621680864359"><span id="local-6989586621680864360"><span id="local-6989586621680864361"><span id="local-6989586621680864362"><span id="local-6989586621680864363"><span id="local-6989586621680864364"><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeHeadAsVar"><span class="hs-identifier hs-type">TrySpecializeHeadAsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864364"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864363"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864362"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864361"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsVar"><span class="hs-identifier hs-type">TrySpecializeAsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864363"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864360"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864359"><span class="hs-identifier hs-type">mw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864361"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864358"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsUnappliedVar"><span class="hs-identifier hs-type">TrySpecializeAsUnappliedVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864364"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864360"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864362"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864359"><span class="hs-identifier hs-type">mw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864361"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864358"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span><span>
</span><span id="line-169"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# INCOHERENT</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span id="local-6989586621680864347"><span id="local-6989586621680864348"><span id="local-6989586621680864349"><span id="local-6989586621680864350"><span id="local-6989586621680864351"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsVar"><span class="hs-identifier hs-type">TrySpecializeAsVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864351"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864350"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864349"><span class="hs-identifier hs-type">mw</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864348"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsUnappliedVar"><span class="hs-identifier hs-type">TrySpecializeAsUnappliedVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864351"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864350"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864347"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864349"><span class="hs-identifier hs-type">mw</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864348"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-comment">-- See Note [Rep vs Type context]</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- | First try to specialize the hole using 'TrySpecializeAsVar' and then recurse on the result of</span><span>
</span><span id="line-173"></span><span class="hs-comment">-- that using 'HandleHoles'.</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- @i@ is a fresh id and @j@ is a final one as in 'TrySpecializeAsVar', but since 'HandleHole' can</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- specialize multiple variables, @j@ can be equal to @i + n@ for any @n@ (including @0@).</span><span>
</span><span id="line-176"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHole"><span class="hs-identifier hs-type">HandleHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-177"></span><span class="hs-keyword">class</span><span> </span><span id="HandleHole"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHole"><span class="hs-identifier hs-var">HandleHole</span></a></span></span><span> </span><span id="local-6989586621680864345"><span class="annot"><a href="#local-6989586621680864345"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680864344"><span class="annot"><a href="#local-6989586621680864344"><span class="hs-identifier hs-type">j</span></a></span></span><span> </span><span id="local-6989586621680864343"><span class="annot"><a href="#local-6989586621680864343"><span class="hs-identifier hs-type">val</span></a></span></span><span> </span><span id="local-6989586621680864342"><span class="annot"><a href="#local-6989586621680864342"><span class="hs-identifier hs-type">hole</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621680864345"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864343"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864342"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864344"><span class="hs-identifier hs-type">j</span></a></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- In the Rep context @x@ is attempted to be specialized as a 'TyVarRep'.</span><span>
</span><span id="line-179"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621680864327"><span id="local-6989586621680864328"><span id="local-6989586621680864329"><span id="local-6989586621680864330"><span id="local-6989586621680864331"><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsUnappliedVar"><span class="hs-identifier hs-type">TrySpecializeAsUnappliedVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864331"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864330"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#RepHole"><span class="hs-identifier hs-type">RepHole</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nothing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864329"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHoles"><span class="hs-identifier hs-type">HandleHoles</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864330"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864328"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864327"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864329"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHole"><span class="hs-identifier hs-type">HandleHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864331"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864328"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864327"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#RepHole"><span class="hs-identifier hs-type">RepHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864329"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-183"></span><span class="hs-comment">-- In the Type context @a@ is attempted to be specialized as a 'TyVarRep' wrapped in @Opaque val@.</span><span>
</span><span id="line-184"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621680864315"><span id="local-6989586621680864316"><span id="local-6989586621680864317"><span id="local-6989586621680864318"><span id="local-6989586621680864319"><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#TrySpecializeAsUnappliedVar"><span class="hs-identifier hs-type">TrySpecializeAsUnappliedVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864319"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864318"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#TypeHole"><span class="hs-identifier hs-type">TypeHole</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Polymorphism.html#Opaque"><span class="hs-identifier hs-type">Opaque</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864317"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680864316"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHoles"><span class="hs-identifier hs-type">HandleHoles</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864318"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864315"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864317"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864316"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHole"><span class="hs-identifier hs-type">HandleHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864319"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864315"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864317"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#TypeHole"><span class="hs-identifier hs-type">TypeHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864316"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-comment">-- | Call 'HandleHole' over each hole from the list, threading the state (the fresh unique) through</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- the calls.</span><span>
</span><span id="line-191"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHolesGo"><span class="hs-identifier hs-type">HandleHolesGo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-192"></span><span class="hs-keyword">class</span><span> </span><span id="HandleHolesGo"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHolesGo"><span class="hs-identifier hs-var">HandleHolesGo</span></a></span></span><span> </span><span id="local-6989586621680864314"><span class="annot"><a href="#local-6989586621680864314"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680864313"><span class="annot"><a href="#local-6989586621680864313"><span class="hs-identifier hs-type">j</span></a></span></span><span> </span><span id="local-6989586621680864312"><span class="annot"><a href="#local-6989586621680864312"><span class="hs-identifier hs-type">val</span></a></span></span><span> </span><span id="local-6989586621680864311"><span class="annot"><a href="#local-6989586621680864311"><span class="hs-identifier hs-type">holes</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621680864314"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864312"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864311"><span class="hs-identifier hs-type">holes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864313"><span class="hs-identifier hs-type">j</span></a></span><span>
</span><span id="line-193"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680864305"><span id="local-6989586621680864306"><span id="local-6989586621680864307"><span class="annot"><a href="#local-6989586621680864307"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864306"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHolesGo"><span class="hs-identifier hs-type">HandleHolesGo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864307"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864306"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864305"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-194"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621680864293"><span id="local-6989586621680864294"><span id="local-6989586621680864295"><span id="local-6989586621680864296"><span id="local-6989586621680864297"><span id="local-6989586621680864298"><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHole"><span class="hs-identifier hs-type">HandleHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864298"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864297"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864296"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864295"><span class="hs-identifier hs-type">hole</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHolesGo"><span class="hs-identifier hs-type">HandleHolesGo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864297"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864294"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864296"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864293"><span class="hs-identifier hs-type">holes</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHolesGo"><span class="hs-identifier hs-type">HandleHolesGo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864298"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864294"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864296"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864295"><span class="hs-identifier hs-type">hole</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680864293"><span class="hs-identifier hs-type">holes</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- | If the outermost constructor of the second argument is known and happens to be one of the</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- constructors of the list data type, then the second argument is returned back. Otherwise the</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- first one is returned, which is meant to be a custom type error.</span><span>
</span><span id="line-202"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowOnStuckList"><span class="hs-identifier hs-type">ThrowOnStuckList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680864204"><span class="annot"><a href="#local-6989586621680864204"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680864204"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680864204"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680864204"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-203"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="ThrowOnStuckList"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowOnStuckList"><span class="hs-identifier hs-var">ThrowOnStuckList</span></a></span></span><span> </span><span id="local-6989586621680864203"><span class="annot"><a href="#local-6989586621680864203"><span class="hs-identifier hs-type">err</span></a></span></span><span> </span><span id="local-6989586621680864202"><span class="annot"><a href="#local-6989586621680864202"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-204"></span><span>    </span><span id="ThrowOnStuckList"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowOnStuckList"><span class="hs-identifier hs-var">ThrowOnStuckList</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-205"></span><span>    </span><span id="ThrowOnStuckList"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowOnStuckList"><span class="hs-identifier hs-var">ThrowOnStuckList</span></a></span></span><span> </span><span id="local-6989586621680864200"><span id="local-6989586621680864201"><span class="annot"><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680864201"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680864200"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680864201"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680864200"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span id="ThrowOnStuckList"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowOnStuckList"><span class="hs-identifier hs-var">ThrowOnStuckList</span></a></span></span><span> </span><span id="local-6989586621680864199"><span class="annot"><a href="#local-6989586621680864199"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680864199"><span class="hs-identifier hs-type">err</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#UnknownTypeError"><span class="hs-identifier hs-type">UnknownTypeError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680864197"><span class="annot"><a href="#local-6989586621680864197"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680864196"><span class="annot"><a href="#local-6989586621680864196"><span class="hs-identifier hs-type">any</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864197"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864196"><span class="hs-identifier hs-type">any</span></a></span><span>
</span><span id="line-209"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="UnknownTypeError"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#UnknownTypeError"><span class="hs-identifier hs-var">UnknownTypeError</span></a></span></span><span> </span><span id="local-6989586621680864195"><span class="annot"><a href="#local-6989586621680864195"><span class="hs-identifier hs-type">val</span></a></span></span><span> </span><span id="local-6989586621680864194"><span class="annot"><a href="#local-6989586621680864194"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-210"></span><span>    </span><span id="UnknownTypeError"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#UnknownTypeError"><span class="hs-identifier hs-var">UnknownTypeError</span></a></span></span><span> </span><span id="local-6989586621680864192"><span id="local-6989586621680864193"><span class="annot"><a href="#local-6989586621680864193"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864192"><span class="hs-identifier hs-type">x</span></a></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">TypeError</span></a></span><span>
</span><span id="line-211"></span><span>        </span><span class="hs-special">(</span><span>         </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;No instance for &#8216;KnownTypeAst &quot;</span></span><span>
</span><span id="line-212"></span><span>            </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ShowType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#UniOf"><span class="hs-identifier hs-type">UniOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864193"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>            </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot; (&quot;</span></span><span>
</span><span id="line-214"></span><span>            </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ShowType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864192"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-215"></span><span>            </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;)&#8217;&quot;</span></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Which means&quot;</span></span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;  &#8216;&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ShowType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864192"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;&#8217;&quot;</span></span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;is neither a built-in type, nor one of the control types.&quot;</span></span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;If it can be represented in terms of one of the built-in types&quot;</span></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;  then go add the instance (you may need a few others too)&quot;</span></span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;  alongside the instance for the built-in type.&quot;</span></span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Otherwise you may need to add a new built-in type&quot;</span></span><span>
</span><span id="line-223"></span><span>        </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;  (provided you're doing something that can be supported in principle)&quot;</span></span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-comment">-- | Get the holes of @x@ and recurse into them.</span><span>
</span><span id="line-227"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHoles"><span class="hs-identifier hs-type">HandleHoles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680864190"><span class="annot"><a href="#local-6989586621680864190"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680864190"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-228"></span><span class="hs-keyword">type</span><span> </span><span id="HandleHoles"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHoles"><span class="hs-identifier hs-var">HandleHoles</span></a></span></span><span> </span><span id="local-6989586621680864189"><span class="annot"><a href="#local-6989586621680864189"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680864188"><span class="annot"><a href="#local-6989586621680864188"><span class="hs-identifier hs-type">j</span></a></span></span><span> </span><span id="local-6989586621680864187"><span class="annot"><a href="#local-6989586621680864187"><span class="hs-identifier hs-type">val</span></a></span></span><span> </span><span id="local-6989586621680864186"><span class="annot"><a href="#local-6989586621680864186"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-comment">-- Here we detect a stuck application of 'ToHoles' and throw 'UnknownTypeError' on it.</span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-comment">-- See https://blog.csongor.co.uk/report-stuck-families for a detailed description of how</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-comment">-- detection of stuck type families works.</span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHolesGo"><span class="hs-identifier hs-type">HandleHolesGo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864189"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864188"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864187"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ThrowOnStuckList"><span class="hs-identifier hs-type">ThrowOnStuckList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#UnknownTypeError"><span class="hs-identifier hs-type">UnknownTypeError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864187"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864186"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#ToHoles"><span class="hs-identifier hs-type">ToHoles</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864186"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-comment">-- | Specialize each Haskell type variable in @a@ as a type representing a PLC type variable.</span><span>
</span><span id="line-235"></span><span class="hs-comment">-- @i@ is a fresh id and @j@ is a final one as in 'TrySpecializeAsVar', but since 'HandleHole' can</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- specialize multiple variables, @j@ can be equal to @i + n@ for any @n@ (including @0@).</span><span>
</span><span id="line-237"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ElaborateFromTo"><span class="hs-identifier hs-type">ElaborateFromTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Nat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">GHC.Constraint</span></a></span><span>
</span><span id="line-238"></span><span class="hs-keyword">type</span><span> </span><span id="ElaborateFromTo"><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#ElaborateFromTo"><span class="hs-identifier hs-var">ElaborateFromTo</span></a></span></span><span> </span><span id="local-6989586621680864184"><span class="annot"><a href="#local-6989586621680864184"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680864183"><span class="annot"><a href="#local-6989586621680864183"><span class="hs-identifier hs-type">j</span></a></span></span><span> </span><span id="local-6989586621680864182"><span class="annot"><a href="#local-6989586621680864182"><span class="hs-identifier hs-type">val</span></a></span></span><span> </span><span id="local-6989586621680864181"><span class="annot"><a href="#local-6989586621680864181"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Elaborate.html#HandleHole"><span class="hs-identifier hs-type">HandleHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864184"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864183"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864182"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.KnownTypeAst.html#TypeHole"><span class="hs-identifier hs-type">TypeHole</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680864181"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span></pre></body></html>