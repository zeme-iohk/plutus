

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>9. Debugging compiled programs &mdash; Glasgow Haskell Compiler 9.2.5 User&#39;s Guide</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Glasgow Haskell Compiler 9.2.5 User&#39;s Guide"
          href="_static/opensearch.xml"/>

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="10. What to do when something goes wrong" href="gone_wrong.html" />
    <link rel="prev" title="8. Profiling" href="profiling.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Glasgow Haskell Compiler
          

          
          </a>

          
            
            
              <div class="version">
                9.2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="release-notes.html">2. Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="ghci.html">3. Using GHCi</a></li>
<li class="toctree-l1"><a class="reference internal" href="runghc.html">4. Using runghc</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">5. Using GHC</a></li>
<li class="toctree-l1"><a class="reference internal" href="exts.html">6. Language extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending_ghc.html">7. Extending and using GHC as a Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiling.html">8. Profiling</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">9. Debugging compiled programs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tutorial">9.1. Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requesting-a-stack-trace-from-haskell-code">9.2. Requesting a stack trace from Haskell code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#requesting-a-stack-trace-with-sigquit">9.3. Requesting a stack trace with <code class="docutils literal notranslate"><span class="pre">SIGQUIT</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#implementor-s-notes-dwarf-annotations">9.4. Implementor’s notes: DWARF annotations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#debugging-information-entities">9.4.1. Debugging information entities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dw-tag-ghc-src-note">9.4.1.1. <code class="docutils literal notranslate"><span class="pre">DW_TAG_ghc_src_note</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#further-reading">9.5. Further Reading</a></li>
<li class="toctree-l2"><a class="reference internal" href="#direct-mapping">9.6. Direct Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="#querying-the-info-table-map">9.7. Querying the Info Table Map</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gone_wrong.html">10. What to do when something goes wrong</a></li>
<li class="toctree-l1"><a class="reference internal" href="hints.html">11. Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">12. Other Haskell utility programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="win32-dlls.html">13. Running GHC on Win32 systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="bugs.html">14. Known bugs and infelicities</a></li>
<li class="toctree-l1"><a class="reference internal" href="eventlog-formats.html">15. Eventlog encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="editing-guide.html">16. Care and feeding of your GHC User’s Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Glasgow Haskell Compiler</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li><span class="section-number">9. </span>Debugging compiled programs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/debug-info.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="debugging-compiled-programs">
<h1><span class="section-number">9. </span>Debugging compiled programs<a class="headerlink" href="#debugging-compiled-programs" title="Permalink to this heading">¶</a></h1>
<p>Since the 7.10 release GHC can emit a debugging information to help debugging
tools understand the code that GHC produces. This debugging information is
useable by most UNIX debugging tools.</p>
<dl class="std ghc-flag">
<dt class="sig sig-object std" id="ghc-flag-g">
<span class="sig-name descname"><span class="pre">-g</span></span><a class="headerlink" href="#ghc-flag-g" title="Permalink to this definition">¶</a></dt>
<dt class="sig sig-object std" id="ghc-flag-gn">
<span class="sig-name descname"><span class="pre">-g⟨n⟩</span></span><a class="headerlink" href="#ghc-flag-gn" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Since<span class="colon">:</span></dt>
<dd class="field-odd"><p>7.10, numeric levels since 8.0</p>
</dd>
<dt class="field-even">Implies<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="phases.html#ghc-flag-fexpose-internal-symbols"><code class="xref std std-ghc-flag docutils literal notranslate"><span class="pre">-fexpose-internal-symbols</span></code></a> when ⟨n⟩ &gt;= 2.</p>
</dd>
</dl>
<p>Emit debug information in object code. Currently only DWARF debug
information is supported on x86-64 and i386. Currently debug levels 0
through 3 are accepted:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-g0</span></code>: no debug information produced</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-g1</span></code>: produces stack unwinding records for top-level functions (sufficient for basic backtraces)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-g2</span></code>: produces stack unwinding records for top-level functions as well
as inner blocks (allowing more precise backtraces than with <code class="docutils literal notranslate"><span class="pre">-g1</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-g3</span></code>: produces GHC-specific DWARF information for use by more
sophisticated Haskell-aware debugging tools (see <a class="reference internal" href="#dwarf-dies"><span class="std std-ref">Debugging information entities</span></a> for
details)</p></li>
</ul>
</div></blockquote>
<p>If ⟨n⟩ is omitted, level 2 is assumed.</p>
</dd></dl>

<section id="tutorial">
<h2><span class="section-number">9.1. </span>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this heading">¶</a></h2>
<p>Let’s consider a simple example,</p>
<div class="highlight-hs notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="c1">-- fib.hs</span><span class="w"></span>
<span class="linenos">2</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Int</span><span class="w"></span>
<span class="linenos">3</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">4</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="linenos">5</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">6</span>
<span class="linenos">7</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="nb">()</span><span class="w"></span>
<span class="linenos">8</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">print</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="mi">50</span><span class="w"></span>
</pre></div>
</div>
<p>Let’s first see how execution flows through this program. We start by telling
GHC that we want debug information,</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ghc -g -rtsopts fib.hs
</pre></div>
</div>
<p>Here we used the <code class="docutils literal notranslate"><span class="pre">-g</span></code> option to inform GHC that it should add debugging
information in the produced binary. There are three levels of debugging
output: <code class="docutils literal notranslate"><span class="pre">-g0</span></code> (no debugging information, the default), <code class="docutils literal notranslate"><span class="pre">-g1</span></code> (sufficient for
basic backtraces), <code class="docutils literal notranslate"><span class="pre">-g2</span></code> (or just <code class="docutils literal notranslate"><span class="pre">-g</span></code> for short; emitting everything GHC knows).
Note that this debugging information does not affect the optimizations performed
by GHC.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Under Mac OS X debug information is kept apart from the executable. After
compiling the executable you’ll need to use the <code class="docutils literal notranslate"><span class="pre">dsymutil</span></code> utility to
extract the debugging information and place them in the debug archive,</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ dsymutil fib
</pre></div>
</div>
<p>This should produce a file named <code class="docutils literal notranslate"><span class="pre">fib.dSYM</span></code>.</p>
</div>
<p>Now let’s have a look at the flow of control. For this we can just start our
program under <code class="docutils literal notranslate"><span class="pre">gdb</span></code> (or an equivalent debugger) as we would any other native
executable,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ gdb --args ./Fib +RTS -V0
Reading symbols from Fib...done.
(gdb) run
Starting program: /opt/exp/ghc/ghc-dwarf/Fib
[Thread debugging using libthread_db enabled]
Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.
^C
Program received signal SIGINT, Interrupt.
0x000000000064fc7c in cfy4_info () at libraries/integer-gmp/src/GHC/Integer/Type.hs:424
424     minusInteger x y = inline plusInteger x (inline negateInteger y)
(gdb)
</pre></div>
</div>
<p>Here we have used the runtime system’s <code class="docutils literal notranslate"><span class="pre">-V0</span></code> option to disable the RTS’s
periodic timer which may interfere with our debugging session. Upon breaking
into the program <code class="docutils literal notranslate"><span class="pre">gdb</span></code> shows us a location in our source program corresponding
to the current point of execution.</p>
<p>Moreover, we can ask <code class="docutils literal notranslate"><span class="pre">gdb</span></code> to tell us the flow of execution that lead us to
this point in the program,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) bt
#0  0x000000000064fc7c in cfy4_info () at libraries/integer-gmp/src/GHC/Integer/Type.hs:424
#1  0x00000000006eb0c0 in ?? ()
#2  0x000000000064301c in cbuV_info () at libraries/integer-gmp/src/GHC/Integer/Type.hs:323
#3  0x000000000064311b in integerzmgmp_GHCziIntegerziType_eqInteger_info () at libraries/integer-gmp/src/GHC/Integer/Type.hs:312
#4  0x0000000000406eca in roz_info () at Fib.hs:2
#5  0x00000000006eb0c0 in ?? ()
#6  0x000000000064f075 in cfru_info () at libraries/integer-gmp/src/GHC/Integer/Type.hs:412
#7  0x00000000006eb0c0 in ?? ()
#8  0x000000000064f075 in cfru_info () at libraries/integer-gmp/src/GHC/Integer/Type.hs:412
#9  0x00000000006eb0c0 in ?? ()
#10 0x000000000064eefe in integerzmgmp_GHCziIntegerziType_plusInteger_info () at libraries/integer-gmp/src/GHC/Integer/Type.hs:393
...
#64 0x0000000000643ac8 in integerzmgmp_GHCziIntegerziType_ltIntegerzh_info () at libraries/integer-gmp/src/GHC/Integer/Type.hs:343
#65 0x00000000004effcc in base_GHCziShow_zdwintegerToString_info () at libraries/base/GHC/Show.hs:443
#66 0x00000000004f0795 in base_GHCziShow_zdfShowIntegerzuzdcshow_info () at libraries/base/GHC/Show.hs:145
#67 0x000000000048892b in cdGW_info () at libraries/base/GHC/IO/Handle/Text.hs:595
#68 0x0000000000419cb2 in base_GHCziBase_thenIO1_info () at libraries/base/GHC/Base.hs:1072
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Here we notice the first bit of the stack trace has many unidentified stack
frames at address <code class="docutils literal notranslate"><span class="pre">0x006eb0c0</span></code>. If we ask <code class="docutils literal notranslate"><span class="pre">gdb</span></code> about this location, we
find that these frames are actually STG update closures,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) print/a 0x006eb0c0
$1 = 0x6eb0c0 &lt;stg_upd_frame_info&gt;
</pre></div>
</div>
<p>The reason <code class="docutils literal notranslate"><span class="pre">gdb</span></code> doesn’t show this symbol name in the backtrace output is an
infidelity in its interpretation of debug information, which assumes an
invariant preserved in C but not Haskell programs. Unfortunately it is
necessary to work around this manually until this behavior is fixed
upstream.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because of the aggressive optimization that GHC performs to the programs it
compiles it is quite difficult to pin-point exactly which point in the source
program a given machine instruction should be attributed to. In fact,
internally GHC associates each instruction with a <strong>set</strong> of source
locations. When emitting the standard debug information used by <code class="docutils literal notranslate"><span class="pre">gdb</span></code> and
other language-agnostic debugging tools, GHC is forced to heuristically
choose one location from among this set.</p>
<p>For this reason we should be cautious when interpreting the source locations
provided by GDB. While these locations will usually be in some sense
“correct”, they aren’t always useful. This is why profiling tools targeting
Haskell should supplement the standard source location information with
GHC-specific annotations (emitted with <code class="docutils literal notranslate"><span class="pre">-g2</span></code>) when assigning costs.</p>
</div>
<p>Indeed, we can even set breakpoints,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(gdb) break fib.hs:4
Breakpoint 1 at 0x406c60: fib.hs:4. (5 locations)
(gdb) run
Starting program: /opt/exp/ghc/ghc-dwarf/Fib

Breakpoint 1, c1RV_info () at Fib.hs:4
4        fib n = fib (n-1) + fib (n-2)
(gdb) bt
#0  c1RV_info () at Fib.hs:4
#1  0x00000000006eb0c0 in ?? ()
#2  0x0000000000643ac8 in integerzmgmp_GHCziIntegerziType_ltIntegerzh_info () at libraries/integer-gmp/src/GHC/Integer/Type.hs:343
#3  0x00000000004effcc in base_GHCziShow_zdwintegerToString_info () at libraries/base/GHC/Show.hs:443
#4  0x00000000004f0795 in base_GHCziShow_zdfShowIntegerzuzdcshow_info () at libraries/base/GHC/Show.hs:145
#5  0x000000000048892b in cdGW_info () at libraries/base/GHC/IO/Handle/Text.hs:595
#6  0x0000000000419cb2 in base_GHCziBase_thenIO1_info () at libraries/base/GHC/Base.hs:1072
#7  0x00000000006ebcb0 in ?? () at rts/Exception.cmm:332
#8  0x00000000006e7320 in ?? ()
(gdb)
</pre></div>
</div>
<p>Due to the nature of GHC’s heap and the heavy optimization that it performs, it
is quite difficult to probe the values of bindings at runtime. In this way, the
debugging experience of a Haskell program with DWARF support is still a bit
impoverished compared to typical imperative debuggers.</p>
</section>
<section id="requesting-a-stack-trace-from-haskell-code">
<h2><span class="section-number">9.2. </span>Requesting a stack trace from Haskell code<a class="headerlink" href="#requesting-a-stack-trace-from-haskell-code" title="Permalink to this heading">¶</a></h2>
<p>GHC’s runtime system has built-in support for collecting stack trace information
from a running Haskell program. This currently requires that the <code class="docutils literal notranslate"><span class="pre">libdw</span></code>
library from the <code class="docutils literal notranslate"><span class="pre">elfutils</span></code> package is available. Of course, the backtrace
will be of little use unless debug information is available in the executable
and its dependent libraries.</p>
<p>Stack trace functionality is exposed for use by Haskell programs in the
<a class="reference external" href="./../libraries/base-4.16.4.0/GHC-ExecutionStack.html">GHC.ExecutionStack</a> module. See the Haddock
documentation in this module for details regarding usage.</p>
</section>
<section id="requesting-a-stack-trace-with-sigquit">
<span id="backtrace-signal"></span><h2><span class="section-number">9.3. </span>Requesting a stack trace with <code class="docutils literal notranslate"><span class="pre">SIGQUIT</span></code><a class="headerlink" href="#requesting-a-stack-trace-with-sigquit" title="Permalink to this heading">¶</a></h2>
<p>On POSIX-compatible platforms GHC’s runtime system (when built with <code class="docutils literal notranslate"><span class="pre">libdw</span></code>
support) will produce a stack trace on <code class="docutils literal notranslate"><span class="pre">stderr</span></code> when a <code class="docutils literal notranslate"><span class="pre">SIGQUIT</span></code> signal is
received (on many systems this signal can be sent using <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd>-<kbd class="kbd docutils literal notranslate">\</kbd></kbd>). For
instance (using the same <code class="docutils literal notranslate"><span class="pre">fib.hs</span></code> as above),</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ ./fib  <span class="p">&amp;</span>  killall -SIGQUIT fib

Caught SIGQUIT<span class="p">;</span> Backtrace:
0x7f3176b15dd8    dwfl_thread_getframes <span class="o">(</span>/usr/lib/x86_64-linux-gnu/libdw-0.163.so<span class="o">)</span>
0x7f3176b1582f    <span class="o">(</span>null<span class="o">)</span> <span class="o">(</span>/usr/lib/x86_64-linux-gnu/libdw-0.163.so<span class="o">)</span>
0x7f3176b15b57    dwfl_getthreads <span class="o">(</span>/usr/lib/x86_64-linux-gnu/libdw-0.163.so<span class="o">)</span>
0x7f3176b16150    dwfl_getthread_frames <span class="o">(</span>/usr/lib/x86_64-linux-gnu/libdw-0.163.so<span class="o">)</span>
      0x6dc857    libdwGetBacktrace <span class="o">(</span>rts/Libdw.c:248.0<span class="o">)</span>
      0x6e6126    backtrace_handler <span class="o">(</span>rts/posix/Signals.c:541.0<span class="o">)</span>
0x7f317677017f    <span class="o">(</span>null<span class="o">)</span> <span class="o">(</span>/lib/x86_64-linux-gnu/libc-2.19.so<span class="o">)</span>
      0x642e1c    integerzmgmp_GHCziIntegerziType_eqIntegerzh_info <span class="o">(</span>libraries/integer-gmp/src/GHC/Integer/Type.hs:320.1<span class="o">)</span>
      0x643023    integerzmgmp_GHCziIntegerziType_eqInteger_info <span class="o">(</span>libraries/integer-gmp/src/GHC/Integer/Type.hs:312.1<span class="o">)</span>
      0x406eca    roz_info <span class="o">(</span>/opt/exp/ghc/ghc-dwarf//Fib.hs:2.1<span class="o">)</span>
      0x6eafc0    stg_upd_frame_info <span class="o">(</span>rts/Updates.cmm:31.1<span class="o">)</span>
      0x64ee06    integerzmgmp_GHCziIntegerziType_plusInteger_info <span class="o">(</span>libraries/integer-gmp/src/GHC/Integer/Type.hs:393.1<span class="o">)</span>
      0x6eafc0    stg_upd_frame_info <span class="o">(</span>rts/Updates.cmm:31.1<span class="o">)</span>
...
      0x6439d0    integerzmgmp_GHCziIntegerziType_ltIntegerzh_info <span class="o">(</span>libraries/integer-gmp/src/GHC/Integer/Type.hs:343.1<span class="o">)</span>
      0x4efed4    base_GHCziShow_zdwintegerToString_info <span class="o">(</span>libraries/base/GHC/Show.hs:442.1<span class="o">)</span>
      0x4f069d    base_GHCziShow_zdfShowIntegerzuzdcshow_info <span class="o">(</span>libraries/base/GHC/Show.hs:145.5<span class="o">)</span>
      0x488833    base_GHCziIOziHandleziText_zdwa8_info <span class="o">(</span>libraries/base/GHC/IO/Handle/Text.hs:582.1<span class="o">)</span>
      0x6ebbb0    stg_catch_frame_info <span class="o">(</span>rts/Exception.cmm:370.1<span class="o">)</span>
      0x6e7220    stg_stop_thread_info <span class="o">(</span>rts/StgStartup.cmm:42.1<span class="o">)</span>
</pre></div>
</div>
</section>
<section id="implementor-s-notes-dwarf-annotations">
<h2><span class="section-number">9.4. </span>Implementor’s notes: DWARF annotations<a class="headerlink" href="#implementor-s-notes-dwarf-annotations" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Most users don’t need to worry about the details described in this section.
This discussion is primarily targeted at tooling authors who need to
interpret the GHC-specific DWARF annotations contained in compiled binaries.</p>
</div>
<p>When invoked with the <code class="docutils literal notranslate"><span class="pre">-g</span></code> flag GHC will produce standard <a class="reference external" href="http://dwarfstd.org/">DWARF v4</a> debugging information. This format is used by nearly
all POSIX-compliant targets and can be used by debugging and performance tools
(e.g. <code class="docutils literal notranslate"><span class="pre">gdb</span></code>, <code class="docutils literal notranslate"><span class="pre">lldb</span></code>, and <code class="docutils literal notranslate"><span class="pre">perf</span></code>) to understand the structure of
GHC-compiled programs.</p>
<p>In particular GHC produces the following DWARF sections,</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">.debug_info</span></code></dt><dd><p>Debug information entities (DIEs) describing all of the basic blocks in the
compiled program.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.debug_line</span></code></dt><dd><p>Line number information necessary to map instruction addresses to line numbers
in the source program.</p>
<p>Note that the line information in this section is not nearly as rich as the
information provided in <code class="docutils literal notranslate"><span class="pre">.debug_info</span></code>. Whereas <code class="docutils literal notranslate"><span class="pre">.debug_line</span></code> requires that
each instruction is assigned exactly one source location, the DIEs in
<code class="docutils literal notranslate"><span class="pre">.debug_info</span></code> can be used to identify all relevant sources locations.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.debug_frames</span></code></dt><dd><p>Call frame information (CFI) necessary for stack unwinding to produce a call
stack trace.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.debug_arange</span></code></dt><dd><p>Address range information necessary for efficient lookup in debug information.</p>
</dd>
</dl>
<section id="debugging-information-entities">
<span id="dwarf-dies"></span><h3><span class="section-number">9.4.1. </span>Debugging information entities<a class="headerlink" href="#debugging-information-entities" title="Permalink to this heading">¶</a></h3>
<p>GHC may produce the following standard DIEs in the <code class="docutils literal notranslate"><span class="pre">.debug_info</span></code> section,</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">DW_TAG_compile_unit</span></code></dt><dd><p>Represents a compilation unit (e.g. a Haskell module).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DW_TAG_subprogram</span></code></dt><dd><p>Represents a C-\- top-level basic block.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DW_TAG_lexical_block</span></code></dt><dd><p>Represents a C-\- basic block. Note that this is a slight departure from the
intended meaning of this DIE type as it does not necessarily reflect
lexical scope in the source program.</p>
</dd>
</dl>
<p>As GHC’s compilation products don’t map perfectly onto DWARF constructs,
GHC takes advantage of the extensibility of the DWARF standard to provide
additional information.</p>
<p>Unfortunately DWARF isn’t expressive enough to fully describe the code
that GHC produces. This is most apparent in the case of line
information, where GHC is forced to choose some between a variety of
possible originating source locations. This limits the usefulness of
DWARF information with traditional statistical profiling tools. For
profiling it is recommended that one use the extended debugging
information. See the <em>Profiling</em> section below.</p>
<p>In addition to the usual DIEs specified by the DWARF specification, GHC
produces a variety of others using the vendor-extensibility regions of
the tag and attribute space.</p>
<section id="dw-tag-ghc-src-note">
<h4><span class="section-number">9.4.1.1. </span><code class="docutils literal notranslate"><span class="pre">DW_TAG_ghc_src_note</span></code><a class="headerlink" href="#dw-tag-ghc-src-note" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">DW_TAG_ghc_src_note</span></code> DIEs (tag 0x5b01) are found as children of
<code class="docutils literal notranslate"><span class="pre">DW_TAG_lexical_block</span></code> DIEs. They describe source spans which gave rise to the
block; formally these spans are causally responsible for produced code: changes
to code in the given span may change the code within the block; conversely
changes outside the span are guaranteed not to affect the code in the block.</p>
<p>Spans are described with the following attributes,</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">DW_AT_ghc_span_file</span></code> (0x2b00, string)</dt><dd><p>the name of the source file</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DW_AT_ghc_span_start_line</span></code> (0x2b01, integer)</dt><dd><p>the line number of the beginning of the span</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DW_AT_ghc_span_start_col</span></code> (0x2b02, integer)</dt><dd><p>the column number of the beginning of the span</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DW_AT_ghc_span_end_line</span></code> (0x2b03, integer)</dt><dd><p>the line number of the end of the span</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">DW_AT_ghc_span_end_col</span></code> (0x2b04, integer)</dt><dd><p>the column number of the end of the span</p>
</dd>
</dl>
</section>
</section>
</section>
<section id="further-reading">
<h2><span class="section-number">9.5. </span>Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this heading">¶</a></h2>
<p>For more information about the debug information produced by GHC see
Peter Wortmann’s PhD thesis, <a class="reference external" href="http://etheses.whiterose.ac.uk/8321/">*Profiling Optimized Haskell: Causal
Analysis and Implementation*</a>.</p>
</section>
<section id="direct-mapping">
<h2><span class="section-number">9.6. </span>Direct Mapping<a class="headerlink" href="#direct-mapping" title="Permalink to this heading">¶</a></h2>
<p>In addition to the DWARF debug information, which can be used by many
standard tools, there is also a GHC specific way to map info table pointers
to a source location. This lookup table is generated by using the <code class="docutils literal notranslate"><span class="pre">-finfo-table-map</span></code> flag.</p>
<dl class="std ghc-flag">
<dt class="sig sig-object std" id="ghc-flag-finfo-table-map">
<span class="sig-name descname"><span class="pre">-finfo-table-map</span></span><a class="headerlink" href="#ghc-flag-finfo-table-map" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Since<span class="colon">:</span></dt>
<dd class="field-odd"><p>9.2</p>
</dd>
</dl>
<p>This flag enables the generation of a table which maps the address of
an info table to an approximate source position of where that
info table statically originated from. If you
also want more precise information about constructor info tables then you
should also use <a class="reference internal" href="#ghc-flag-fdistinct-constructor-tables"><code class="xref std std-ghc-flag docutils literal notranslate"><span class="pre">-fdistinct-constructor-tables</span></code></a>.</p>
<p>This flag will increase the binary size by quite a lot, depending on how
big your project is. For compiling a project the size of GHC the overhead was
about 200 megabytes.</p>
</dd></dl>

<dl class="std ghc-flag">
<dt class="sig sig-object std" id="ghc-flag-fdistinct-constructor-tables">
<span class="sig-name descname"><span class="pre">-fdistinct-constructor-tables</span></span><a class="headerlink" href="#ghc-flag-fdistinct-constructor-tables" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Since<span class="colon">:</span></dt>
<dd class="field-odd"><p>9.2</p>
</dd>
</dl>
<p>For every usage of a data constructor in the source program
a new info table will be created. This is useful with
<a class="reference internal" href="#ghc-flag-finfo-table-map"><code class="xref std std-ghc-flag docutils literal notranslate"><span class="pre">-finfo-table-map</span></code></a> and the <a class="reference internal" href="profiling.html#rts-flag-hi"><code class="xref std std-rts-flag docutils literal notranslate"><span class="pre">-hi</span></code></a> profiling mode as
each info table will correspond to the usage of a data constructor rather
than the data constructor itself.</p>
</dd></dl>

</section>
<section id="querying-the-info-table-map">
<h2><span class="section-number">9.7. </span>Querying the Info Table Map<a class="headerlink" href="#querying-the-info-table-map" title="Permalink to this heading">¶</a></h2>
<p>If it is generated then the info table map can be used
in two ways.</p>
<ol class="arabic simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">whereFrom</span></code> Haskell function can be used to determine the source
position which we think a specific closure was created.</p></li>
<li><p>The complete mapping is also dumped into the eventlog.</p></li>
</ol>
<p>If you are using gdb then you can use the <code class="docutils literal notranslate"><span class="pre">lookupIPE</span></code> function (provided
by <code class="docutils literal notranslate"><span class="pre">IPE.h</span></code> and exported in the public API)
directly in order to find any information which is known
about the info table for a specific closure.</p>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="gone_wrong.html" class="btn btn-neutral float-right" title="10. What to do when something goes wrong" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="profiling.html" class="btn btn-neutral float-left" title="8. Profiling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, GHC Team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>