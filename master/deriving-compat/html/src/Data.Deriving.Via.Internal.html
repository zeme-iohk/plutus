<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &gt;= 800
</span><span class="hs-pragma">{-# LANGUAGE TemplateHaskellQuotes #-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-8"></span><span class="hs-comment">{-|
Module:      Data.Deriving.Via.Internal
Copyright:   (C) 2015-2017 Ryan Scott
License:     BSD-style (see the file LICENSE)
Maintainer:  Ryan Scott
Portability: Template Haskell

On @template-haskell-2.12@ or later (i.e., GHC 8.2 or later), this module
exports functionality which emulates the @GeneralizedNewtypeDeriving@ and
@DerivingVia@ GHC extensions (the latter of which was introduced in GHC 8.6).

On older versions of @template-haskell@/GHC, this module does not export
anything.

Note: this is an internal module, and as such, the API presented here is not
guaranteed to be stable, even between minor releases of this library.
-}</span><span>
</span><span id="line-25"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Deriving.Via.Internal</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#if MIN_VERSION_template_haskell(2,12,0)
</span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator">(&lt;=&lt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">unless</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.Deriving.Internal.html"><span class="hs-identifier">Data.Deriving.Internal</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">catMaybes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">GHC.Exts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier">Any</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier">Language.Haskell.TH</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier">Language.Haskell.TH.Datatype</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier">Language.Haskell.TH.Datatype.TyVarBndr</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- Code generation</span><span>
</span><span id="line-44"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-comment">{- | Generates an instance for a type class at a newtype by emulating the
behavior of the @GeneralizedNewtypeDeriving@ extension. For example:

@
newtype Foo a = MkFoo a
$('deriveGND' [t| forall a. 'Eq' a =&gt; 'Eq' (Foo a) |])
@
-}</span><span>
</span><span id="line-54"></span><span class="annot"><a href="Data.Deriving.Via.Internal.html#deriveGND"><span class="hs-identifier hs-type">deriveGND</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-55"></span><span id="deriveGND"><span class="annot"><span class="annottext">deriveGND :: Q Type -&gt; Q [Dec]
</span><a href="Data.Deriving.Via.Internal.html#deriveGND"><span class="hs-identifier hs-var hs-var">deriveGND</span></a></span></span><span> </span><span id="local-6989586621679068445"><span class="annot"><span class="annottext">Q Type
</span><a href="#local-6989586621679068445"><span class="hs-identifier hs-var">qty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-56"></span><span>  </span><span id="local-6989586621679068444"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068444"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q Type
</span><a href="#local-6989586621679068445"><span class="hs-identifier hs-var">qty</span></a></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068443"><span class="annot"><span class="annottext">[TyVarBndrSpec]
</span><a href="#local-6989586621679068443"><span class="hs-identifier hs-var">_instanceTvbs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068442"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068442"><span class="hs-identifier hs-var">instanceCxt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068441"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068441"><span class="hs-identifier hs-var">instanceTy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVarBndrSpec], Cxt, Type)
</span><a href="Data.Deriving.Via.Internal.html#decomposeType"><span class="hs-identifier hs-var">decomposeType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068444"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-58"></span><span>  </span><span id="local-6989586621679068439"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068439"><span class="hs-identifier hs-var">instanceTy'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Q Type
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">resolveTypeSynonyms</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;=&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Q Type
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">resolveInfixT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068441"><span class="hs-identifier hs-var">instanceTy</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span id="local-6989586621679068436"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679068436"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type -&gt; Q [Dec]
</span><a href="Data.Deriving.Via.Internal.html#deriveViaDecs"><span class="hs-identifier hs-var">deriveViaDecs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068439"><span class="hs-identifier hs-var">instanceTy'</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">`fmap`</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Quote m =&gt;
m Cxt -&gt; m Type -&gt; [m Dec] -&gt; m Dec
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">instanceD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068442"><span class="hs-identifier hs-var">instanceCxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068441"><span class="hs-identifier hs-var">instanceTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679068436"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">{- | Generates an instance for a type class by emulating the behavior of the
@DerivingVia@ extension. For example:

@
newtype Foo a = MkFoo a
$('deriveVia' [t| forall a. 'Ord' a =&gt; 'Ord' (Foo a) ``Via`` Down a |])
@

As shown in the example above, the syntax is a tad strange. One must specify
the type by which to derive the instance using the 'Via' type. This
requirement is in place to ensure that the type variables are scoped
correctly across all the types being used (e.g., to make sure that the same
@a@ is used in @'Ord' a@, @'Ord' (Foo a)@, and @Down a@).
-}</span><span>
</span><span id="line-78"></span><span class="annot"><a href="Data.Deriving.Via.Internal.html#deriveVia"><span class="hs-identifier hs-type">deriveVia</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-79"></span><span id="deriveVia"><span class="annot"><span class="annottext">deriveVia :: Q Type -&gt; Q [Dec]
</span><a href="Data.Deriving.Via.Internal.html#deriveVia"><span class="hs-identifier hs-var hs-var">deriveVia</span></a></span></span><span> </span><span id="local-6989586621679068432"><span class="annot"><span class="annottext">Q Type
</span><a href="#local-6989586621679068432"><span class="hs-identifier hs-var">qty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-80"></span><span>  </span><span id="local-6989586621679068431"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068431"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q Type
</span><a href="#local-6989586621679068432"><span class="hs-identifier hs-var">qty</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068430"><span class="annot"><span class="annottext">[TyVarBndrSpec]
</span><a href="#local-6989586621679068430"><span class="hs-identifier hs-var">_instanceTvbs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068429"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068429"><span class="hs-identifier hs-var">instanceCxt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068428"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068428"><span class="hs-identifier hs-var">viaApp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVarBndrSpec], Cxt, Type)
</span><a href="Data.Deriving.Via.Internal.html#decomposeType"><span class="hs-identifier hs-var">decomposeType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068431"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span id="local-6989586621679068427"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068427"><span class="hs-identifier hs-var">viaApp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Q Type
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">resolveTypeSynonyms</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;=&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Q Type
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">resolveInfixT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068428"><span class="hs-identifier hs-var">viaApp</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679068426"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068426"><span class="hs-identifier hs-var">instanceTy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068425"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068425"><span class="hs-identifier hs-var">viaTy</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, Cxt)
</span><a href="Data.Deriving.Internal.html#unapplyTy"><span class="hs-identifier hs-var">unapplyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068427"><span class="hs-identifier hs-var">viaApp'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-85"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621679068423"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068423"><span class="hs-keyword hs-var">via</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621679068422"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068422"><span class="hs-identifier hs-var">instanceTy</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679068421"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068421"><span class="hs-identifier hs-var">viaTy</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068423"><span class="hs-keyword hs-var">via</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">ConT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="Data.Deriving.Internal.html#viaTypeName"><span class="hs-identifier hs-var">viaTypeName</span></a></span><span>
</span><span id="line-87"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068422"><span class="hs-identifier hs-var">instanceTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068421"><span class="hs-identifier hs-var">viaTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>         </span><span class="annot"><span class="annottext">(Type, Cxt)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">unlines</span></a></span><span>
</span><span id="line-89"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failure to meet &#8216;deriveVia&#8216; specification&quot;</span></span><span>
</span><span id="line-90"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\tThe &#8216;Via&#8216; type must be used, e.g.&quot;</span></span><span>
</span><span id="line-91"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\t[t| forall a. C (T a) `Via` V a |]&quot;</span></span><span>
</span><span id="line-92"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-comment">-- This is a stronger requirement than what GHC's implementation of</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-comment">-- DerivingVia imposes, but due to Template Haskell restrictions, we</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-comment">-- currently can't do better. See #27.</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068416"><span class="annot"><span class="annottext">viaTyFVs :: [Name]
</span><a href="#local-6989586621679068416"><span class="hs-identifier hs-var hs-var">viaTyFVs</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; a -&gt; [Name]
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">freeVariables</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068425"><span class="hs-identifier hs-var">viaTy</span></a></span><span>
</span><span id="line-97"></span><span>      </span><span id="local-6989586621679068409"><span class="annot"><span class="annottext">otherFVs :: [Name]
</span><a href="#local-6989586621679068409"><span class="hs-identifier hs-var hs-var">otherFVs</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; a -&gt; [Name]
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">freeVariables</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068429"><span class="hs-identifier hs-var">instanceCxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; a -&gt; [Name]
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">freeVariables</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068426"><span class="hs-identifier hs-var">instanceTy</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-98"></span><span>      </span><span id="local-6989586621679068405"><span class="annot"><span class="annottext">floatingViaTyFVs :: [Name]
</span><a href="#local-6989586621679068405"><span class="hs-identifier hs-var hs-var">floatingViaTyFVs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679068416"><span class="hs-identifier hs-var">viaTyFVs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">L.\\</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679068409"><span class="hs-identifier hs-var">otherFVs</span></a></span><span>
</span><span id="line-99"></span><span>      </span><span id="local-6989586621679068401"><span class="annot"><span class="annottext">floatingViaTySubst :: Map Name Type
</span><a href="#local-6989586621679068401"><span class="hs-identifier hs-var hs-var">floatingViaTySubst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">ConT</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Any</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679068405"><span class="hs-identifier hs-var">floatingViaTyFVs</span></a></span><span>
</span><span id="line-100"></span><span>      </span><span id="local-6989586621679068398"><span class="annot"><span class="annottext">viaTy' :: Type
</span><a href="#local-6989586621679068398"><span class="hs-identifier hs-var hs-var">viaTy'</span></a></span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; Map Name Type -&gt; a -&gt; a
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">applySubstitution</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679068401"><span class="hs-identifier hs-var">floatingViaTySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068425"><span class="hs-identifier hs-var">viaTy</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621679068396"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679068396"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type -&gt; Q [Dec]
</span><a href="Data.Deriving.Via.Internal.html#deriveViaDecs"><span class="hs-identifier hs-var">deriveViaDecs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068426"><span class="hs-identifier hs-var">instanceTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068398"><span class="hs-identifier hs-var">viaTy'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">`fmap`</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
Quote m =&gt;
m Cxt -&gt; m Type -&gt; [m Dec] -&gt; m Dec
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">instanceD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068429"><span class="hs-identifier hs-var">instanceCxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068426"><span class="hs-identifier hs-var">instanceTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679068396"><span class="hs-identifier hs-var">decs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="annot"><a href="Data.Deriving.Via.Internal.html#deriveViaDecs"><span class="hs-identifier hs-type">deriveViaDecs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span>       </span><span class="hs-comment">-- ^ The instance head (e.g., @Eq (Foo a)@)</span><span>
</span><span id="line-107"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-comment">-- ^ If using 'deriveGND', this is 'Nothing.</span><span>
</span><span id="line-108"></span><span>                            </span><span class="hs-comment">--   If using 'deriveVia', this is 'Just' the @via@ type.</span><span>
</span><span id="line-109"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-110"></span><span id="deriveViaDecs"><span class="annot"><span class="annottext">deriveViaDecs :: Type -&gt; Maybe Type -&gt; Q [Dec]
</span><a href="Data.Deriving.Via.Internal.html#deriveViaDecs"><span class="hs-identifier hs-var hs-var">deriveViaDecs</span></a></span></span><span> </span><span id="local-6989586621679068395"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068395"><span class="hs-identifier hs-var">instanceTy</span></a></span></span><span> </span><span id="local-6989586621679068394"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679068394"><span class="hs-identifier hs-var">mbViaTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068393"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068393"><span class="hs-identifier hs-var">clsTy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068392"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068392"><span class="hs-identifier hs-var">clsArgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, Cxt)
</span><a href="Data.Deriving.Internal.html#unapplyTy"><span class="hs-identifier hs-var">unapplyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068395"><span class="hs-identifier hs-var">instanceTy</span></a></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068393"><span class="hs-identifier hs-var">clsTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">ConT</span></a></span><span> </span><span id="local-6989586621679068391"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068391"><span class="hs-identifier hs-var">clsName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-114"></span><span>      </span><span id="local-6989586621679068390"><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679068390"><span class="hs-identifier hs-var">clsInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Q Info
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">reify</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068391"><span class="hs-identifier hs-var">clsName</span></a></span><span>
</span><span id="line-115"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621679068390"><span class="hs-identifier hs-var">clsInfo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">ClassI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">ClassD</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679068386"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679068386"><span class="hs-identifier hs-var">clsTvbs</span></a></span></span><span> </span><span class="annot"><span class="annottext">[FunDep]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679068385"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679068385"><span class="hs-identifier hs-var">clsDecs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-117"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe ([a], a)
</span><a href="Data.Deriving.Internal.html#unsnoc"><span class="hs-identifier hs-var">unsnoc</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068392"><span class="hs-identifier hs-var">clsArgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Maybe ([a], a)
</span><a href="Data.Deriving.Internal.html#unsnoc"><span class="hs-identifier hs-var">unsnoc</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679068386"><span class="hs-identifier hs-var">clsTvbs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-118"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068383"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068383"><span class="hs-identifier hs-var">dataApp</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068382"><span class="annot"><span class="annottext">TyVarBndr ()
</span><a href="#local-6989586621679068382"><span class="hs-identifier hs-var">clsLastTvb</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-119"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068381"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068381"><span class="hs-identifier hs-var">dataTy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068380"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068380"><span class="hs-identifier hs-var">dataArgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, Cxt)
</span><a href="Data.Deriving.Internal.html#unapplyTy"><span class="hs-identifier hs-var">unapplyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068383"><span class="hs-identifier hs-var">dataApp</span></a></span><span>
</span><span id="line-120"></span><span>                  </span><span id="local-6989586621679068379"><span class="annot"><span class="annottext">clsLastTvbKind :: Type
</span><a href="#local-6989586621679068379"><span class="hs-identifier hs-var hs-var">clsLastTvbKind</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Type
</span><a href="Data.Deriving.Internal.html#tvbKind"><span class="hs-identifier hs-var">tvbKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBndr ()
</span><a href="#local-6989586621679068382"><span class="hs-identifier hs-var">clsLastTvb</span></a></span><span>
</span><span id="line-121"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cxt
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068377"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068377"><span class="hs-identifier hs-var">kindList</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Cxt, Cxt)
</span><a href="Data.Deriving.Internal.html#uncurryTy"><span class="hs-identifier hs-var">uncurryTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068379"><span class="hs-identifier hs-var">clsLastTvbKind</span></a></span><span>
</span><span id="line-122"></span><span>                  </span><span id="local-6989586621679068371"><span class="annot"><span class="annottext">numArgsToEtaReduce :: Int
</span><a href="#local-6989586621679068371"><span class="hs-identifier hs-var hs-var">numArgsToEtaReduce</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068377"><span class="hs-identifier hs-var">kindList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-123"></span><span>              </span><span id="local-6989586621679068369"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068369"><span class="hs-identifier hs-var">repTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-124"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679068394"><span class="hs-identifier hs-var">mbViaTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-125"></span><span>                  </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679068368"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068368"><span class="hs-identifier hs-var">viaTy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068368"><span class="hs-identifier hs-var">viaTy</span></a></span><span>
</span><span id="line-126"></span><span>                  </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068381"><span class="hs-identifier hs-var">dataTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-128"></span><span>                      </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">ConT</span></a></span><span> </span><span id="local-6989586621679068367"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068367"><span class="hs-identifier hs-var">dataName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-129"></span><span>                        </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">DatatypeInfo</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-130"></span><span>                                       </span><span class="annot"><span class="annottext">datatypeInstTypes :: DatatypeInfo -&gt; Cxt
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">datatypeInstTypes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679068364"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068364"><span class="hs-identifier hs-var">dataInstTypes</span></a></span></span><span>
</span><span id="line-131"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">datatypeVariant :: DatatypeInfo -&gt; DatatypeVariant
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">datatypeVariant</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679068362"><span class="annot"><span class="annottext">DatatypeVariant
</span><a href="#local-6989586621679068362"><span class="hs-identifier hs-var">dv</span></a></span></span><span>
</span><span id="line-132"></span><span>                                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">datatypeCons :: DatatypeInfo -&gt; [ConstructorInfo]
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">datatypeCons</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679068360"><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679068360"><span class="hs-identifier hs-var">cons</span></a></span></span><span>
</span><span id="line-133"></span><span>                                     </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Q DatatypeInfo
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">reifyDatatype</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068367"><span class="hs-identifier hs-var">dataName</span></a></span><span>
</span><span id="line-134"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DatatypeVariant -&gt; [ConstructorInfo] -&gt; Maybe Type
</span><a href="Data.Deriving.Via.Internal.html#newtypeRepType"><span class="hs-identifier hs-var">newtypeRepType</span></a></span><span> </span><span class="annot"><span class="annottext">DatatypeVariant
</span><a href="#local-6989586621679068362"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679068360"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-135"></span><span>                          </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679068357"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068357"><span class="hs-identifier hs-var">newtypeRepTy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-136"></span><span>                            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Type -&gt; Maybe Type
</span><a href="Data.Deriving.Via.Internal.html#etaReduce"><span class="hs-identifier hs-var">etaReduce</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068371"><span class="hs-identifier hs-var">numArgsToEtaReduce</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068357"><span class="hs-identifier hs-var">newtypeRepTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-137"></span><span>                              </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679068355"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068355"><span class="hs-identifier hs-var">etaRepTy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-138"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068353"><span class="annot"><span class="annottext">repTySubst :: Map Name Type
</span><a href="#local-6989586621679068353"><span class="hs-identifier hs-var hs-var">repTySubst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-139"></span><span>                                      </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-140"></span><span>                                      </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679068351"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068351"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621679068350"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068350"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Name
</span><a href="Data.Deriving.Internal.html#varTToName"><span class="hs-identifier hs-var">varTToName</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068351"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068350"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>                                              </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068364"><span class="hs-identifier hs-var">dataInstTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068380"><span class="hs-identifier hs-var">dataArgs</span></a></span><span>
</span><span id="line-142"></span><span>                                </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; Map Name Type -&gt; a -&gt; a
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">applySubstitution</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679068353"><span class="hs-identifier hs-var">repTySubst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068355"><span class="hs-identifier hs-var">etaRepTy</span></a></span><span>
</span><span id="line-143"></span><span>                              </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Type -&gt; Q a
</span><a href="Data.Deriving.Internal.html#etaReductionError"><span class="hs-identifier hs-var">etaReductionError</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068395"><span class="hs-identifier hs-var">instanceTy</span></a></span><span>
</span><span id="line-144"></span><span>                          </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Not a newtype: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">nameBase</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068367"><span class="hs-identifier hs-var">dataName</span></a></span><span>
</span><span id="line-145"></span><span>                      </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Not a data type: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068381"><span class="hs-identifier hs-var">dataTy</span></a></span><span>
</span><span id="line-146"></span><span>              </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [Maybe a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [TyVarBndr ()] -&gt; Cxt -&gt; Type -&gt; Dec -&gt; Q (Maybe [Dec])
</span><a href="Data.Deriving.Via.Internal.html#deriveViaDecs%27"><span class="hs-identifier hs-var">deriveViaDecs'</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068391"><span class="hs-identifier hs-var">clsName</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679068386"><span class="hs-identifier hs-var">clsTvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068392"><span class="hs-identifier hs-var">clsArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068369"><span class="hs-identifier hs-var">repTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621679068385"><span class="hs-identifier hs-var">clsDecs</span></a></span><span>
</span><span id="line-147"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Cxt, Type)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ([TyVarBndr ()], TyVarBndr ())
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot derive instance for nullary class &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068393"><span class="hs-identifier hs-var">clsTy</span></a></span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><span class="annottext">Info
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Not a type class: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068393"><span class="hs-identifier hs-var">clsTy</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Malformed instance: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068395"><span class="hs-identifier hs-var">instanceTy</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="annot"><a href="Data.Deriving.Via.Internal.html#deriveViaDecs%27"><span class="hs-identifier hs-type">deriveViaDecs'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TyVarBndrUnit</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Dec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Dec</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span id="deriveViaDecs%27"><span class="annot"><span class="annottext">deriveViaDecs' :: Name -&gt; [TyVarBndr ()] -&gt; Cxt -&gt; Type -&gt; Dec -&gt; Q (Maybe [Dec])
</span><a href="Data.Deriving.Via.Internal.html#deriveViaDecs%27"><span class="hs-identifier hs-var hs-var">deriveViaDecs'</span></a></span></span><span> </span><span id="local-6989586621679068341"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068341"><span class="hs-identifier hs-var">clsName</span></a></span></span><span> </span><span id="local-6989586621679068340"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679068340"><span class="hs-identifier hs-var">clsTvbs</span></a></span></span><span> </span><span id="local-6989586621679068339"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068339"><span class="hs-identifier hs-var">clsArgs</span></a></span></span><span> </span><span id="local-6989586621679068338"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068338"><span class="hs-identifier hs-var">repTy</span></a></span></span><span> </span><span id="local-6989586621679068337"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679068337"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068335"><span class="annot"><span class="annottext">numExpectedArgs :: Int
</span><a href="#local-6989586621679068335"><span class="hs-identifier hs-var hs-var">numExpectedArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679068340"><span class="hs-identifier hs-var">clsTvbs</span></a></span><span>
</span><span id="line-154"></span><span>        </span><span id="local-6989586621679068333"><span class="annot"><span class="annottext">numActualArgs :: Int
</span><a href="#local-6989586621679068333"><span class="hs-identifier hs-var hs-var">numActualArgs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068339"><span class="hs-identifier hs-var">clsArgs</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068335"><span class="hs-identifier hs-var">numExpectedArgs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068333"><span class="hs-identifier hs-var">numActualArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-156"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Mismatched number of class arguments&quot;</span></span><span>
</span><span id="line-157"></span><span>          </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n\tThe class &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">nameBase</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068341"><span class="hs-identifier hs-var">clsName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; expects &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068335"><span class="hs-identifier hs-var">numExpectedArgs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; argument(s),&quot;</span></span><span>
</span><span id="line-158"></span><span>          </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n\tbut was provided &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068333"><span class="hs-identifier hs-var">numActualArgs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; argument(s).&quot;</span></span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">Dec -&gt; Q (Maybe [Dec])
</span><a href="#local-6989586621679068331"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679068337"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><a href="#local-6989586621679068331"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Dec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Q</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Dec</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621679068331"><span class="annot"><span class="annottext">go :: Dec -&gt; Q (Maybe [Dec])
</span><a href="#local-6989586621679068331"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">OpenTypeFamilyD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TypeFamilyHead</span></a></span><span> </span><span id="local-6989586621679068328"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068328"><span class="hs-identifier hs-var">tfName</span></a></span></span><span> </span><span id="local-6989586621679068327"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679068327"><span class="hs-identifier hs-var">tfTvbs</span></a></span></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-164"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679068326"><span class="annot"><span class="annottext">lhsSubst :: Map Name Type
</span><a href="#local-6989586621679068326"><span class="hs-identifier hs-var hs-var">lhsSubst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall flag. [TyVarBndr_ flag] -&gt; Cxt -&gt; Map Name Type
</span><a href="Data.Deriving.Via.Internal.html#zipTvbSubst"><span class="hs-identifier hs-var">zipTvbSubst</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679068340"><span class="hs-identifier hs-var">clsTvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068339"><span class="hs-identifier hs-var">clsArgs</span></a></span><span>
</span><span id="line-165"></span><span>          </span><span id="local-6989586621679068324"><span class="annot"><span class="annottext">rhsSubst :: Map Name Type
</span><a href="#local-6989586621679068324"><span class="hs-identifier hs-var hs-var">rhsSubst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall flag. [TyVarBndr_ flag] -&gt; Cxt -&gt; Map Name Type
</span><a href="Data.Deriving.Via.Internal.html#zipTvbSubst"><span class="hs-identifier hs-var">zipTvbSubst</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679068340"><span class="hs-identifier hs-var">clsTvbs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a -&gt; [a]
</span><a href="Data.Deriving.Via.Internal.html#changeLast"><span class="hs-identifier hs-var">changeLast</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068339"><span class="hs-identifier hs-var">clsArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068338"><span class="hs-identifier hs-var">repTy</span></a></span><span>
</span><span id="line-166"></span><span>          </span><span id="local-6989586621679068322"><span class="annot"><span class="annottext">tfTvbTys :: Cxt
</span><a href="#local-6989586621679068322"><span class="hs-identifier hs-var hs-var">tfTvbTys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Type
</span><a href="Data.Deriving.Internal.html#tvbToType"><span class="hs-identifier hs-var">tvbToType</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679068327"><span class="hs-identifier hs-var">tfTvbs</span></a></span><span>
</span><span id="line-167"></span><span>          </span><span id="local-6989586621679068319"><span class="annot"><span class="annottext">tfLHSTys :: Cxt
</span><a href="#local-6989586621679068319"><span class="hs-identifier hs-var hs-var">tfLHSTys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; Map Name Type -&gt; a -&gt; a
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">applySubstitution</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679068326"><span class="hs-identifier hs-var">lhsSubst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068322"><span class="hs-identifier hs-var">tfTvbTys</span></a></span><span>
</span><span id="line-168"></span><span>          </span><span id="local-6989586621679068317"><span class="annot"><span class="annottext">tfRHSTys :: Cxt
</span><a href="#local-6989586621679068317"><span class="hs-identifier hs-var hs-var">tfRHSTys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; Map Name Type -&gt; a -&gt; a
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">applySubstitution</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679068324"><span class="hs-identifier hs-var">rhsSubst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068322"><span class="hs-identifier hs-var">tfTvbTys</span></a></span><span>
</span><span id="line-169"></span><span>          </span><span id="local-6989586621679068316"><span class="annot"><span class="annottext">tfRHSTy :: Type
</span><a href="#local-6989586621679068316"><span class="hs-identifier hs-var hs-var">tfRHSTy</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Cxt -&gt; Type
</span><a href="Data.Deriving.Internal.html#applyTy"><span class="hs-identifier hs-var">applyTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">ConT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068328"><span class="hs-identifier hs-var">tfName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068317"><span class="hs-identifier hs-var">tfRHSTys</span></a></span><span>
</span><span id="line-170"></span><span>      </span><span id="local-6989586621679068314"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679068314"><span class="hs-identifier hs-var">tfInst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe [Q (TyVarBndr ())] -&gt; [Q Type] -&gt; Q Type -&gt; DecQ
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">tySynInstDCompat</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068328"><span class="hs-identifier hs-var">tfName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-171"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068319"><span class="hs-identifier hs-var">tfLHSTys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068316"><span class="hs-identifier hs-var">tfRHSTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679068314"><span class="hs-identifier hs-var">tfInst</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><a href="#local-6989586621679068331"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">SigD</span></a></span><span> </span><span id="local-6989586621679068311"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068311"><span class="hs-identifier hs-var">methName</span></a></span></span><span> </span><span id="local-6989586621679068310"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068310"><span class="hs-identifier hs-var">methTy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068309"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068309"><span class="hs-identifier hs-var">fromTy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068308"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068308"><span class="hs-identifier hs-var">toTy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()] -&gt; Cxt -&gt; Type -&gt; Type -&gt; (Type, Type)
</span><a href="Data.Deriving.Via.Internal.html#mkCoerceClassMethEqn"><span class="hs-identifier hs-var">mkCoerceClassMethEqn</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679068340"><span class="hs-identifier hs-var">clsTvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068339"><span class="hs-identifier hs-var">clsArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068338"><span class="hs-identifier hs-var">repTy</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-176"></span><span>                           </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="Data.Deriving.Via.Internal.html#stripOuterForallT"><span class="hs-identifier hs-var">stripOuterForallT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068310"><span class="hs-identifier hs-var">methTy</span></a></span><span>
</span><span id="line-177"></span><span>          </span><span id="local-6989586621679068305"><span class="annot"><span class="annottext">fromTau :: Type
</span><a href="#local-6989586621679068305"><span class="hs-identifier hs-var hs-var">fromTau</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="Data.Deriving.Via.Internal.html#stripOuterForallT"><span class="hs-identifier hs-var">stripOuterForallT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068309"><span class="hs-identifier hs-var">fromTy</span></a></span><span>
</span><span id="line-178"></span><span>          </span><span id="local-6989586621679068304"><span class="annot"><span class="annottext">toTau :: Type
</span><a href="#local-6989586621679068304"><span class="hs-identifier hs-var hs-var">toTau</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="Data.Deriving.Via.Internal.html#stripOuterForallT"><span class="hs-identifier hs-var">stripOuterForallT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068308"><span class="hs-identifier hs-var">toTy</span></a></span><span>
</span><span id="line-179"></span><span>          </span><span id="local-6989586621679068303"><span class="annot"><span class="annottext">rhsExpr :: Exp
</span><a href="#local-6989586621679068303"><span class="hs-identifier hs-var hs-var">rhsExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="Data.Deriving.Internal.html#coerceValName"><span class="hs-identifier hs-var">coerceValName</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; Type -&gt; Exp
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-operator hs-var">`AppTypeE`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068305"><span class="hs-identifier hs-var">fromTau</span></a></span><span>
</span><span id="line-180"></span><span>                                       </span><span class="annot"><span class="annottext">Exp -&gt; Type -&gt; Exp
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-operator hs-var">`AppTypeE`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068304"><span class="hs-identifier hs-var">toTau</span></a></span><span>
</span><span id="line-181"></span><span>                                       </span><span class="annot"><span class="annottext">Exp -&gt; Exp -&gt; Exp
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-operator hs-var">`AppE`</span></a></span><span>     </span><span class="annot"><span class="annottext">Name -&gt; Exp
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">VarE</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068311"><span class="hs-identifier hs-var">methName</span></a></span><span>
</span><span id="line-182"></span><span>          </span><span id="local-6989586621679068298"><span class="annot"><span class="annottext">sig :: Dec
</span><a href="#local-6989586621679068298"><span class="hs-identifier hs-var hs-var">sig</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Dec
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">SigD</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068311"><span class="hs-identifier hs-var">methName</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068308"><span class="hs-identifier hs-var">toTy</span></a></span><span>
</span><span id="line-183"></span><span>          </span><span id="local-6989586621679068297"><span class="annot"><span class="annottext">meth :: Dec
</span><a href="#local-6989586621679068297"><span class="hs-identifier hs-var hs-var">meth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pat -&gt; Body -&gt; [Dec] -&gt; Dec
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">ValD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Pat
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">VarP</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679068311"><span class="hs-identifier hs-var">methName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; Body
</span><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-var">NormalB</span></a></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679068303"><span class="hs-identifier hs-var">rhsExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>                      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-186"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679068298"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621679068297"><span class="hs-identifier hs-var">meth</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><a href="#local-6989586621679068331"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="annot"><a href="Data.Deriving.Via.Internal.html#mkCoerceClassMethEqn"><span class="hs-identifier hs-type">mkCoerceClassMethEqn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TyVarBndrUnit</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span id="mkCoerceClassMethEqn"><span class="annot"><span class="annottext">mkCoerceClassMethEqn :: [TyVarBndr ()] -&gt; Cxt -&gt; Type -&gt; Type -&gt; (Type, Type)
</span><a href="Data.Deriving.Via.Internal.html#mkCoerceClassMethEqn"><span class="hs-identifier hs-var hs-var">mkCoerceClassMethEqn</span></a></span></span><span> </span><span id="local-6989586621679068293"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679068293"><span class="hs-identifier hs-var">clsTvbs</span></a></span></span><span> </span><span id="local-6989586621679068292"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068292"><span class="hs-identifier hs-var">clsArgs</span></a></span></span><span> </span><span id="local-6989586621679068291"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068291"><span class="hs-identifier hs-var">repTy</span></a></span></span><span> </span><span id="local-6989586621679068290"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068290"><span class="hs-identifier hs-var">methTy</span></a></span></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; Map Name Type -&gt; a -&gt; a
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">applySubstitution</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679068289"><span class="hs-identifier hs-var">rhsSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068290"><span class="hs-identifier hs-var">methTy</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. TypeSubstitution a =&gt; Map Name Type -&gt; a -&gt; a
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">applySubstitution</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Type
</span><a href="#local-6989586621679068288"><span class="hs-identifier hs-var">lhsSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068290"><span class="hs-identifier hs-var">methTy</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621679068288"><span class="annot"><span class="annottext">lhsSubst :: Map Name Type
</span><a href="#local-6989586621679068288"><span class="hs-identifier hs-var hs-var">lhsSubst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall flag. [TyVarBndr_ flag] -&gt; Cxt -&gt; Map Name Type
</span><a href="Data.Deriving.Via.Internal.html#zipTvbSubst"><span class="hs-identifier hs-var">zipTvbSubst</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679068293"><span class="hs-identifier hs-var">clsTvbs</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068292"><span class="hs-identifier hs-var">clsArgs</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span id="local-6989586621679068289"><span class="annot"><span class="annottext">rhsSubst :: Map Name Type
</span><a href="#local-6989586621679068289"><span class="hs-identifier hs-var hs-var">rhsSubst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall flag. [TyVarBndr_ flag] -&gt; Cxt -&gt; Map Name Type
</span><a href="Data.Deriving.Via.Internal.html#zipTvbSubst"><span class="hs-identifier hs-var">zipTvbSubst</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621679068293"><span class="hs-identifier hs-var">clsTvbs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a -&gt; [a]
</span><a href="Data.Deriving.Via.Internal.html#changeLast"><span class="hs-identifier hs-var">changeLast</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068292"><span class="hs-identifier hs-var">clsArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068291"><span class="hs-identifier hs-var">repTy</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span id="local-6989586621679068531"><span class="annot"><a href="Data.Deriving.Via.Internal.html#zipTvbSubst"><span class="hs-identifier hs-type">zipTvbSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">TyVarBndr_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679068531"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span></span><span>
</span><span id="line-200"></span><span id="zipTvbSubst"><span class="annot"><span class="annottext">zipTvbSubst :: forall flag. [TyVarBndr_ flag] -&gt; Cxt -&gt; Map Name Type
</span><a href="Data.Deriving.Via.Internal.html#zipTvbSubst"><span class="hs-identifier hs-var hs-var">zipTvbSubst</span></a></span></span><span> </span><span id="local-6989586621679068286"><span class="annot"><span class="annottext">[TyVarBndr_ flag]
</span><a href="#local-6989586621679068286"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679068285"><span class="annot"><span class="annottext">TyVarBndr_ flag
</span><a href="#local-6989586621679068285"><span class="hs-identifier hs-var">tvb</span></a></span></span><span> </span><span id="local-6989586621679068284"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068284"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall flag. TyVarBndr_ flag -&gt; Name
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">tvName</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBndr_ flag
</span><a href="#local-6989586621679068285"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068284"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr_ flag]
</span><a href="#local-6989586621679068286"><span class="hs-identifier hs-var">tvbs</span></a></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-comment">-- | Replace the last element of a list with another element.</span><span>
</span><span id="line-203"></span><span id="local-6989586621679068530"><span class="annot"><a href="Data.Deriving.Via.Internal.html#changeLast"><span class="hs-identifier hs-type">changeLast</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679068530"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679068530"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679068530"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-204"></span><span id="changeLast"><span class="annot"><span class="annottext">changeLast :: forall a. [a] -&gt; a -&gt; [a]
</span><a href="Data.Deriving.Via.Internal.html#changeLast"><span class="hs-identifier hs-var hs-var">changeLast</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;changeLast&quot;</span></span><span>
</span><span id="line-205"></span><span class="annot"><a href="Data.Deriving.Via.Internal.html#changeLast"><span class="hs-identifier hs-var">changeLast</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span>    </span><span id="local-6989586621679068279"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679068279"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679068279"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-206"></span><span class="annot"><a href="Data.Deriving.Via.Internal.html#changeLast"><span class="hs-identifier hs-var">changeLast</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068278"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679068278"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621679068277"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679068277"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679068276"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679068276"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679068278"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a -&gt; [a]
</span><a href="Data.Deriving.Via.Internal.html#changeLast"><span class="hs-identifier hs-var">changeLast</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679068277"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679068276"><span class="hs-identifier hs-var">x'</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="annot"><a href="Data.Deriving.Via.Internal.html#stripOuterForallT"><span class="hs-identifier hs-type">stripOuterForallT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 807
</span><span class="hs-comment">-- Before GHC 8.7, TH-reified classes would put a redundant forall/class</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- context in front of each method's type signature, so we have to strip them</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- off here.</span><span>
</span><span id="line-213"></span><span class="hs-identifier">stripOuterForallT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ForallT</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ty</span><span class="hs-cpp">
#endif
</span><span id="stripOuterForallT"><span class="annot"><span class="annottext">stripOuterForallT :: Type -&gt; Type
</span><a href="Data.Deriving.Via.Internal.html#stripOuterForallT"><span class="hs-identifier hs-var hs-var">stripOuterForallT</span></a></span></span><span> </span><span id="local-6989586621679068275"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068275"><span class="hs-identifier hs-var">ty</span></a></span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068275"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="annot"><a href="Data.Deriving.Via.Internal.html#decomposeType"><span class="hs-identifier hs-type">decomposeType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">TyVarBndrSpec</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Cxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span id="decomposeType"><span class="annot"><span class="annottext">decomposeType :: Type -&gt; ([TyVarBndrSpec], Cxt, Type)
</span><a href="Data.Deriving.Via.Internal.html#decomposeType"><span class="hs-identifier hs-var hs-var">decomposeType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">ForallT</span></a></span><span> </span><span id="local-6989586621679068273"><span class="annot"><span class="annottext">[TyVarBndrSpec]
</span><a href="#local-6989586621679068273"><span class="hs-identifier hs-var">tvbs</span></a></span></span><span> </span><span id="local-6989586621679068272"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068272"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621679068271"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068271"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndrSpec]
</span><a href="#local-6989586621679068273"><span class="hs-identifier hs-var">tvbs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068272"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068271"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span class="annot"><a href="Data.Deriving.Via.Internal.html#decomposeType"><span class="hs-identifier hs-var">decomposeType</span></a></span><span> </span><span id="local-6989586621679068270"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068270"><span class="hs-identifier hs-var">ty</span></a></span></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>   </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068270"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="annot"><a href="Data.Deriving.Via.Internal.html#newtypeRepType"><span class="hs-identifier hs-type">newtypeRepType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">DatatypeVariant</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">ConstructorInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-222"></span><span id="newtypeRepType"><span class="annot"><span class="annottext">newtypeRepType :: DatatypeVariant -&gt; [ConstructorInfo] -&gt; Maybe Type
</span><a href="Data.Deriving.Via.Internal.html#newtypeRepType"><span class="hs-identifier hs-var hs-var">newtypeRepType</span></a></span></span><span> </span><span id="local-6989586621679068269"><span class="annot"><span class="annottext">DatatypeVariant
</span><a href="#local-6989586621679068269"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span id="local-6989586621679068268"><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679068268"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><span class="annottext">Maybe ()
</span><a href="#local-6989586621679068267"><span class="hs-identifier hs-var">checkIfNewtype</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><a href="#local-6989586621679068268"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-225"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-type">ConstructorInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">constructorVars :: ConstructorInfo -&gt; [TyVarBndr ()]
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">constructorVars</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-226"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">constructorContext :: ConstructorInfo -&gt; Cxt
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">constructorContext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-227"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">constructorFields :: ConstructorInfo -&gt; Cxt
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">constructorFields</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span id="local-6989586621679068262"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068262"><span class="hs-identifier hs-var">repTy</span></a></span></span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>                       </span><span class="hs-special">}</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068262"><span class="hs-identifier hs-var">repTy</span></a></span><span>
</span><span id="line-229"></span><span>      </span><span class="annot"><span class="annottext">[ConstructorInfo]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><a href="#local-6989586621679068267"><span class="hs-identifier hs-type">checkIfNewtype</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621679068267"><span class="annot"><span class="annottext">checkIfNewtype :: Maybe ()
</span><a href="#local-6989586621679068267"><span class="hs-identifier hs-var hs-var">checkIfNewtype</span></a></span></span><span>
</span><span id="line-233"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DatatypeVariant
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">Newtype</span></a></span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DatatypeVariant
</span><a href="#local-6989586621679068269"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DatatypeVariant
</span><a href="../../../../th-abstraction/html/src"><span class="hs-identifier hs-var">NewtypeInstance</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DatatypeVariant
</span><a href="#local-6989586621679068269"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="annot"><a href="Data.Deriving.Via.Internal.html#etaReduce"><span class="hs-identifier hs-type">etaReduce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/template-haskell-2.18.0.0/src"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-238"></span><span id="etaReduce"><span class="annot"><span class="annottext">etaReduce :: Int -&gt; Type -&gt; Maybe Type
</span><a href="Data.Deriving.Via.Internal.html#etaReduce"><span class="hs-identifier hs-var hs-var">etaReduce</span></a></span></span><span> </span><span id="local-6989586621679068259"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068259"><span class="hs-identifier hs-var">num</span></a></span></span><span> </span><span id="local-6989586621679068258"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068258"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679068257"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068257"><span class="hs-identifier hs-var">tyHead</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068256"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068256"><span class="hs-identifier hs-var">tyArgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, Cxt)
</span><a href="Data.Deriving.Internal.html#unapplyTy"><span class="hs-identifier hs-var">unapplyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068258"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679068253"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068253"><span class="hs-identifier hs-var">tyArgsRemaining</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679068252"><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068252"><span class="hs-identifier hs-var">tyArgsDropped</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; ([a], [a])
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">splitAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068256"><span class="hs-identifier hs-var">tyArgs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679068259"><span class="hs-identifier hs-var">num</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068256"><span class="hs-identifier hs-var">tyArgs</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Cxt -&gt; Cxt -&gt; Bool
</span><a href="Data.Deriving.Internal.html#canEtaReduce"><span class="hs-identifier hs-var">canEtaReduce</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068253"><span class="hs-identifier hs-var">tyArgsRemaining</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068252"><span class="hs-identifier hs-var">tyArgsDropped</span></a></span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Cxt -&gt; Type
</span><a href="Data.Deriving.Internal.html#applyTy"><span class="hs-identifier hs-var">applyTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679068257"><span class="hs-identifier hs-var">tyHead</span></a></span><span> </span><span class="annot"><span class="annottext">Cxt
</span><a href="#local-6989586621679068253"><span class="hs-identifier hs-var">tyArgsRemaining</span></a></span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-cpp">
#endif
</span></pre></body></html>