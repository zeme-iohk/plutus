<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Foundation.Time.StopWatch</span><span>
</span><span id="line-4"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Foundation.Time.StopWatch.html#StopWatchPrecise"><span class="hs-identifier">StopWatchPrecise</span></a></span><span>
</span><span id="line-5"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Foundation.Time.StopWatch.html#startPrecise"><span class="hs-identifier">startPrecise</span></a></span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Foundation.Time.StopWatch.html#stopPrecise"><span class="hs-identifier">stopPrecise</span></a></span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../basement/html/src"><span class="hs-identifier">Basement.Imports</span></a></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../basement/html/src"><span class="hs-identifier">Basement.Types.Ptr</span></a></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Foundation.Time.Types.html"><span class="hs-identifier">Foundation.Time.Types</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../basement/html/src"><span class="hs-identifier">Basement.Block.Mutable</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Foundation.Numerical.html"><span class="hs-identifier">Foundation.Numerical</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Foreign.Storable</span></a></span><span class="hs-cpp">

#if defined(mingw32_HOST_OS)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Win32.Time</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Basement.Monad</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Basement.IntegralConv</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO.Unsafe</span><span class="hs-cpp">
#elif defined(darwin_HOST_OS)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foundation.System.Bindings.Macos</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Basement.IntegralConv</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO.Unsafe</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Basement.Types.OffsetSize</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Foundation.System.Bindings.Time.html"><span class="hs-identifier">Foundation.System.Bindings.Time</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../basement/html/src"><span class="hs-identifier">Basement.Monad</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../basement/html/src"><span class="hs-identifier">Basement.Types.OffsetSize</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- | A precise stop watch</span><span>
</span><span id="line-33"></span><span class="hs-comment">--</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- The precision is higher than a normal stopwatch, but</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- also on some system it might not be able to record</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- longer period of time accurately (possibly wrapping)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">newtype</span><span> </span><span id="StopWatchPrecise"><span class="annot"><a href="Foundation.Time.StopWatch.html#StopWatchPrecise"><span class="hs-identifier hs-var">StopWatchPrecise</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="hs-cpp">
#if defined(darwin_HOST_OS)
</span><span>    </span><span class="hs-identifier">StopWatchPrecise</span><span> </span><span class="hs-identifier">Word64</span><span class="hs-cpp">
#elif defined(mingw32_HOST_OS)
</span><span>    </span><span class="hs-comment">-- contain 2 LARGE_INTEGER (int64_t)</span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-identifier">StopWatchPrecise</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">MutableBlock</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">PrimState</span><span> </span><span class="hs-identifier">IO</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-comment">-- contains 2 timespec (16 bytes)</span><span>
</span><span id="line-45"></span><span>    </span><span id="StopWatchPrecise"><span class="annot"><a href="Foundation.Time.StopWatch.html#StopWatchPrecise"><span class="hs-identifier hs-var">StopWatchPrecise</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../basement/html/src"><span class="hs-identifier hs-type">MutableBlock</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Word8</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../basement/html/src"><span class="hs-identifier hs-type">PrimState</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span class="hs-identifier">initPrecise</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Word64</span><span>
</span><span id="line-50"></span><span class="hs-identifier">initPrecise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafePerformIO</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">integralDownsize</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">queryPerformanceFrequency</span><span>
</span><span id="line-51"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="hs-pragma">initPrecise</span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#elif defined(darwin_HOST_OS)
</span><span class="hs-identifier">initPrecise</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Word64</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Word64</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-identifier">initPrecise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafePerformIO</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-identifier">mti</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newPinned</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sizeOfCSize</span><span> </span><span class="hs-identifier">size_MachTimebaseInfo</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-identifier">withMutablePtr</span><span> </span><span class="hs-identifier">mti</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-57"></span><span>        </span><span class="hs-identifier">sysMacos_timebase_info</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">p32</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word32</span><span>
</span><span id="line-59"></span><span>        </span><span class="hs-glyph">!</span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">peek</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">p32</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ptrPlus</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">ofs_MachTimebaseInfo_numer</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>        </span><span class="hs-glyph">!</span><span class="hs-identifier">d</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">peek</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">p32</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ptrPlus</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">ofs_MachTimebaseInfo_denom</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">integralUpsize</span><span> </span><span class="hs-identifier">n</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">integralUpsize</span><span> </span><span class="hs-identifier">d</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="hs-pragma">initPrecise</span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- | Create a new precise stop watch</span><span>
</span><span id="line-66"></span><span class="hs-comment">--</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- record the time at start of call</span><span>
</span><span id="line-68"></span><span class="annot"><a href="Foundation.Time.StopWatch.html#startPrecise"><span class="hs-identifier hs-type">startPrecise</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Foundation.Time.StopWatch.html#StopWatchPrecise"><span class="hs-identifier hs-type">StopWatchPrecise</span></a></span><span>
</span><span id="line-69"></span><span id="startPrecise"><span class="annot"><span class="annottext">startPrecise :: IO StopWatchPrecise
</span><a href="Foundation.Time.StopWatch.html#startPrecise"><span class="hs-identifier hs-var hs-var">startPrecise</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>    </span><span class="hs-identifier">blk</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newPinned</span><span> </span><span class="hs-number">16</span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withMutablePtr</span><span> </span><span class="hs-identifier">blk</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-73"></span><span>          </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">integralDownsize</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">queryPerformanceCounter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Word64</span><span>
</span><span id="line-74"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">p64</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word64</span><span>
</span><span id="line-75"></span><span>          </span><span class="hs-identifier">poke</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">p64</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ptrPlus</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ticks</span><span>
</span><span id="line-76"></span><span>          </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">p</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">StopWatchPrecise</span><span> </span><span class="hs-identifier">blk</span><span class="hs-special">)</span><span class="hs-cpp">
#elif defined(darwin_HOST_OS)
</span><span>    </span><span class="hs-identifier">StopWatchPrecise</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">sysMacos_absolute_time</span><span class="hs-cpp">
#else
</span><span>    </span><span id="local-6989586621679167880"><span class="annot"><span class="annottext">MutableBlock Word8 RealWorld
</span><a href="#local-6989586621679167880"><span class="hs-identifier hs-var">blk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (prim :: * -&gt; *) ty.
(PrimMonad prim, PrimType ty) =&gt;
CountOf ty -&gt; prim (MutableBlock ty (PrimState prim))
</span><a href="../../../../basement/html/src"><span class="hs-identifier hs-var">newPinned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CSize -&gt; CountOf Word8
</span><a href="../../../../basement/html/src"><span class="hs-identifier hs-var">sizeOfCSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CSize
</span><a href="Foundation.System.Bindings.Time.html#size_CTimeSpec"><span class="hs-identifier hs-var">size_CTimeSpec</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Additive a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../basement/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="Foundation.System.Bindings.Time.html#size_CTimeSpec"><span class="hs-identifier hs-var">size_CTimeSpec</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>    </span><span id="local-6989586621679167875"><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679167875"><span class="hs-identifier hs-var">_err1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (prim :: * -&gt; *) ty a.
PrimMonad prim =&gt;
MutableBlock ty (PrimState prim) -&gt; (Ptr ty -&gt; prim a) -&gt; prim a
</span><a href="../../../../basement/html/src"><span class="hs-identifier hs-var">withMutablePtr</span></a></span><span> </span><span class="annot"><span class="annottext">MutableBlock Word8 RealWorld
</span><a href="#local-6989586621679167880"><span class="hs-identifier hs-var">blk</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679167873"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679167873"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-83"></span><span>        </span><span class="annot"><span class="annottext">CInt -&gt; Ptr CTimeSpec -&gt; IO CInt
</span><a href="Foundation.System.Bindings.Time.html#sysTimeClockGetTime"><span class="hs-identifier hs-var">sysTimeClockGetTime</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="Foundation.System.Bindings.Time.html#sysTime_CLOCK_MONOTONIC"><span class="hs-identifier hs-var">sysTime_CLOCK_MONOTONIC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Ptr a -&gt; Ptr b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">castPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679167873"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ptr a -&gt; CSize -&gt; Ptr a
</span><a href="../../../../basement/html/src"><span class="hs-operator hs-var">`ptrPlusCSz`</span></a></span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="Foundation.System.Bindings.Time.html#size_CTimeSpec"><span class="hs-identifier hs-var">size_CTimeSpec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutableBlock Word8 (PrimState IO) -&gt; StopWatchPrecise
</span><a href="Foundation.Time.StopWatch.html#StopWatchPrecise"><span class="hs-identifier hs-var">StopWatchPrecise</span></a></span><span> </span><span class="annot"><span class="annottext">MutableBlock Word8 RealWorld
</span><a href="#local-6989586621679167880"><span class="hs-identifier hs-var">blk</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- | Get the number of nano seconds since the call to `startPrecise`</span><span>
</span><span id="line-88"></span><span class="annot"><a href="Foundation.Time.StopWatch.html#stopPrecise"><span class="hs-identifier hs-type">stopPrecise</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Foundation.Time.StopWatch.html#StopWatchPrecise"><span class="hs-identifier hs-type">StopWatchPrecise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Foundation.Time.Types.html#NanoSeconds"><span class="hs-identifier hs-type">NanoSeconds</span></a></span><span>
</span><span id="line-89"></span><span id="stopPrecise"><span class="annot"><span class="annottext">stopPrecise :: StopWatchPrecise -&gt; IO NanoSeconds
</span><a href="Foundation.Time.StopWatch.html#stopPrecise"><span class="hs-identifier hs-var hs-var">stopPrecise</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Foundation.Time.StopWatch.html#StopWatchPrecise"><span class="hs-identifier hs-type">StopWatchPrecise</span></a></span><span> </span><span id="local-6989586621679167868"><span class="annot"><span class="annottext">MutableBlock Word8 (PrimState IO)
</span><a href="#local-6989586621679167868"><span class="hs-identifier hs-var">blk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>    </span><span class="hs-identifier">withMutablePtr</span><span> </span><span class="hs-identifier">blk</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-identifier">end</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">integralDownsize</span><span> </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">queryPerformanceCounter</span><span>
</span><span id="line-93"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">p64</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word64</span><span>
</span><span id="line-94"></span><span>        </span><span class="hs-identifier">start</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">peek</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">p64</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ptrPlus</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">NanoSeconds</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">end</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">start</span><span class="hs-special">)</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-identifier">secondInNano</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">div</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">initPrecise</span><span class="hs-special">)</span><span class="hs-cpp">
#elif defined(darwin_HOST_OS)
</span><span>    </span><span class="hs-identifier">end</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">sysMacos_absolute_time</span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">NanoSeconds</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">initPrecise</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">end</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">blk</span><span>
</span><span id="line-100"></span><span>        </span><span class="hs-special">(</span><span class="hs-identifier">numer</span><span class="hs-special">,</span><span class="hs-identifier">denom</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">end</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">blk</span><span class="hs-special">)</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-identifier">numer</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">div</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">denom</span><span class="hs-cpp">
#else
</span><span>    </span><span class="annot"><span class="annottext">forall (prim :: * -&gt; *) ty a.
PrimMonad prim =&gt;
MutableBlock ty (PrimState prim) -&gt; (Ptr ty -&gt; prim a) -&gt; prim a
</span><a href="../../../../basement/html/src"><span class="hs-identifier hs-var">withMutablePtr</span></a></span><span> </span><span class="annot"><span class="annottext">MutableBlock Word8 (PrimState IO)
</span><a href="#local-6989586621679167868"><span class="hs-identifier hs-var">blk</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679167867"><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679167867"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-103"></span><span>        </span><span id="local-6989586621679167866"><span class="annot"><span class="annottext">CInt
</span><a href="#local-6989586621679167866"><span class="hs-identifier hs-var">_err1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CInt -&gt; Ptr CTimeSpec -&gt; IO CInt
</span><a href="Foundation.System.Bindings.Time.html#sysTimeClockGetTime"><span class="hs-identifier hs-var">sysTimeClockGetTime</span></a></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="Foundation.System.Bindings.Time.html#sysTime_CLOCK_MONOTONIC"><span class="hs-identifier hs-var">sysTime_CLOCK_MONOTONIC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. Ptr a -&gt; Ptr b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">castPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679167867"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679167865"><span class="annot"><span class="annottext">p64 :: Ptr Word64
</span><a href="#local-6989586621679167865"><span class="hs-identifier hs-var hs-var">p64</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. Ptr a -&gt; Ptr b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">castPtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word8
</span><a href="#local-6989586621679167867"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Word64</span></a></span><span>
</span><span id="line-105"></span><span>        </span><span id="local-6989586621679167864"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679167864"><span class="hs-identifier hs-var">endSec</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">peek</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr Word64
</span><a href="#local-6989586621679167865"><span class="hs-identifier hs-var">p64</span></a></span><span>
</span><span id="line-106"></span><span>        </span><span id="local-6989586621679167862"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679167862"><span class="hs-identifier hs-var">startSec</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">peek</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word64
</span><a href="#local-6989586621679167865"><span class="hs-identifier hs-var">p64</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ptr a -&gt; CSize -&gt; Ptr a
</span><a href="../../../../basement/html/src"><span class="hs-operator hs-var">`ptrPlusCSz`</span></a></span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="Foundation.System.Bindings.Time.html#size_CTimeSpec"><span class="hs-identifier hs-var">size_CTimeSpec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>        </span><span id="local-6989586621679167861"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679167861"><span class="hs-identifier hs-var">endNSec</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">peek</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word64
</span><a href="#local-6989586621679167865"><span class="hs-identifier hs-var">p64</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ptr a -&gt; Offset Word8 -&gt; Ptr a
</span><a href="../../../../basement/html/src"><span class="hs-operator hs-var">`ptrPlus`</span></a></span><span> </span><span class="annot"><span class="annottext">Offset Word8
</span><a href="Foundation.System.Bindings.Time.html#ofs_CTimeSpec_NanoSeconds"><span class="hs-identifier hs-var">ofs_CTimeSpec_NanoSeconds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>        </span><span id="local-6989586621679167858"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679167858"><span class="hs-identifier hs-var">startNSec</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">peek</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr Word64
</span><a href="#local-6989586621679167865"><span class="hs-identifier hs-var">p64</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ptr a -&gt; Offset Word8 -&gt; Ptr a
</span><a href="../../../../basement/html/src"><span class="hs-operator hs-var">`ptrPlus`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. CountOf a -&gt; Offset a
</span><a href="../../../../basement/html/src"><span class="hs-identifier hs-var">sizeAsOffset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CSize -&gt; CountOf Word8
</span><a href="../../../../basement/html/src"><span class="hs-identifier hs-var">sizeOfCSize</span></a></span><span> </span><span class="annot"><span class="annottext">CSize
</span><a href="Foundation.System.Bindings.Time.html#size_CTimeSpec"><span class="hs-identifier hs-var">size_CTimeSpec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Additive a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../basement/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Offset Word8
</span><a href="Foundation.System.Bindings.Time.html#ofs_CTimeSpec_NanoSeconds"><span class="hs-identifier hs-var">ofs_CTimeSpec_NanoSeconds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; NanoSeconds
</span><a href="Foundation.Time.Types.html#NanoSeconds"><span class="hs-identifier hs-var">NanoSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679167864"><span class="hs-identifier hs-var">endSec</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Multiplicative a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../basement/html/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="Foundation.Time.StopWatch.html#secondInNano"><span class="hs-identifier hs-var">secondInNano</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Additive a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../basement/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679167861"><span class="hs-identifier hs-var">endNSec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Subtractive a =&gt; a -&gt; a -&gt; Difference a
</span><a href="../../../../basement/html/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679167862"><span class="hs-identifier hs-var">startSec</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Multiplicative a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../basement/html/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="Foundation.Time.StopWatch.html#secondInNano"><span class="hs-identifier hs-var">secondInNano</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Additive a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../basement/html/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679167858"><span class="hs-identifier hs-var">startNSec</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if !defined(darwin_HOST_OS)
</span><span class="annot"><a href="Foundation.Time.StopWatch.html#secondInNano"><span class="hs-identifier hs-type">secondInNano</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Word64</span></a></span><span>
</span><span id="line-114"></span><span id="secondInNano"><span class="annot"><span class="annottext">secondInNano :: Word64
</span><a href="Foundation.Time.StopWatch.html#secondInNano"><span class="hs-identifier hs-var hs-var">secondInNano</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1000000000</span></span><span class="hs-cpp">
#endif
</span></pre></body></html>