

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.8.4. Default method signatures &mdash; Glasgow Haskell Compiler 9.2.5 User&#39;s Guide</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Glasgow Haskell Compiler 9.2.5 User&#39;s Guide"
          href="../_static/opensearch.xml"/>

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6.8.6. Nullary type classes" href="nullary_type_classes.html" />
    <link rel="prev" title="6.8.3. Constrained class method types" href="constrained_class_methods.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Glasgow Haskell Compiler
          

          
          </a>

          
            
            
              <div class="version">
                9.2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">2. Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ghci.html">3. Using GHCi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runghc.html">4. Using runghc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">5. Using GHC</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../exts.html">6. Language extensions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">6.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="syntax.html">6.2. Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="import_export.html">6.3. Import and export</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html">6.4. Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="records.html">6.5. Records</a></li>
<li class="toctree-l2"><a class="reference internal" href="deriving.html">6.6. Deriving mechanism</a></li>
<li class="toctree-l2"><a class="reference internal" href="patterns.html">6.7. Patterns</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="typeclasses.html">6.8. Class and instances declarations</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="multi_param_type_classes.html">6.8.1. Multi-parameter type classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="undecidable_super_classes.html">6.8.2. Undecidable (or recursive) superclasses</a></li>
<li class="toctree-l3"><a class="reference internal" href="constrained_class_methods.html">6.8.3. Constrained class method types</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">6.8.4. Default method signatures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#detailed-requirements-for-default-type-signatures">6.8.5. Detailed requirements for default type signatures</a></li>
<li class="toctree-l3"><a class="reference internal" href="nullary_type_classes.html">6.8.6. Nullary type classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="functional_dependencies.html">6.8.7. Functional dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="instances.html">6.8.8. Instance declarations and resolution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="literals.html">6.9. Literals</a></li>
<li class="toctree-l2"><a class="reference internal" href="constraints.html">6.10. Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="type_signatures.html">6.11. Type signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="bindings.html">6.12. Bindings and generalisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="template_haskell.html">6.13. Template Haskell</a></li>
<li class="toctree-l2"><a class="reference internal" href="strict.html">6.14. Bang patterns and Strict Haskell</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallel.html">6.15. Parallel and Concurrent</a></li>
<li class="toctree-l2"><a class="reference internal" href="primitives.html">6.16. Unboxed types and primitive operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="ffi.html">6.17. Foreign function interface (FFI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="safe_haskell.html">6.18. Safe Haskell</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc.html">6.19. Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="pragmas.html">6.20. Pragmas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../extending_ghc.html">7. Extending and using GHC as a Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiling.html">8. Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debug-info.html">9. Debugging compiled programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gone_wrong.html">10. What to do when something goes wrong</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hints.html">11. Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">12. Other Haskell utility programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../win32-dlls.html">13. Running GHC on Win32 systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bugs.html">14. Known bugs and infelicities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventlog-formats.html">15. Eventlog encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../editing-guide.html">16. Care and feeding of your GHC User’s Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Glasgow Haskell Compiler</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../exts.html"><span class="section-number">6. </span>Language extensions</a> &raquo;</li>
        
          <li><a href="typeclasses.html"><span class="section-number">6.8. </span>Class and instances declarations</a> &raquo;</li>
        
      <li><span class="section-number">6.8.4. </span>Default method signatures</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/exts/default_signatures.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="default-method-signatures">
<span id="class-default-signatures"></span><h1><span class="section-number">6.8.4. </span>Default method signatures<a class="headerlink" href="#default-method-signatures" title="Permalink to this heading">¶</a></h1>
<dl class="std extension">
<dt class="sig sig-object std" id="extension-DefaultSignatures">
<span id="ghc-flag--XDefaultSignatures"></span><span id="extension-NoDefaultSignatures"></span><span class="sig-name descname"><span class="pre">DefaultSignatures</span></span><a class="headerlink" href="#extension-DefaultSignatures" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Since<span class="colon">:</span></dt>
<dd class="field-odd"><p>7.2.1</p>
</dd>
</dl>
<p>Allows the definition of default method signatures in class definitions.</p>
</dd></dl>

<p>Haskell 98 allows you to define a default implementation when declaring
a class:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span><span class="w"> </span><span class="kt">Enum</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="n">enum</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="n">enum</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">[]</span><span class="w"></span>
</pre></div>
</div>
<p>The type of the <code class="docutils literal notranslate"><span class="pre">enum</span></code> method is <code class="docutils literal notranslate"><span class="pre">[a]</span></code>, and this is also the type of
the default method. You can change the type of the default method by
requiring a different context using the extension
<a class="reference internal" href="#extension-DefaultSignatures"><code class="xref std std-extension docutils literal notranslate"><span class="pre">DefaultSignatures</span></code></a>. For instance, if you have written a
generic implementation of enumeration in a class <code class="docutils literal notranslate"><span class="pre">GEnum</span></code> with method
<code class="docutils literal notranslate"><span class="pre">genum</span></code>, you can specify a default method that uses that generic
implementation. But your default implementation can only be used if the
constraints are satisfied, therefore you need to change the type of the
default method</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span><span class="w"> </span><span class="kt">Enum</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="n">enum</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="kr">default</span><span class="w"> </span><span class="n">enum</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">(</span><span class="kt">Generic</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">GEnum</span><span class="w"> </span><span class="p">(</span><span class="kt">Rep</span><span class="w"> </span><span class="n">a</span><span class="p">))</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="w"></span>
<span class="w">  </span><span class="n">enum</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">genum</span><span class="w"></span>
</pre></div>
</div>
<p>We reuse the keyword <code class="docutils literal notranslate"><span class="pre">default</span></code> to signal that a signature applies to
the default method only; when defining instances of the <code class="docutils literal notranslate"><span class="pre">Enum</span></code> class,
the original type <code class="docutils literal notranslate"><span class="pre">[a]</span></code> of <code class="docutils literal notranslate"><span class="pre">enum</span></code> still applies. When giving an
empty instance, however, the default implementation <code class="docutils literal notranslate"><span class="pre">(map</span> <span class="pre">to</span> <span class="pre">genum)</span></code> is
filled-in, and type-checked with the type
<code class="docutils literal notranslate"><span class="pre">(Generic</span> <span class="pre">a,</span> <span class="pre">GEnum</span> <span class="pre">(Rep</span> <span class="pre">a))</span> <span class="pre">=&gt;</span> <span class="pre">[a]</span></code>.</p>
<p>The type signature for a default method of a type class must take on the same
form as the corresponding main method’s type signature. Otherwise, the
typechecker will reject that class’s definition. By “take on the same form”, we
mean that the default type signature should differ from the main type signature
only in their outermost contexts. Therefore, if you have a method <code class="docutils literal notranslate"><span class="pre">bar</span></code>:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span><span class="w"> </span><span class="kt">Foo</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="n">bar</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="kt">C</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
</pre></div>
</div>
<p>Then a default method for <code class="docutils literal notranslate"><span class="pre">bar</span></code> must take on the form:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">default</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="kt">C&#39;</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
<span class="nf">bar</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">...</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">C</span></code> is allowed to be different from <code class="docutils literal notranslate"><span class="pre">C'</span></code>, but the right-hand sides of the
type signatures must coincide. We require this because when you declare an
empty instance for a class that uses <a class="reference internal" href="#extension-DefaultSignatures"><code class="xref std std-extension docutils literal notranslate"><span class="pre">DefaultSignatures</span></code></a>, GHC
implicitly fills in the default implementation like this:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">instance</span><span class="w"> </span><span class="kt">Foo</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="n">bar</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">default_bar</span><span class="w"></span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">default_bar</span></code> is a top-level function based on the default type
signature and implementation for <code class="docutils literal notranslate"><span class="pre">bar</span></code>:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">default_bar</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="p">(</span><span class="kt">Foo</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">C&#39;</span><span class="p">)</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
<span class="nf">default_bar</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">...</span><span class="w"></span>
</pre></div>
</div>
<p>In order for this approach to work, the default type signature for <code class="docutils literal notranslate"><span class="pre">bar</span></code>
should be the same as the non-default signature, modulo the outermost context
(with some caveats—see
<a class="reference internal" href="#class-default-signatures-detailed-requirements"><span class="std std-ref">Detailed requirements for default type signatures</span></a>). There is no obligation
for <code class="docutils literal notranslate"><span class="pre">C</span></code> and <code class="docutils literal notranslate"><span class="pre">C'</span></code> to be the same, and indeed, the <code class="docutils literal notranslate"><span class="pre">Enum</span></code> example above
relies on <code class="docutils literal notranslate"><span class="pre">enum</span></code>’s default type signature having a more specific context than
the original type signature.</p>
<p>We use default signatures to simplify generic programming in GHC
(<a class="reference internal" href="generics.html#generic-programming"><span class="std std-ref">Generic programming</span></a>).</p>
</section>
<section id="detailed-requirements-for-default-type-signatures">
<span id="class-default-signatures-detailed-requirements"></span><h1><span class="section-number">6.8.5. </span>Detailed requirements for default type signatures<a class="headerlink" href="#detailed-requirements-for-default-type-signatures" title="Permalink to this heading">¶</a></h1>
<p>The rest of this section gives further details about what constitutes valid
default type signatures.</p>
<ul>
<li><p>Ignoring outermost contexts, a default type signature must match the original
type signature according to
<a class="reference internal" href="rank_polymorphism.html#subsumption"><span class="std std-ref">GHC’s subsumption rules</span></a>. As a result, the order
of type variables in the default signature is important. Recall the <code class="docutils literal notranslate"><span class="pre">Foo</span></code>
example from the previous section:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span><span class="w"> </span><span class="kt">Foo</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="n">bar</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="kt">C</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"></span>

<span class="w">  </span><span class="kr">default</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="kt">C&#39;</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
<span class="w">  </span><span class="n">bar</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">...</span><span class="w"></span>
</pre></div>
</div>
<p>This is legal because if you remove the outermost contexts <code class="docutils literal notranslate"><span class="pre">C</span></code> and <code class="docutils literal notranslate"><span class="pre">C'</span></code>,
then the two type signatures are the same. It is not necessarily the case
that the default signature has to be <em>exactly</em> the same, however. For
instance, this would also be an acceptable default type signature, as it is
alpha-equivalent to the original type signature:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">default</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">x</span><span class="o">.</span><span class="w"> </span><span class="kt">C&#39;</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
</pre></div>
</div>
<p>On the other hand, this is <em>not</em> an acceptable default type signature, since
the type variable <code class="docutils literal notranslate"><span class="pre">a</span></code> is in the wrong place:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">default</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="kt">C&#39;</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>The only place where a default type signature is allowed to more precise than
the original type signature is in the outermost context. For example, this
would <em>not</em> be an acceptable default type signature, since we can’t match the
type variable <code class="docutils literal notranslate"><span class="pre">b</span></code> with the concrete type <code class="docutils literal notranslate"><span class="pre">Int</span></code>:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">default</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">C&#39;</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Int</span><span class="w"></span>
</pre></div>
</div>
<p>You can, however, use type equalities to achieve the same result:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">default</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="p">(</span><span class="kt">C&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>Because of <a class="reference internal" href="rank_polymorphism.html#subsumption"><span class="std std-ref">GHC’s subsumption rules</span></a> rules, there
are relatively tight restrictions concerning nested or higher-rank
<code class="docutils literal notranslate"><span class="pre">forall</span></code>s (see <a class="reference internal" href="rank_polymorphism.html#arbitrary-rank-polymorphism"><span class="std std-ref">Arbitrary-rank polymorphism</span></a>). Consider this
class:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span><span class="w"> </span><span class="kt">C</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="n">m</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
</pre></div>
</div>
<p>GHC would <em>not</em> permit the following default type signature for <code class="docutils literal notranslate"><span class="pre">m</span></code>:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">default</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">a</span><span class="o">.</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
</pre></div>
</div>
<p>This is because the default signature quantifies the nested <code class="docutils literal notranslate"><span class="pre">forall</span></code>s
in a different order than the original type signature. In order for this to
typecheck, the default signature must preserve the original order:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">default</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
</pre></div>
</div>
<p>Note that unlike nested or higher-rank <code class="docutils literal notranslate"><span class="pre">forall</span></code>s, outermost
<code class="docutils literal notranslate"><span class="pre">forall</span></code>s have more flexibility in how they are ordered. As a result, GHC
will permit the following:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span><span class="w"> </span><span class="kt">C&#39;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="n">m&#39;</span><span class="w">         </span><span class="ow">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
<span class="w">  </span><span class="kr">default</span><span class="w"> </span><span class="n">m&#39;</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">a</span><span class="o">.</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"></span>
<span class="w">  </span><span class="n">m&#39;</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">...</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>Just as the order of nested or higher-rank <code class="docutils literal notranslate"><span class="pre">forall</span></code>s is restricted, a
similar restriction applies to the order in which nested or higher-rank
contexts appear. As a result, GHC will not permit the following:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span><span class="w"> </span><span class="kt">D</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="n">n</span><span class="w">         </span><span class="ow">::</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="p">(</span><span class="kt">Eq</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">Show</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">String</span><span class="w"></span>
<span class="w">  </span><span class="kr">default</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="p">(</span><span class="kt">Show</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">Eq</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">String</span><span class="w"></span>
<span class="w">  </span><span class="n">n</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">...</span><span class="w"></span>
</pre></div>
</div>
<p>GHC will permit reordering constraints within an outermost context, however,
as demonstrated by the fact that GHC accepts the following:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span><span class="w"> </span><span class="kt">D&#39;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="n">n&#39;</span><span class="w">         </span><span class="ow">::</span><span class="w"> </span><span class="p">(</span><span class="kt">Eq</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">Show</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">String</span><span class="w"></span>
<span class="w">  </span><span class="kr">default</span><span class="w"> </span><span class="n">n&#39;</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">(</span><span class="kt">Show</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">Eq</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">String</span><span class="w"></span>
<span class="w">  </span><span class="n">n&#39;</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="o">...</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>Because a default signature is only ever allowed to differ from its original
type signature in the outermost context, not in nested or higher-rank
contexts, there are certain defaults that cannot be written without
reordering <code class="docutils literal notranslate"><span class="pre">forall</span></code> s. Consider this example:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span><span class="w"> </span><span class="kt">E</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">  </span><span class="n">p</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">String</span><span class="w"></span>
</pre></div>
</div>
<p>Suppose one wishes to write a default signature for <code class="docutils literal notranslate"><span class="pre">p</span></code> where the context
must mention both <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>. While the natural thing to do would be to
write this default:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">default</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="kt">DefaultClass</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">String</span><span class="w"></span>
</pre></div>
</div>
<p>This will not typecheck, since the default type signature now differs from
the original type signature in its use of nested contexts. The only way to
make such a default signature work is to change the order in which <code class="docutils literal notranslate"><span class="pre">b</span></code>
is quantified:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">default</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="w"> </span><span class="kt">DefaultClass</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">String</span><span class="w"></span>
</pre></div>
</div>
<p>This works, but at the expense of changing <code class="docutils literal notranslate"><span class="pre">p</span></code>’s behavior with respect to
<a class="reference internal" href="type_applications.html#visible-type-application"><span class="std std-ref">Visible type application</span></a>.</p>
</li>
</ul>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="nullary_type_classes.html" class="btn btn-neutral float-right" title="6.8.6. Nullary type classes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="constrained_class_methods.html" class="btn btn-neutral float-left" title="6.8.3. Constrained class method types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, GHC Team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>