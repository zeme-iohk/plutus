<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- |

== Getting Started
To get started with golden testing and this library, see
&lt;https://ro-che.info/articles/2017-12-04-golden-tests Introduction to golden testing&gt;.

This module provides a simplified interface. If you want more, see
&quot;Test.Tasty.Golden.Advanced&quot;.

== Filenames
Filenames are looked up in the usual way, Thus relative
names are relative to the processes current working directory.
It is common to run tests from the package's root directory (via @cabal
test@ or @cabal install --enable-tests@), so if your test files are under
the @tests\/@ subdirectory, your relative file names should start with
@tests\/@ (even if your @test.hs@ is itself under @tests\/@, too).

== Line endings

The best way to avoid headaches with line endings
(when running tests both on UNIX and Windows) is to treat your golden files
as binary, even when they are actually textual.

This means:

* When writing output files from Haskell code, open them in binary mode
(see 'openBinaryFile', 'withBinaryFile' and 'hSetBinaryMode'). This will
disable automatic @\\n -&gt; \\r\\n@ conversion on Windows. For convenience, this
module exports 'writeBinaryFile' which is just like `writeFile` but opens
the file in binary mode. When using 'ByteString's note that
&quot;Data.ByteString&quot; and &quot;Data.ByteString.Lazy&quot; use binary mode for
@writeFile@, while &quot;Data.ByteString.Char8&quot; and &quot;Data.ByteString.Lazy.Char8&quot;
use text mode.

* Tell your VCS not to do any newline conversion for golden files. For
 git check in a @.gitattributes@ file with the following contents (assuming
 your golden files have @.golden@ extension):

&gt;*.golden	-text

On its side, tasty-golden reads and writes files in binary mode, too.

Why not let Haskell/git do automatic conversion on Windows? Well, for
instance, @tar@ will not do the conversion for you when unpacking a release
tarball, so when you run @cabal install your-package --enable-tests@, the
tests will be broken.

As a last resort, you can strip all @\\r@s from both arguments in your
comparison function when necessary. But most of the time treating the files
as binary does the job.

== Linking
The test suite should be compiled with @-threaded@ if you want to avoid
blocking any other threads while 'goldenVsFileDiff' and similar functions
wait for the result of the diff command.

== Windows limitations
When using 'goldenVsFileDiff' or 'goldenVsStringDiff' under Windows the exit
code from the diff program that you specify will not be captured correctly
if that program uses @exec@.

More specifically, you will get the exit code of the /original child/
(which always exits with code 0, since it called @exec@), not the exit
code of the process which carried on with execution after @exec@.
This is different from the behavior prescribed by POSIX but is the best
approximation that can be realised under the restrictions of the
Windows process model.  See 'System.Process' for further details or
&lt;https://github.com/haskell/process/pull/168&gt; for even more.

-}</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-73"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-74"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test.Tasty.Golden</span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-special">(</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Functions to create a golden test</span></span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="Test.Tasty.Golden.html#goldenVsFile"><span class="hs-identifier">goldenVsFile</span></a></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Tasty.Golden.html#goldenVsString"><span class="hs-identifier">goldenVsString</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Tasty.Golden.html#goldenVsFileDiff"><span class="hs-identifier">goldenVsFileDiff</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Tasty.Golden.html#goldenVsStringDiff"><span class="hs-identifier">goldenVsStringDiff</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Options</span></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Tasty.Golden.Internal.html#SizeCutoff"><span class="hs-identifier">SizeCutoff</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Tasty.Golden.Internal.html#DeleteOutputFile"><span class="hs-identifier">DeleteOutputFile</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Various utilities</span></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Tasty.Golden.html#writeBinaryFile"><span class="hs-identifier">writeBinaryFile</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Tasty.Golden.html#findByExtension"><span class="hs-identifier">findByExtension</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Tasty.Golden.html#createDirectoriesAndWriteFile"><span class="hs-identifier">createDirectoriesAndWriteFile</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../tasty/html/src"><span class="hs-identifier">Test.Tasty</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Tasty.Golden.Advanced.html"><span class="hs-identifier">Test.Tasty.Golden.Advanced</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Tasty.Golden.Internal.html"><span class="hs-identifier">Test.Tasty.Golden.Internal</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Text.Printf</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LBS</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LT</span></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text.Lazy.Encoding</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LT</span></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">System.IO</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../temporary/html/src"><span class="hs-identifier">System.IO.Temp</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../typed-process/html/src"><span class="hs-identifier">System.Process.Typed</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PT</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">System.Exit</span></a></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../filepath/html/src"><span class="hs-identifier">System.FilePath</span></a></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../directory/html/src"><span class="hs-identifier">System.Directory</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Exception</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Foreign.C.Error</span></a></span><span class="hs-cpp">
#if !MIN_VERSION_base(4,11,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Monoid</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | Compare the output file's contents against the golden file's contents</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- after the given action has created the output file.</span><span>
</span><span id="line-114"></span><span class="annot"><a href="Test.Tasty.Golden.html#goldenVsFile"><span class="hs-identifier hs-type">goldenVsFile</span></a></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../tasty/html/src"><span class="hs-identifier hs-type">TestName</span></a></span><span> </span><span class="hs-comment">-- ^ test name</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ path to the &#171;golden&#187; file (the file that contains correct output)</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ path to the output file</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ action that creates the output file</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../tasty/html/src"><span class="hs-identifier hs-type">TestTree</span></a></span><span> </span><span class="hs-comment">-- ^ the test verifies that the output file contents is the same as the golden file contents</span><span>
</span><span id="line-120"></span><span id="goldenVsFile"><span class="annot"><span class="annottext">goldenVsFile :: TestName -&gt; TestName -&gt; TestName -&gt; IO () -&gt; TestTree
</span><a href="Test.Tasty.Golden.html#goldenVsFile"><span class="hs-identifier hs-var hs-var">goldenVsFile</span></a></span></span><span> </span><span id="local-6989586621679064705"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064705"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679064704"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064704"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679064703"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064703"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621679064702"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679064702"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><span class="annottext">forall a.
TestName
-&gt; IO a
-&gt; IO a
-&gt; (a -&gt; a -&gt; IO (Maybe TestName))
-&gt; (a -&gt; IO ())
-&gt; IO ()
-&gt; TestTree
</span><a href="Test.Tasty.Golden.Advanced.html#goldenTest2"><span class="hs-identifier hs-var">goldenTest2</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064705"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestName -&gt; IO ByteString
</span><a href="Test.Tasty.Golden.html#readFileStrict"><span class="hs-identifier hs-var">readFileStrict</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064704"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679064702"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TestName -&gt; IO ByteString
</span><a href="Test.Tasty.Golden.html#readFileStrict"><span class="hs-identifier hs-var">readFileStrict</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064703"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; IO (Maybe TestName)
</span><a href="#local-6989586621679064699"><span class="hs-identifier hs-var">cmp</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><a href="#local-6989586621679064698"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679064697"><span class="hs-identifier hs-var">del</span></a></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-129"></span><span>  </span><span id="local-6989586621679064699"><span class="annot"><span class="annottext">cmp :: ByteString -&gt; ByteString -&gt; IO (Maybe TestName)
</span><a href="#local-6989586621679064699"><span class="hs-identifier hs-var hs-var">cmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; TestName -&gt; a -&gt; a -&gt; IO (Maybe TestName)
</span><a href="Test.Tasty.Golden.html#simpleCmp"><span class="hs-identifier hs-var">simpleCmp</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall r. PrintfType r =&gt; TestName -&gt; r
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><span class="hs-string">&quot;Files '%s' and '%s' differ&quot;</span></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064704"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064703"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span id="local-6989586621679064698"><span class="annot"><span class="annottext">upd :: ByteString -&gt; IO ()
</span><a href="#local-6989586621679064698"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; ByteString -&gt; IO ()
</span><a href="Test.Tasty.Golden.html#createDirectoriesAndWriteFile"><span class="hs-identifier hs-var">createDirectoriesAndWriteFile</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064704"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span id="local-6989586621679064697"><span class="annot"><span class="annottext">del :: IO ()
</span><a href="#local-6989586621679064697"><span class="hs-identifier hs-var hs-var">del</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; IO ()
</span><a href="../../../../directory/html/src"><span class="hs-identifier hs-var">removeFile</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064703"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-comment">-- | Compare a given string against the golden file's contents.</span><span>
</span><span id="line-134"></span><span class="annot"><a href="Test.Tasty.Golden.html#goldenVsString"><span class="hs-identifier hs-type">goldenVsString</span></a></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../tasty/html/src"><span class="hs-identifier hs-type">TestName</span></a></span><span> </span><span class="hs-comment">-- ^ test name</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ path to the &#171;golden&#187; file (the file that contains correct output)</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">LBS.ByteString</span></a></span><span> </span><span class="hs-comment">-- ^ action that returns a string</span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../tasty/html/src"><span class="hs-identifier hs-type">TestTree</span></a></span><span> </span><span class="hs-comment">-- ^ the test verifies that the returned string is the same as the golden file contents</span><span>
</span><span id="line-139"></span><span id="goldenVsString"><span class="annot"><span class="annottext">goldenVsString :: TestName -&gt; TestName -&gt; IO ByteString -&gt; TestTree
</span><a href="Test.Tasty.Golden.html#goldenVsString"><span class="hs-identifier hs-var hs-var">goldenVsString</span></a></span></span><span> </span><span id="local-6989586621679064682"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064682"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679064681"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064681"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679064680"><span class="annot"><span class="annottext">IO ByteString
</span><a href="#local-6989586621679064680"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><span class="annottext">forall v. IsOption v =&gt; (v -&gt; TestTree) -&gt; TestTree
</span><a href="../../../../tasty/html/src"><span class="hs-identifier hs-var">askOption</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679064678"><span class="annot"><span class="annottext">SizeCutoff
</span><a href="#local-6989586621679064678"><span class="hs-identifier hs-var">sizeCutoff</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="annottext">forall a.
TestName
-&gt; IO a
-&gt; IO a
-&gt; (a -&gt; a -&gt; IO (Maybe TestName))
-&gt; (a -&gt; IO ())
-&gt; TestTree
</span><a href="Test.Tasty.Golden.Advanced.html#goldenTest"><span class="hs-identifier hs-var">goldenTest</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064682"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestName -&gt; IO ByteString
</span><a href="Test.Tasty.Golden.html#readFileStrict"><span class="hs-identifier hs-var">readFileStrict</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064681"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="annottext">IO ByteString
</span><a href="#local-6989586621679064680"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SizeCutoff -&gt; ByteString -&gt; ByteString -&gt; IO (Maybe TestName)
</span><a href="#local-6989586621679064676"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">SizeCutoff
</span><a href="#local-6989586621679064678"><span class="hs-identifier hs-var">sizeCutoff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><a href="#local-6989586621679064675"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-148"></span><span>  </span><span id="local-6989586621679064676"><span class="annot"><span class="annottext">cmp :: SizeCutoff -&gt; ByteString -&gt; ByteString -&gt; IO (Maybe TestName)
</span><a href="#local-6989586621679064676"><span class="hs-identifier hs-var hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621679064673"><span class="annot"><span class="annottext">SizeCutoff
</span><a href="#local-6989586621679064673"><span class="hs-identifier hs-var">sizeCutoff</span></a></span></span><span> </span><span id="local-6989586621679064672"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064672"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679064671"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064671"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; TestName -&gt; a -&gt; a -&gt; IO (Maybe TestName)
</span><a href="Test.Tasty.Golden.html#simpleCmp"><span class="hs-identifier hs-var">simpleCmp</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064670"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064672"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064671"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621679064670"><span class="annot"><span class="annottext">msg :: TestName
</span><a href="#local-6989586621679064670"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. PrintfType r =&gt; TestName -&gt; r
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><span class="hs-string">&quot;Test output was different from '%s'. It was:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064681"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-151"></span><span>      </span><span class="annot"><span class="annottext">ByteString -&gt; TestName
</span><a href="Test.Tasty.Golden.html#unpackUtf8"><span class="hs-identifier hs-var">unpackUtf8</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SizeCutoff -&gt; ByteString -&gt; ByteString
</span><a href="Test.Tasty.Golden.html#truncateLargeOutput"><span class="hs-identifier hs-var">truncateLargeOutput</span></a></span><span> </span><span class="annot"><span class="annottext">SizeCutoff
</span><a href="#local-6989586621679064673"><span class="hs-identifier hs-var">sizeCutoff</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064671"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>  </span><span id="local-6989586621679064675"><span class="annot"><span class="annottext">upd :: ByteString -&gt; IO ()
</span><a href="#local-6989586621679064675"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; ByteString -&gt; IO ()
</span><a href="Test.Tasty.Golden.html#createDirectoriesAndWriteFile"><span class="hs-identifier hs-var">createDirectoriesAndWriteFile</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064681"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span id="local-6989586621679064825"><span class="annot"><a href="Test.Tasty.Golden.html#simpleCmp"><span class="hs-identifier hs-type">simpleCmp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064825"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679064825"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679064825"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-155"></span><span id="simpleCmp"><span class="annot"><span class="annottext">simpleCmp :: forall a. Eq a =&gt; TestName -&gt; a -&gt; a -&gt; IO (Maybe TestName)
</span><a href="Test.Tasty.Golden.html#simpleCmp"><span class="hs-identifier hs-var hs-var">simpleCmp</span></a></span></span><span> </span><span id="local-6989586621679064658"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064658"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679064657"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064657"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679064656"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064656"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064657"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064656"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064658"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-comment">-- | Same as 'goldenVsFile', but invokes an external diff command.</span><span>
</span><span id="line-159"></span><span class="hs-comment">--</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- See the notes at the top of this module regarding linking with</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- @-threaded@ and Windows-specific issues.</span><span>
</span><span id="line-162"></span><span class="annot"><a href="Test.Tasty.Golden.html#goldenVsFileDiff"><span class="hs-identifier hs-type">goldenVsFileDiff</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../tasty/html/src"><span class="hs-identifier hs-type">TestName</span></a></span><span> </span><span class="hs-comment">-- ^ test name</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-comment">-- ^ function that constructs the command line to invoke the diff</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-comment">-- command.</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-comment">-- E.g.</span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- &gt;\ref new -&gt; [&quot;diff&quot;, &quot;-u&quot;, ref, new]</span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ path to the golden file</span><span>
</span><span id="line-172"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ path to the output file</span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- ^ action that produces the output file</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../tasty/html/src"><span class="hs-identifier hs-type">TestTree</span></a></span><span>
</span><span id="line-175"></span><span id="goldenVsFileDiff"><span class="annot"><span class="annottext">goldenVsFileDiff :: TestName
-&gt; (TestName -&gt; TestName -&gt; [TestName])
-&gt; TestName
-&gt; TestName
-&gt; IO ()
-&gt; TestTree
</span><a href="Test.Tasty.Golden.html#goldenVsFileDiff"><span class="hs-identifier hs-var hs-var">goldenVsFileDiff</span></a></span></span><span> </span><span id="local-6989586621679064655"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064655"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679064654"><span class="annot"><span class="annottext">TestName -&gt; TestName -&gt; [TestName]
</span><a href="#local-6989586621679064654"><span class="hs-identifier hs-var">cmdf</span></a></span></span><span> </span><span id="local-6989586621679064653"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064653"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679064652"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064652"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621679064651"><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679064651"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><span class="annottext">forall v. IsOption v =&gt; (v -&gt; TestTree) -&gt; TestTree
</span><a href="../../../../tasty/html/src"><span class="hs-identifier hs-var">askOption</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679064650"><span class="annot"><span class="annottext">SizeCutoff
</span><a href="#local-6989586621679064650"><span class="hs-identifier hs-var">sizeCutoff</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-177"></span><span>  </span><span class="annot"><span class="annottext">forall a.
TestName
-&gt; IO a
-&gt; IO a
-&gt; (a -&gt; a -&gt; IO (Maybe TestName))
-&gt; (a -&gt; IO ())
-&gt; IO ()
-&gt; TestTree
</span><a href="Test.Tasty.Golden.Advanced.html#goldenTest2"><span class="hs-identifier hs-var">goldenTest2</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064655"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestName -&gt; IO ()
</span><a href="Test.Tasty.Golden.html#throwIfDoesNotExist"><span class="hs-identifier hs-var">throwIfDoesNotExist</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064653"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679064651"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TestName] -&gt; SizeCutoff -&gt; IO (Maybe TestName)
</span><a href="Test.Tasty.Golden.html#runDiff"><span class="hs-identifier hs-var">runDiff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestName -&gt; TestName -&gt; [TestName]
</span><a href="#local-6989586621679064654"><span class="hs-identifier hs-var">cmdf</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064653"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064652"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SizeCutoff
</span><a href="#local-6989586621679064650"><span class="hs-identifier hs-var">sizeCutoff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">forall {p}. p -&gt; IO ()
</span><a href="#local-6989586621679064647"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621679064646"><span class="hs-identifier hs-var">del</span></a></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-185"></span><span>  </span><span id="local-6989586621679064647"><span class="annot"><span class="annottext">upd :: p -&gt; IO ()
</span><a href="#local-6989586621679064647"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; IO ByteString
</span><a href="Test.Tasty.Golden.html#readFileStrict"><span class="hs-identifier hs-var">readFileStrict</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064652"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">TestName -&gt; ByteString -&gt; IO ()
</span><a href="Test.Tasty.Golden.html#createDirectoriesAndWriteFile"><span class="hs-identifier hs-var">createDirectoriesAndWriteFile</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064653"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span id="local-6989586621679064646"><span class="annot"><span class="annottext">del :: IO ()
</span><a href="#local-6989586621679064646"><span class="hs-identifier hs-var hs-var">del</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; IO ()
</span><a href="../../../../directory/html/src"><span class="hs-identifier hs-var">removeFile</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064652"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">-- If the golden file doesn't exist, throw an isDoesNotExistError that</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- runGolden will handle by creating the golden file before proceeding.</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- See #32.</span><span>
</span><span id="line-191"></span><span class="annot"><a href="Test.Tasty.Golden.html#throwIfDoesNotExist"><span class="hs-identifier hs-type">throwIfDoesNotExist</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span id="throwIfDoesNotExist"><span class="annot"><span class="annottext">throwIfDoesNotExist :: TestName -&gt; IO ()
</span><a href="Test.Tasty.Golden.html#throwIfDoesNotExist"><span class="hs-identifier hs-var hs-var">throwIfDoesNotExist</span></a></span></span><span> </span><span id="local-6989586621679064644"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064644"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621679064643"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679064643"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; IO Bool
</span><a href="../../../../directory/html/src"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064644"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-194"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679064643"><span class="hs-identifier hs-var">exists</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IOError -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">ioError</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><span class="annottext">TestName -&gt; Errno -&gt; Maybe Handle -&gt; Maybe TestName -&gt; IOError
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">errnoToIOError</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><span class="hs-string">&quot;goldenVsFileDiff&quot;</span></span><span> </span><span class="annot"><span class="annottext">Errno
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">eNOENT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="hs-comment">-- | Same as 'goldenVsString', but invokes an external diff command.</span><span>
</span><span id="line-198"></span><span class="hs-comment">--</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- See the notes at the top of this module regarding linking with</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- @-threaded@ and Windows-specific issues.</span><span>
</span><span id="line-201"></span><span class="annot"><a href="Test.Tasty.Golden.html#goldenVsStringDiff"><span class="hs-identifier hs-type">goldenVsStringDiff</span></a></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../tasty/html/src"><span class="hs-identifier hs-type">TestName</span></a></span><span> </span><span class="hs-comment">-- ^ test name</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-comment">-- ^ function that constructs the command line to invoke the diff</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-comment">-- command.</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-comment">-- E.g.</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-comment">-- &gt;\ref new -&gt; [&quot;diff&quot;, &quot;-u&quot;, ref, new]</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ path to the golden file</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">LBS.ByteString</span></a></span><span> </span><span class="hs-comment">-- ^ action that returns a string</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../tasty/html/src"><span class="hs-identifier hs-type">TestTree</span></a></span><span>
</span><span id="line-213"></span><span id="goldenVsStringDiff"><span class="annot"><span class="annottext">goldenVsStringDiff :: TestName
-&gt; (TestName -&gt; TestName -&gt; [TestName])
-&gt; TestName
-&gt; IO ByteString
-&gt; TestTree
</span><a href="Test.Tasty.Golden.html#goldenVsStringDiff"><span class="hs-identifier hs-var hs-var">goldenVsStringDiff</span></a></span></span><span> </span><span id="local-6989586621679064637"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064637"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679064636"><span class="annot"><span class="annottext">TestName -&gt; TestName -&gt; [TestName]
</span><a href="#local-6989586621679064636"><span class="hs-identifier hs-var">cmdf</span></a></span></span><span> </span><span id="local-6989586621679064635"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064635"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679064634"><span class="annot"><span class="annottext">IO ByteString
</span><a href="#local-6989586621679064634"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><span class="annottext">forall v. IsOption v =&gt; (v -&gt; TestTree) -&gt; TestTree
</span><a href="../../../../tasty/html/src"><span class="hs-identifier hs-var">askOption</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679064633"><span class="annot"><span class="annottext">SizeCutoff
</span><a href="#local-6989586621679064633"><span class="hs-identifier hs-var">sizeCutoff</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><span class="annottext">forall a.
TestName
-&gt; IO a
-&gt; IO a
-&gt; (a -&gt; a -&gt; IO (Maybe TestName))
-&gt; (a -&gt; IO ())
-&gt; TestTree
</span><a href="Test.Tasty.Golden.Advanced.html#goldenTest"><span class="hs-identifier hs-var">goldenTest</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064637"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestName -&gt; IO ByteString
</span><a href="Test.Tasty.Golden.html#readFileStrict"><span class="hs-identifier hs-var">readFileStrict</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064635"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO ByteString
</span><a href="#local-6989586621679064634"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {p}. SizeCutoff -&gt; p -&gt; ByteString -&gt; IO (Maybe TestName)
</span><a href="#local-6989586621679064632"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">SizeCutoff
</span><a href="#local-6989586621679064633"><span class="hs-identifier hs-var">sizeCutoff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><span class="annottext">ByteString -&gt; IO ()
</span><a href="#local-6989586621679064631"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-222"></span><span>  </span><span id="local-6989586621679064630"><span class="annot"><span class="annottext">template :: TestName
</span><a href="#local-6989586621679064630"><span class="hs-identifier hs-var hs-var">template</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; TestName
</span><a href="../../../../filepath/html/src"><span class="hs-identifier hs-var">takeBaseName</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064635"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">TestName -&gt; TestName -&gt; TestName
</span><a href="../../../../filepath/html/src"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><span class="hs-string">&quot;actual&quot;</span></span><span>
</span><span id="line-223"></span><span>  </span><span id="local-6989586621679064632"><span class="annot"><span class="annottext">cmp :: SizeCutoff -&gt; p -&gt; ByteString -&gt; IO (Maybe TestName)
</span><a href="#local-6989586621679064632"><span class="hs-identifier hs-var hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621679064607"><span class="annot"><span class="annottext">SizeCutoff
</span><a href="#local-6989586621679064607"><span class="hs-identifier hs-var">sizeCutoff</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679064606"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064606"><span class="hs-identifier hs-var">actBS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
TestName -&gt; (TestName -&gt; Handle -&gt; m a) -&gt; m a
</span><a href="../../../../temporary/html/src"><span class="hs-identifier hs-var">withSystemTempFile</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064630"><span class="hs-identifier hs-var">template</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679064604"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064604"><span class="hs-identifier hs-var">tmpFile</span></a></span></span><span> </span><span id="local-6989586621679064603"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679064603"><span class="hs-identifier hs-var">tmpHandle</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-comment">-- Write act output to temporary (&quot;new&quot;) file</span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><span class="annottext">Handle -&gt; ByteString -&gt; IO ()
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">LBS.hPut</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679064603"><span class="hs-identifier hs-var">tmpHandle</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064606"><span class="hs-identifier hs-var">actBS</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">hFlush</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679064603"><span class="hs-identifier hs-var">tmpHandle</span></a></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679064600"><span class="annot"><span class="annottext">cmd :: [TestName]
</span><a href="#local-6989586621679064600"><span class="hs-identifier hs-var hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; TestName -&gt; [TestName]
</span><a href="#local-6989586621679064636"><span class="hs-identifier hs-var">cmdf</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064635"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064604"><span class="hs-identifier hs-var">tmpFile</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span id="local-6989586621679064599"><span class="annot"><span class="annottext">Maybe TestName
</span><a href="#local-6989586621679064599"><span class="hs-identifier hs-var">diff_result</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TestName] -&gt; SizeCutoff -&gt; IO (Maybe TestName)
</span><a href="Test.Tasty.Golden.html#runDiff"><span class="hs-identifier hs-var">runDiff</span></a></span><span> </span><span class="annot"><span class="annottext">[TestName]
</span><a href="#local-6989586621679064600"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">SizeCutoff
</span><a href="#local-6989586621679064607"><span class="hs-identifier hs-var">sizeCutoff</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TestName
</span><a href="#local-6989586621679064599"><span class="hs-identifier hs-var">diff_result</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679064597"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064597"><span class="hs-identifier hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>      </span><span class="annot"><span class="annottext">forall r. PrintfType r =&gt; TestName -&gt; r
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><span class="hs-string">&quot;Test output was different from '%s'. Output of %s:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064635"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; TestName
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[TestName]
</span><a href="#local-6989586621679064600"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064597"><span class="hs-identifier hs-var">diff</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span>  </span><span id="local-6989586621679064631"><span class="annot"><span class="annottext">upd :: ByteString -&gt; IO ()
</span><a href="#local-6989586621679064631"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; ByteString -&gt; IO ()
</span><a href="Test.Tasty.Golden.html#createDirectoriesAndWriteFile"><span class="hs-identifier hs-var">createDirectoriesAndWriteFile</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064635"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="annot"><a href="Test.Tasty.Golden.html#truncateLargeOutput"><span class="hs-identifier hs-type">truncateLargeOutput</span></a></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.Tasty.Golden.Internal.html#SizeCutoff"><span class="hs-identifier hs-type">SizeCutoff</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">LBS.ByteString</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">LBS.ByteString</span></a></span><span>
</span><span id="line-240"></span><span id="truncateLargeOutput"><span class="annot"><span class="annottext">truncateLargeOutput :: SizeCutoff -&gt; ByteString -&gt; ByteString
</span><a href="Test.Tasty.Golden.html#truncateLargeOutput"><span class="hs-identifier hs-var hs-var">truncateLargeOutput</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Tasty.Golden.Internal.html#SizeCutoff"><span class="hs-identifier hs-type">SizeCutoff</span></a></span><span> </span><span id="local-6989586621679064594"><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679064594"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679064593"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064593"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int64
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">LBS.length</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064593"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679064594"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064593"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-244"></span><span>      </span><span class="annot"><span class="annottext">Int64 -&gt; ByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">LBS.take</span></a></span><span> </span><span class="annot"><span class="annottext">Int64
</span><a href="#local-6989586621679064594"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064593"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&lt;truncated&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-245"></span><span>      </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;\nUse --accept or increase --size-cutoff to see full output.&quot;</span></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">-- | Like 'writeFile', but uses binary mode. (Needed only when you work</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- with 'String'.)</span><span>
</span><span id="line-249"></span><span class="annot"><a href="Test.Tasty.Golden.html#writeBinaryFile"><span class="hs-identifier hs-type">writeBinaryFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span id="writeBinaryFile"><span class="annot"><span class="annottext">writeBinaryFile :: TestName -&gt; TestName -&gt; IO ()
</span><a href="Test.Tasty.Golden.html#writeBinaryFile"><span class="hs-identifier hs-var hs-var">writeBinaryFile</span></a></span></span><span> </span><span id="local-6989586621679064589"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064589"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679064588"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064588"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r. TestName -&gt; IOMode -&gt; (Handle -&gt; IO r) -&gt; IO r
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">withBinaryFile</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064589"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">WriteMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679064585"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679064585"><span class="hs-identifier hs-var">hdl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; TestName -&gt; IO ()
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">hPutStr</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679064585"><span class="hs-identifier hs-var">hdl</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064588"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-comment">-- | Find all files in the given directory and its subdirectories that have</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- the given extensions.</span><span>
</span><span id="line-254"></span><span class="hs-comment">--</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- It is typically used to find all test files and produce a golden test</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- per test file.</span><span>
</span><span id="line-257"></span><span class="hs-comment">--</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- The returned paths use forward slashes to separate path components,</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- even on Windows. Thus if the file name ends up in a golden file, it</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- will not differ when run on another platform.</span><span>
</span><span id="line-261"></span><span class="hs-comment">--</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- The semantics of extensions is the same as in 'takeExtension'. In</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- particular, non-empty extensions should have the form @&quot;.ext&quot;@.</span><span>
</span><span id="line-264"></span><span class="hs-comment">--</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- This function may throw any exception that 'getDirectoryContents' may</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- throw.</span><span>
</span><span id="line-267"></span><span class="hs-comment">--</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- It doesn't do anything special to handle symlinks (in particular, it</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- probably won't work on symlink loops).</span><span>
</span><span id="line-270"></span><span class="hs-comment">--</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- Nor is it optimized to work with huge directory trees (you'd probably</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- want to use some form of coroutines for that).</span><span>
</span><span id="line-273"></span><span class="annot"><a href="Test.Tasty.Golden.html#findByExtension"><span class="hs-identifier hs-type">findByExtension</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ extensions</span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ directory</span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ paths</span><span>
</span><span id="line-277"></span><span id="findByExtension"><span class="annot"><span class="annottext">findByExtension :: [TestName] -&gt; TestName -&gt; IO [TestName]
</span><a href="Test.Tasty.Golden.html#findByExtension"><span class="hs-identifier hs-var hs-var">findByExtension</span></a></span></span><span> </span><span id="local-6989586621679064583"><span class="annot"><span class="annottext">[TestName]
</span><a href="#local-6989586621679064583"><span class="hs-identifier hs-var">extsList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; IO [TestName]
</span><a href="#local-6989586621679064582"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-278"></span><span>  </span><span id="local-6989586621679064577"><span class="annot"><span class="annottext">exts :: Set TestName
</span><a href="#local-6989586621679064577"><span class="hs-identifier hs-var hs-var">exts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[TestName]
</span><a href="#local-6989586621679064583"><span class="hs-identifier hs-var">extsList</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span id="local-6989586621679064582"><span class="annot"><span class="annottext">go :: TestName -&gt; IO [TestName]
</span><a href="#local-6989586621679064582"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679064564"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064564"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621679064563"><span class="annot"><span class="annottext">[TestName]
</span><a href="#local-6989586621679064563"><span class="hs-identifier hs-var">allEntries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; IO [TestName]
</span><a href="../../../../directory/html/src"><span class="hs-identifier hs-var">getDirectoryContents</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064564"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679064552"><span class="annot"><span class="annottext">entries :: [TestName]
</span><a href="#local-6989586621679064552"><span class="hs-identifier hs-var hs-var">entries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TestName
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TestName
</span><span class="hs-string">&quot;..&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TestName]
</span><a href="#local-6989586621679064563"><span class="hs-identifier hs-var">allEntries</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a1 r. Monad m =&gt; (a1 -&gt; r) -&gt; m a1 -&gt; m r
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftM</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[TestName]
</span><a href="#local-6989586621679064552"><span class="hs-identifier hs-var">entries</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679064545"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064545"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-283"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679064542"><span class="annot"><span class="annottext">path :: TestName
</span><a href="#local-6989586621679064542"><span class="hs-identifier hs-var hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064564"><span class="hs-identifier hs-var">dir</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064545"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-284"></span><span>      </span><span id="local-6989586621679064541"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679064541"><span class="hs-identifier hs-var">isDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; IO Bool
</span><a href="../../../../directory/html/src"><span class="hs-identifier hs-var">doesDirectoryExist</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064542"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-285"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679064541"><span class="hs-identifier hs-var">isDir</span></a></span><span>
</span><span id="line-286"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; IO [TestName]
</span><a href="#local-6989586621679064582"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064542"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-288"></span><span>          </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-289"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; TestName
</span><a href="../../../../filepath/html/src"><span class="hs-identifier hs-var">takeExtension</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064542"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set TestName
</span><a href="#local-6989586621679064577"><span class="hs-identifier hs-var">exts</span></a></span><span>
</span><span id="line-290"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064542"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-291"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">-- | Like 'LBS.writeFile', but also create parent directories if they are</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- missing.</span><span>
</span><span id="line-295"></span><span class="annot"><a href="Test.Tasty.Golden.html#createDirectoriesAndWriteFile"><span class="hs-identifier hs-type">createDirectoriesAndWriteFile</span></a></span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">LBS.ByteString</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span id="createDirectoriesAndWriteFile"><span class="annot"><span class="annottext">createDirectoriesAndWriteFile :: TestName -&gt; ByteString -&gt; IO ()
</span><a href="Test.Tasty.Golden.html#createDirectoriesAndWriteFile"><span class="hs-identifier hs-var hs-var">createDirectoriesAndWriteFile</span></a></span></span><span> </span><span id="local-6989586621679064537"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064537"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621679064536"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064536"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-300"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679064535"><span class="annot"><span class="annottext">dir :: TestName
</span><a href="#local-6989586621679064535"><span class="hs-identifier hs-var hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; TestName
</span><a href="../../../../filepath/html/src"><span class="hs-identifier hs-var">takeDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064537"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-301"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; TestName -&gt; IO ()
</span><a href="../../../../directory/html/src"><span class="hs-identifier hs-var">createDirectoryIfMissing</span></a></span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-comment">-- create parents too</span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064535"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><span class="annottext">TestName -&gt; ByteString -&gt; IO ()
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">LBS.writeFile</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064537"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064536"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="hs-comment">-- | Force the evaluation of a lazily-produced bytestring.</span><span>
</span><span id="line-307"></span><span class="hs-comment">--</span><span>
</span><span id="line-308"></span><span class="hs-comment">-- This is important to close the file handles.</span><span>
</span><span id="line-309"></span><span class="hs-comment">--</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- See &lt;https://ro-che.info/articles/2015-05-28-force-list&gt;.</span><span>
</span><span id="line-311"></span><span class="annot"><a href="Test.Tasty.Golden.html#forceLbs"><span class="hs-identifier hs-type">forceLbs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">LBS.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span id="forceLbs"><span class="annot"><span class="annottext">forceLbs :: ByteString -&gt; ()
</span><a href="Test.Tasty.Golden.html#forceLbs"><span class="hs-identifier hs-var hs-var">forceLbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (Word8 -&gt; a -&gt; a) -&gt; a -&gt; ByteString -&gt; a
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">LBS.foldr</span></a></span><span> </span><span class="annot"><span class="annottext">seq :: forall a b. a -&gt; b -&gt; b
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">seq</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="annot"><a href="Test.Tasty.Golden.html#readFileStrict"><span class="hs-identifier hs-type">readFileStrict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">LBS.ByteString</span></a></span><span>
</span><span id="line-315"></span><span id="readFileStrict"><span class="annot"><span class="annottext">readFileStrict :: TestName -&gt; IO ByteString
</span><a href="Test.Tasty.Golden.html#readFileStrict"><span class="hs-identifier hs-var hs-var">readFileStrict</span></a></span></span><span> </span><span id="local-6989586621679064529"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064529"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-316"></span><span>  </span><span id="local-6989586621679064528"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064528"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TestName -&gt; IO ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">LBS.readFile</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064529"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-317"></span><span>  </span><span class="annot"><span class="annottext">forall a. a -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ()
</span><a href="Test.Tasty.Golden.html#forceLbs"><span class="hs-identifier hs-var">forceLbs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064528"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-318"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064528"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="annot"><a href="Test.Tasty.Golden.html#unpackUtf8"><span class="hs-identifier hs-type">unpackUtf8</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">LBS.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-321"></span><span id="unpackUtf8"><span class="annot"><span class="annottext">unpackUtf8 :: ByteString -&gt; TestName
</span><a href="Test.Tasty.Golden.html#unpackUtf8"><span class="hs-identifier hs-var hs-var">unpackUtf8</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TestName
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">LT.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">LT.decodeUtf8</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="annot"><a href="Test.Tasty.Golden.html#runDiff"><span class="hs-identifier hs-type">runDiff</span></a></span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ the diff command</span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Tasty.Golden.Internal.html#SizeCutoff"><span class="hs-identifier hs-type">SizeCutoff</span></a></span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span id="runDiff"><span class="annot"><span class="annottext">runDiff :: [TestName] -&gt; SizeCutoff -&gt; IO (Maybe TestName)
</span><a href="Test.Tasty.Golden.html#runDiff"><span class="hs-identifier hs-var hs-var">runDiff</span></a></span></span><span> </span><span id="local-6989586621679064523"><span class="annot"><span class="annottext">[TestName]
</span><a href="#local-6989586621679064523"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span id="local-6989586621679064522"><span class="annot"><span class="annottext">SizeCutoff
</span><a href="#local-6989586621679064522"><span class="hs-identifier hs-var">sizeCutoff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[TestName]
</span><a href="#local-6989586621679064523"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TestName -&gt; ErrorCall
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">ErrorCall</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><span class="hs-string">&quot;tasty-golden: empty diff command&quot;</span></span><span>
</span><span id="line-330"></span><span>    </span><span id="local-6989586621679064519"><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064519"><span class="hs-identifier hs-var">prog</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679064518"><span class="annot"><span class="annottext">[TestName]
</span><a href="#local-6989586621679064518"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-332"></span><span>        </span><span id="local-6989586621679064517"><span class="annot"><span class="annottext">procConf :: ProcessConfig () () ()
</span><a href="#local-6989586621679064517"><span class="hs-identifier hs-var hs-var">procConf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-333"></span><span>          </span><span class="annot"><span class="annottext">forall stdin stdin0 stdout stderr.
StreamSpec 'STInput stdin
-&gt; ProcessConfig stdin0 stdout stderr
-&gt; ProcessConfig stdin stdout stderr
</span><a href="../../../../typed-process/html/src"><span class="hs-identifier hs-var">PT.setStdin</span></a></span><span> </span><span class="annot"><span class="annottext">forall (anyStreamType :: StreamType). StreamSpec anyStreamType ()
</span><a href="../../../../typed-process/html/src"><span class="hs-identifier hs-var">PT.closed</span></a></span><span>
</span><span id="line-334"></span><span>          </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall stderr stdin stdout stderr0.
StreamSpec 'STOutput stderr
-&gt; ProcessConfig stdin stdout stderr0
-&gt; ProcessConfig stdin stdout stderr
</span><a href="../../../../typed-process/html/src"><span class="hs-identifier hs-var">PT.setStderr</span></a></span><span> </span><span class="annot"><span class="annottext">forall (anyStreamType :: StreamType). StreamSpec anyStreamType ()
</span><a href="../../../../typed-process/html/src"><span class="hs-identifier hs-var">PT.inherit</span></a></span><span>
</span><span id="line-335"></span><span>          </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TestName -&gt; [TestName] -&gt; ProcessConfig () () ()
</span><a href="../../../../typed-process/html/src"><span class="hs-identifier hs-var">PT.proc</span></a></span><span> </span><span class="annot"><span class="annottext">TestName
</span><a href="#local-6989586621679064519"><span class="hs-identifier hs-var">prog</span></a></span><span> </span><span class="annot"><span class="annottext">[TestName]
</span><a href="#local-6989586621679064518"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679064511"><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679064511"><span class="hs-identifier hs-var">exitCode</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679064510"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064510"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) stdin stdoutIgnored stderr.
MonadIO m =&gt;
ProcessConfig stdin stdoutIgnored stderr
-&gt; m (ExitCode, ByteString)
</span><a href="../../../../typed-process/html/src"><span class="hs-identifier hs-var">PT.readProcessStdout</span></a></span><span> </span><span class="annot"><span class="annottext">ProcessConfig () () ()
</span><a href="#local-6989586621679064517"><span class="hs-identifier hs-var">procConf</span></a></span><span>
</span><span id="line-338"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExitCode
</span><a href="#local-6989586621679064511"><span class="hs-identifier hs-var">exitCode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-339"></span><span>        </span><span class="annot"><span class="annottext">ExitCode
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">ExitSuccess</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-340"></span><span>        </span><span class="annot"><span class="annottext">ExitCode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; TestName
</span><a href="Test.Tasty.Golden.html#unpackUtf8"><span class="hs-identifier hs-var">unpackUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SizeCutoff -&gt; ByteString -&gt; ByteString
</span><a href="Test.Tasty.Golden.html#truncateLargeOutput"><span class="hs-identifier hs-var">truncateLargeOutput</span></a></span><span> </span><span class="annot"><span class="annottext">SizeCutoff
</span><a href="#local-6989586621679064522"><span class="hs-identifier hs-var">sizeCutoff</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679064510"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-341"></span></pre></body></html>