

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.15.3. Static pointers &mdash; Glasgow Haskell Compiler 9.2.5 User&#39;s Guide</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Glasgow Haskell Compiler 9.2.5 User&#39;s Guide"
          href="../_static/opensearch.xml"/>

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6.16. Unboxed types and primitive operations" href="primitives.html" />
    <link rel="prev" title="6.15.2. Software Transactional Memory" href="stm.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Glasgow Haskell Compiler
          

          
          </a>

          
            
            
              <div class="version">
                9.2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">2. Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ghci.html">3. Using GHCi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runghc.html">4. Using runghc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">5. Using GHC</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../exts.html">6. Language extensions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">6.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="syntax.html">6.2. Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="import_export.html">6.3. Import and export</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html">6.4. Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="records.html">6.5. Records</a></li>
<li class="toctree-l2"><a class="reference internal" href="deriving.html">6.6. Deriving mechanism</a></li>
<li class="toctree-l2"><a class="reference internal" href="patterns.html">6.7. Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="typeclasses.html">6.8. Class and instances declarations</a></li>
<li class="toctree-l2"><a class="reference internal" href="literals.html">6.9. Literals</a></li>
<li class="toctree-l2"><a class="reference internal" href="constraints.html">6.10. Constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="type_signatures.html">6.11. Type signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="bindings.html">6.12. Bindings and generalisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="template_haskell.html">6.13. Template Haskell</a></li>
<li class="toctree-l2"><a class="reference internal" href="strict.html">6.14. Bang patterns and Strict Haskell</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="parallel.html">6.15. Parallel and Concurrent</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="concurrent.html">6.15.1. Concurrent and Parallel Haskell</a></li>
<li class="toctree-l3"><a class="reference internal" href="stm.html">6.15.2. Software Transactional Memory</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">6.15.3. Static pointers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-static-pointers">6.15.3.1. Using static pointers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#static-semantics-of-static-pointers">6.15.3.2. Static semantics of static pointers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="primitives.html">6.16. Unboxed types and primitive operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="ffi.html">6.17. Foreign function interface (FFI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="safe_haskell.html">6.18. Safe Haskell</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc.html">6.19. Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="pragmas.html">6.20. Pragmas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../extending_ghc.html">7. Extending and using GHC as a Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiling.html">8. Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debug-info.html">9. Debugging compiled programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gone_wrong.html">10. What to do when something goes wrong</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hints.html">11. Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">12. Other Haskell utility programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../win32-dlls.html">13. Running GHC on Win32 systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bugs.html">14. Known bugs and infelicities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eventlog-formats.html">15. Eventlog encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../editing-guide.html">16. Care and feeding of your GHC User’s Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Glasgow Haskell Compiler</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../exts.html"><span class="section-number">6. </span>Language extensions</a> &raquo;</li>
        
          <li><a href="parallel.html"><span class="section-number">6.15. </span>Parallel and Concurrent</a> &raquo;</li>
        
      <li><span class="section-number">6.15.3. </span>Static pointers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/exts/static_pointers.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="static-pointers">
<span id="id1"></span><h1><span class="section-number">6.15.3. </span>Static pointers<a class="headerlink" href="#static-pointers" title="Permalink to this heading">¶</a></h1>
<span class="target" id="index-0"></span><dl class="std extension">
<dt class="sig sig-object std" id="extension-StaticPointers">
<span id="ghc-flag--XStaticPointers"></span><span id="extension-NoStaticPointers"></span><span class="sig-name descname"><span class="pre">StaticPointers</span></span><a class="headerlink" href="#extension-StaticPointers" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Since<span class="colon">:</span></dt>
<dd class="field-odd"><p>7.10.1</p>
</dd>
</dl>
<p>Allow use of static pointer syntax.</p>
</dd></dl>

<p>The language extension <a class="reference internal" href="#extension-StaticPointers"><code class="xref std std-extension docutils literal notranslate"><span class="pre">StaticPointers</span></code></a> adds a new syntactic form
<code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">e</span></code>, which stands for a reference to the closed expression ⟨e⟩.
This reference is stable and portable, in the sense that it remains
valid across different processes on possibly different machines. Thus, a
process can create a reference and send it to another process that can
resolve it to ⟨e⟩.</p>
<p>With this extension turned on, <code class="docutils literal notranslate"><span class="pre">static</span></code> is no longer a valid
identifier.</p>
<p>Static pointers were first proposed in the paper <a class="reference external" href="http://research.microsoft.com/en-us/um/people/simonpj/papers/parallel/remote.pdf">Towards Haskell in the
cloud</a>,
Jeff Epstein, Andrew P. Black and Simon Peyton-Jones, Proceedings of the
4th ACM Symposium on Haskell, pp. 118-129, ACM, 2011.</p>
<section id="using-static-pointers">
<span id="id2"></span><h2><span class="section-number">6.15.3.1. </span>Using static pointers<a class="headerlink" href="#using-static-pointers" title="Permalink to this heading">¶</a></h2>
<p>Each reference is given a key which can be used to locate it at runtime
with <a class="reference external" href="../../libraries/base-4.16.4.0/GHC-StaticPtr.html#v:unsafeLookupStaticPtr">GHC.StaticPtr.unsafeLookupStaticPtr</a>
which uses a global and immutable table called the Static Pointer Table.
The compiler includes entries in this table for all static forms found
in the linked modules. The value can be obtained from the reference via
<a class="reference external" href="../../libraries/base-4.16.4.0/GHC-StaticPtr.html#v:deRefStaticPtr">GHC.StaticPtr.deRefStaticPtr</a>.</p>
<p>The body <code class="docutils literal notranslate"><span class="pre">e</span></code> of a <code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">e</span></code> expression must be a closed expression. Where
we say an expression is <em>closed</em> when all of its free (type) variables are
closed. And a variable is <em>closed</em> if it is let-bound to a <em>closed</em> expression
and its type is <em>closed</em> as well. And a type is <em>closed</em> if it has no free
variables.</p>
<p>All of the following are permissible:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">inc</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Int</span><span class="w"></span>
<span class="nf">inc</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="nf">ref1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">static</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="nf">ref2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">static</span><span class="w"> </span><span class="n">inc</span><span class="w"></span>
<span class="nf">ref3</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">static</span><span class="w"> </span><span class="p">(</span><span class="n">inc</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="nf">ref4</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">static</span><span class="w"> </span><span class="p">((</span><span class="nf">\</span><span class="n">x</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span><span class="p">))</span><span class="w"></span>
<span class="nf">ref5</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">static</span><span class="w"> </span><span class="p">(</span><span class="kr">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"></span>
<span class="nf">ref6</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">static</span><span class="w"> </span><span class="n">x</span><span class="w"></span>
</pre></div>
</div>
<p>While the following definitions are rejected:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">ref7</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">static</span><span class="w"> </span><span class="n">x</span><span class="w">    </span><span class="c1">-- x is not closed</span><span class="w"></span>
<span class="nf">ref8</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">static</span><span class="w"> </span><span class="p">(</span><span class="kr">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">  </span><span class="c1">-- y is not let-bound</span><span class="w"></span>
<span class="nf">ref8</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">undefined</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">a</span><span class="w"></span>
<span class="w">                 </span><span class="kr">in</span><span class="w"> </span><span class="n">static</span><span class="w"> </span><span class="n">x</span><span class="w">      </span><span class="c1">-- x has a non-closed type</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While modules loaded in GHCi with the <a class="reference internal" href="../ghci.html#ghci-cmd-load"><code class="xref std std-ghci-cmd docutils literal notranslate"><span class="pre">:load</span></code></a> command may use
<a class="reference internal" href="#extension-StaticPointers"><code class="xref std std-extension docutils literal notranslate"><span class="pre">StaticPointers</span></code></a> and <code class="docutils literal notranslate"><span class="pre">static</span></code> expressions, statements
entered on the REPL may not. This is a limitation of GHCi; see
<a class="reference external" href="https://gitlab.haskell.org/ghc/ghc/issues/12356">#12356</a> for details.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The set of keys used for locating static pointers in the Static Pointer
Table is not guaranteed to remain stable for different program binaries.
Or in other words, only processes launched from the same program binary
are guaranteed to use the same set of keys.</p>
</div>
</section>
<section id="static-semantics-of-static-pointers">
<span id="typechecking-static-pointers"></span><h2><span class="section-number">6.15.3.2. </span>Static semantics of static pointers<a class="headerlink" href="#static-semantics-of-static-pointers" title="Permalink to this heading">¶</a></h2>
<p>Informally, if we have a closed expression</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">e</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">a_1</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="n">a_n</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">t</span><span class="w"></span>
</pre></div>
</div>
<p>the static form is of type</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">static</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">(</span><span class="kt">IsStatic</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">Typeable</span><span class="w"> </span><span class="n">a_1</span><span class="p">,</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="kt">Typeable</span><span class="w"> </span><span class="n">a_n</span><span class="p">)</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">t</span><span class="w"></span>
</pre></div>
</div>
<p>A static form determines a value of type <code class="docutils literal notranslate"><span class="pre">StaticPtr</span> <span class="pre">t</span></code>, but just
like <code class="docutils literal notranslate"><span class="pre">OverloadedLists</span></code> and <code class="docutils literal notranslate"><span class="pre">OverloadedStrings</span></code>, this literal
expression is overloaded to allow lifting a <code class="docutils literal notranslate"><span class="pre">StaticPtr</span></code> into another
type implicitly, via the <code class="docutils literal notranslate"><span class="pre">IsStatic</span></code> class:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">class</span><span class="w"> </span><span class="kt">IsStatic</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">    </span><span class="n">fromStaticPtr</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">StaticPtr</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">a</span><span class="w"></span>
</pre></div>
</div>
<p>The only predefined instance is the obvious one that does nothing:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="kr">instance</span><span class="w"> </span><span class="kt">IsStatic</span><span class="w"> </span><span class="kt">StaticPtr</span><span class="w"> </span><span class="kr">where</span><span class="w"></span>
<span class="w">    </span><span class="n">fromStaticPtr</span><span class="w"> </span><span class="n">sptr</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">sptr</span><span class="w"></span>
</pre></div>
</div>
<p>See <a class="reference external" href="../../libraries/base-4.16.4.0/GHC-StaticPtr.html#t:IsStatic">GHC.StaticPtr.IsStatic</a>.</p>
<p>Furthermore, type <code class="docutils literal notranslate"><span class="pre">t</span></code> is constrained to have a <code class="docutils literal notranslate"><span class="pre">Typeable</span></code> instance.
The following are therefore illegal:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="nf">static</span><span class="w"> </span><span class="n">show</span><span class="w">                    </span><span class="c1">-- No Typeable instance for (Show a =&gt; a -&gt; String)</span><span class="w"></span>
<span class="nf">static</span><span class="w"> </span><span class="kt">Control</span><span class="o">.</span><span class="kt">Monad</span><span class="o">.</span><span class="kt">ST</span><span class="o">.</span><span class="n">runST</span><span class="w">  </span><span class="c1">-- No Typeable instance for ((forall s. ST s a) -&gt; a)</span><span class="w"></span>
</pre></div>
</div>
<p>That being said, with the appropriate use of wrapper datatypes, the
above limitations induce no loss of generality:</p>
<div class="highlight-haskell notranslate"><div class="highlight"><pre><span></span><span class="cm">{-# LANGUAGE ConstraintKinds           #-}</span><span class="w"></span>
<span class="cm">{-# LANGUAGE ExistentialQuantification #-}</span><span class="w"></span>
<span class="cm">{-# LANGUAGE Rank2Types                #-}</span><span class="w"></span>
<span class="cm">{-# LANGUAGE StandaloneDeriving        #-}</span><span class="w"></span>
<span class="cm">{-# LANGUAGE StaticPointers            #-}</span><span class="w"></span>

<span class="kr">import</span><span class="w"> </span><span class="nn">Control.Monad.ST</span><span class="w"></span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Data.Typeable</span><span class="w"></span>
<span class="kr">import</span><span class="w"> </span><span class="nn">GHC.StaticPtr</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="kt">Dict</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="kt">Dict</span><span class="w"></span>

<span class="nf">g1</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Typeable</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="kt">StaticPtr</span><span class="w"> </span><span class="p">(</span><span class="kt">Dict</span><span class="w"> </span><span class="p">(</span><span class="kt">Show</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"></span>
<span class="nf">g1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">static</span><span class="w"> </span><span class="p">(</span><span class="nf">\</span><span class="kt">Dict</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">show</span><span class="p">)</span><span class="w"></span>

<span class="kr">data</span><span class="w"> </span><span class="kt">Rank2Wrapper</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">R2W</span><span class="w"> </span><span class="p">(</span><span class="n">forall</span><span class="w"> </span><span class="n">s</span><span class="o">.</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="kt">Typeable</span><span class="w"></span>
<span class="kr">newtype</span><span class="w"> </span><span class="kt">Flip</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Flip</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">unFlip</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="kt">Typeable</span><span class="w"></span>

<span class="nf">g2</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Typeable</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="kt">StaticPtr</span><span class="w"> </span><span class="p">(</span><span class="kt">Rank2Wrapper</span><span class="w"> </span><span class="p">(</span><span class="kt">Flip</span><span class="w"> </span><span class="kt">ST</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"></span>
<span class="nf">g2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">static</span><span class="w"> </span><span class="p">(</span><span class="nf">\</span><span class="p">(</span><span class="kt">R2W</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">runST</span><span class="w"> </span><span class="p">(</span><span class="n">unFlip</span><span class="w"> </span><span class="n">f</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="primitives.html" class="btn btn-neutral float-right" title="6.16. Unboxed types and primitive operations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="stm.html" class="btn btn-neutral float-left" title="6.15.2. Software Transactional Memory" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, GHC Team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>